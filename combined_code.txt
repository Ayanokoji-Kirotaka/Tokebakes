--- PROJECT CODE START ---

--- FILE: ./admin-panel.html ---
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Panel | Toke Bakes</title>
    <link rel="shortcut icon" href="images/favicon.webp" type="image/png" />
    <link rel="stylesheet" href="style.css?v=6" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <link rel="icon" href="images/logo.jpg" type="image/png" />
  </head>
  <body>
    <!-- <div id="loader"><img src="images/logo.jpg" alt="Toke Bakes" /></div> -->

    <!-- Login Screen -->
    <div id="login-screen" class="admin-login-container">
      <div class="admin-login-box">
        <div class="admin-brand">
          <img src="images/logo.webp" alt="Toke Bakes" class="admin-logo" />
          <h2>Toke Bakes Admin</h2>
          <p class="admin-subtitle">Content Management System</p>
        </div>

        <form id="login-form" class="admin-login-form">
          <div class="form-group">
            <label for="admin-username"
              ><i class="fas fa-user"></i> Username</label
            >
            <input
              type="text"
              id="admin-username"
              placeholder="Enter username"
              required
            />
          </div>

          <div class="form-group">
            <label for="admin-password"
              ><i class="fas fa-lock"></i> Password</label
            >
            <input
              type="password"
              id="admin-password"
              placeholder="Enter password"
              required
            />
          </div>

          <div class="form-group">
            <button type="submit" class="btn btn-admin">
              <i class="fas fa-sign-in-alt"></i> Login
            </button>
          </div>

          <div class="login-note">
            <p>
              <i class="fas fa-info-circle"></i> Default credentials: admin /
              password123
            </p>
            <p>You can change these after first login.</p>
          </div>
        </form>
      </div>
    </div>

    <!-- Admin Dashboard (Hidden until login) -->
    <div id="admin-dashboard" class="admin-dashboard" style="display: none">
      <header class="admin-header">
        <div class="header-inner">
          <div class="brand">
            <img src="images/logo.webp" alt="Toke Bakes logo" class="logo-sm" />
            <h1>Toke Bakes Admin</h1>
          </div>
          <nav class="admin-navbar">
            <ul>
              <li>
                <a href="index.html" target="_blank"
                  ><i class="fas fa-external-link-alt"></i> Site</a
                >
              </li>

              <li>
                <a href="#" id="logout-btn"
                  ><i class="fas fa-sign-out-alt"></i> Logout</a
                >
              </li>
            </ul>

            <!-- Theme toggle -->
            <button
              class="theme-toggle"
              id="themeToggle"
              aria-label="Toggle theme"
            >
              <i class="fas fa-sun icon sun"></i>
              <i class="fas fa-moon icon moon"></i>
            </button>
          </nav>
        </div>
      </header>

      <main class="admin-main">
        <!-- Dashboard Tabs -->
        <div class="admin-tabs">
          <button class="admin-tab active" data-tab="featured">
            <i class="fas fa-star"></i> Featured Items
          </button>
          <button class="admin-tab" data-tab="menu">
            <i class="fas fa-utensils"></i> Menu Items
          </button>
          <button class="admin-tab" data-tab="gallery">
            <i class="fas fa-images"></i> Gallery
          </button>
          <button class="admin-tab" data-tab="settings">
            <i class="fas fa-cog"></i> Settings
          </button>
        </div>

        <!-- Storage Status -->
        <div class="storage-status">
          <div class="storage-info">
            <i class="fas fa-database"></i>
            <span>Storage: <span id="storage-used">0</span>MB / 500MB</span>
          </div>
          <div class="storage-bar">
            <div class="storage-fill" id="storage-fill"></div>
          </div>
        </div>

        <!-- Tab Content Containers -->
        <div class="admin-tab-content">
          <!-- Featured Items Tab -->
          <div id="featured-tab" class="tab-pane active">
            <div class="admin-section-header">
              <h2><i class="fas fa-star"></i> Manage Featured Items</h2>
              <p>These appear on the homepage under "Featured Creations"</p>
              <button class="btn btn-admin" id="add-featured-btn">
                <i class="fas fa-plus"></i> Add New Featured Item
              </button>
            </div>

            <div
              class="admin-form-container"
              id="featured-form-container"
              style="display: none"
            >
              <form id="featured-form" class="admin-form">
                <input type="hidden" id="featured-id" value="" />

                <div class="form-row">
                  <div class="form-group">
                    <label for="featured-title"
                      ><i class="fas fa-heading"></i> Title</label
                    >
                    <input
                      type="text"
                      id="featured-title"
                      placeholder="e.g., Chocolate Fudge Cake"
                      required
                    />
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label for="featured-description"
                      ><i class="fas fa-align-left"></i> Description</label
                    >
                    <textarea
                      id="featured-description"
                      rows="3"
                      placeholder="Describe this item..."
                      required
                    ></textarea>
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label for="featured-image"
                      ><i class="fas fa-image"></i> Image</label
                    >
                    <input type="file" id="featured-image" accept="image/*" />
                    <small class="form-help"
                      >Max 500KB. Images are stored in the cloud.</small
                    >
                    <div
                      class="image-preview"
                      id="featured-image-preview"
                    ></div>
                  </div>
                </div>

                <div class="form-actions">
                  <button type="submit" class="btn btn-admin">
                    <i class="fas fa-save"></i> Save Item
                  </button>
                  <button
                    type="button"
                    class="btn btn-secondary"
                    id="cancel-featured"
                  >
                    <i class="fas fa-times"></i> Cancel
                  </button>
                </div>
              </form>
            </div>

            <div class="items-list" id="featured-items-list">
              <!-- Featured items will be loaded here -->
              <div class="empty-state">
                <i class="fas fa-star"></i>
                <p>No featured items yet. Add your first item!</p>
              </div>
            </div>
          </div>

          <!-- Menu Items Tab -->
          <div id="menu-tab" class="tab-pane">
            <div class="admin-section-header">
              <h2><i class="fas fa-utensils"></i> Manage Menu Items</h2>
              <p>These appear on the menu page with prices</p>
              <button class="btn btn-admin" id="add-menu-btn">
                <i class="fas fa-plus"></i> Add New Menu Item
              </button>
            </div>

            <div
              class="admin-form-container"
              id="menu-form-container"
              style="display: none"
            >
              <form id="menu-form" class="admin-form">
                <input type="hidden" id="menu-id" value="" />

                <div class="form-row">
                  <div class="form-group">
                    <label for="menu-title"
                      ><i class="fas fa-heading"></i> Title</label
                    >
                    <input
                      type="text"
                      id="menu-title"
                      placeholder="e.g., Chocolate Fudge Cake"
                      required
                    />
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label for="menu-description"
                      ><i class="fas fa-align-left"></i> Description</label
                    >
                    <textarea
                      id="menu-description"
                      rows="3"
                      placeholder="Describe this menu item..."
                      required
                    ></textarea>
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label for="menu-price"
                      ><i class="fas fa-tag"></i> Price (‚Ç¶)</label
                    >
                    <input
                      type="number"
                      id="menu-price"
                      placeholder="1200"
                      min="0"
                      required
                    />
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label for="menu-image"
                      ><i class="fas fa-image"></i> Image</label
                    >
                    <input type="file" id="menu-image" accept="image/*" />
                    <small class="form-help"
                      >Max 500KB. Images are stored in the cloud.</small
                    >
                    <div class="image-preview" id="menu-image-preview"></div>
                  </div>
                </div>

                <div class="form-actions">
                  <button type="submit" class="btn btn-admin">
                    <i class="fas fa-save"></i> Save Menu Item
                  </button>
                  <button
                    type="button"
                    class="btn btn-secondary"
                    id="cancel-menu"
                  >
                    <i class="fas fa-times"></i> Cancel
                  </button>
                </div>
              </form>
            </div>

            <div class="items-list" id="menu-items-list">
              <!-- Menu items will be loaded here -->
              <div class="empty-state">
                <i class="fas fa-utensils"></i>
                <p>No menu items yet. Add your first item!</p>
              </div>
            </div>
          </div>

          <!-- Gallery Tab -->
          <div id="gallery-tab" class="tab-pane">
            <div class="admin-section-header">
              <h2><i class="fas fa-images"></i> Manage Gallery</h2>
              <p>Images that appear on the gallery page</p>
              <button class="btn btn-admin" id="add-gallery-btn">
                <i class="fas fa-plus"></i> Add Gallery Image
              </button>
            </div>

            <div
              class="admin-form-container"
              id="gallery-form-container"
              style="display: none"
            >
              <form id="gallery-form" class="admin-form">
                <input type="hidden" id="gallery-id" value="" />

                <div class="form-row">
                  <div class="form-group">
                    <label for="gallery-alt"
                      ><i class="fas fa-text-width"></i> Alt Text</label
                    >
                    <input
                      type="text"
                      id="gallery-alt"
                      placeholder="Describe the image for accessibility"
                      required
                    />
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label for="gallery-image"
                      ><i class="fas fa-image"></i> Image</label
                    >
                    <input
                      type="file"
                      id="gallery-image"
                      accept="image/*"
                      required
                    />
                    <small class="form-help"
                      >Max 500KB. Images are stored in the cloud.</small
                    >
                    <div class="image-preview" id="gallery-image-preview"></div>
                  </div>
                </div>

                <div class="form-actions">
                  <button type="submit" class="btn btn-admin">
                    <i class="fas fa-save"></i> Save Image
                  </button>
                  <button
                    type="button"
                    class="btn btn-secondary"
                    id="cancel-gallery"
                  >
                    <i class="fas fa-times"></i> Cancel
                  </button>
                </div>
              </form>
            </div>

            <div class="gallery-admin-grid" id="gallery-admin-grid">
              <!-- Gallery images will be loaded here -->
              <div class="empty-state">
                <i class="fas fa-images"></i>
                <p>No gallery images yet. Add your first image!</p>
              </div>
            </div>
          </div>

          <!-- Settings Tab -->
          <div id="settings-tab" class="tab-pane">
            <div class="admin-section-header">
              <h2><i class="fas fa-cog"></i> Admin Settings</h2>
            </div>

            <div class="settings-grid">
              <div class="settings-card">
                <h3><i class="fas fa-user-shield"></i> Change Password</h3>
                <form id="change-password-form" class="admin-form">
                  <div class="form-group">
                    <label for="current-password">Current Password</label>
                    <input type="password" id="current-password" required />
                  </div>
                  <div class="form-group">
                    <label for="new-password">New Password</label>
                    <input
                      type="password"
                      id="new-password"
                      required
                      minlength="6"
                    />
                  </div>
                  <div class="form-group">
                    <label for="confirm-password">Confirm New Password</label>
                    <input type="password" id="confirm-password" required />
                  </div>
                  <button type="submit" class="btn btn-admin">
                    <i class="fas fa-key"></i> Update Password
                  </button>
                </form>
              </div>

              <div class="settings-card">
                <h3><i class="fas fa-database"></i> Data Management</h3>
                <div class="settings-actions">
                  <button class="btn btn-secondary" id="export-data">
                    <i class="fas fa-download"></i> Export All Data
                  </button>
                  <button class="btn btn-secondary" id="import-data">
                    <i class="fas fa-upload"></i> Import Data
                  </button>
                  <button class="btn btn-danger" id="reset-data">
                    <i class="fas fa-trash"></i> Reset to Defaults
                  </button>
                </div>
                <small class="form-help"
                  >Export saves your data as a JSON file. Import replaces all
                  current data.</small
                >
              </div>

              <div class="settings-card">
                <h3><i class="fas fa-info-circle"></i> System Info</h3>
                <div class="system-info">
                  <p><strong>Version:</strong> 2.0.0</p>
                  <p>
                    <strong>Storage Used:</strong>
                    <span id="storage-info">0 MB</span>
                  </p>
                  <p><strong>Items Count:</strong></p>
                  <ul>
                    <li>Featured: <span id="count-featured">0</span></li>
                    <li>Menu: <span id="count-menu">0</span></li>
                    <li>Gallery: <span id="count-gallery">0</span></li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>

      <footer class="bakes-footer">
        <div class="footer-content">
          <div class="footer-brand">
            <h3>Toke Bakes Admin</h3>
            <p class="tagline">Content Management System</p>
          </div>
          <div class="footer-info">
            <div class="social-links">
              <span class="follow-text">Quick Links</span>
              <div class="social-icons">
                <a
                  href="index.html"
                  target="_blank"
                  class="social-icon"
                  aria-label="View Homepage"
                >
                  <i class="fas fa-home"></i>
                </a>
                <a
                  href="menu.html"
                  target="_blank"
                  class="social-icon"
                  aria-label="View Menu"
                >
                  <i class="fas fa-utensils"></i>
                </a>
                <a
                  href="gallery.html"
                  target="_blank"
                  class="social-icon"
                  aria-label="View Gallery"
                >
                  <i class="fas fa-images"></i>
                </a>
              </div>
            </div>
          </div>
        </div>
        <div class="footer-bottom">
          <p class="copyright">
            &copy; <span id="admin-year">2024</span> Toke Bakes Admin Panel. All
            rights reserved.
          </p>
        </div>
      </footer>
    </div>

    <!-- Hidden file input for import -->
    <input type="file" id="import-file" accept=".json" style="display: none" />

    <script src="config.js?v=6"></script>
    <script src="admin.js?v=6"></script>
    <script src="script.js?v=6"></script>
  </body>
</html>

--- FILE: ./admin.js ---
/* ================== admin.js ================== */
/* Toke Bakes Admin Panel - MODERN CONFIRMATION DIALOG VERSION */

/* ================== AUTO-UPDATE SYSTEM ================== */
class DataSyncManager {
  constructor() {
    this.lastUpdateKey = "toke_bakes_last_update";
    this.broadcastChannel = null;
    this.init();
  }

  init() {
    if (typeof BroadcastChannel !== "undefined") {
      this.broadcastChannel = new BroadcastChannel("toke_bakes_data_updates");
    }
  }

  notifyDataChanged(operationType, itemType) {
    const timestamp = Date.now().toString();
    localStorage.setItem(this.lastUpdateKey, timestamp);

    if (this.broadcastChannel) {
      this.broadcastChannel.postMessage({
        type: "DATA_UPDATED",
        timestamp: timestamp,
        operation: operationType,
        itemType: itemType,
      });
    }
  }
}

const dataSync = new DataSyncManager();

// Admin credentials with SHA-256 hash for "admin123"
const ADMIN_CREDENTIALS = {
  username: "admin",
  passwordHash:
    "240be518fabd2724ddb6f04eeb1da5967448d7e831c08c8fa822809f74c720a9",
};

// Current admin state
let currentAdmin = null;
let isEditing = false;
let currentEditId = null;
let sessionTimeout = null;
const SESSION_TIMEOUT_MINUTES = 30;

// Store for temporary image data
let tempImageCache = new Map();

/* ================== MODERN CONFIRMATION DIALOG SYSTEM ================== */

class ModernConfirmationDialog {
  constructor() {
    this.dialogId = "modern-confirmation-dialog";
    this.init();
  }

  init() {
    if (!document.getElementById(this.dialogId)) {
      this.createDialog();
    }
  }

  createDialog() {
    const dialogHTML = `
      <div id="${this.dialogId}" class="confirmation-dialog" aria-hidden="true">
        <div class="confirmation-content" role="dialog" aria-modal="true" aria-labelledby="confirmation-title">
          <div class="confirmation-header">
            <i class="fas fa-exclamation-triangle"></i>
            <h3 id="confirmation-title">Confirm Deletion</h3>
            <p>Are you sure you want to delete this item?</p>
          </div>
          <div class="confirmation-body">
            <div id="confirmation-details"></div>
          </div>
          <div class="confirmation-actions">
            <button id="confirm-cancel" class="btn-confirm-cancel">
              <i class="fas fa-times"></i> Cancel
            </button>
            <button id="confirm-delete" class="btn-confirm-delete">
              <i class="fas fa-trash"></i> Delete
            </button>
          </div>
        </div>
      </div>
    `;

    document.body.insertAdjacentHTML("beforeend", dialogHTML);
  }

  show(itemDetails) {
    return new Promise((resolve) => {
      const dialog = document.getElementById(this.dialogId);
      const detailsEl = document.getElementById("confirmation-details");
      const cancelBtn = document.getElementById("confirm-cancel");
      const deleteBtn = document.getElementById("confirm-delete");
      const titleEl = document.getElementById("confirmation-title");

      // Set dialog content based on item type
      let itemType = "Item";
      if (itemDetails.type === "featured") itemType = "Featured Item";
      if (itemDetails.type === "menu") itemType = "Menu Item";
      if (itemDetails.type === "gallery") itemType = "Gallery Image";

      titleEl.textContent = `Delete ${itemType}`;

      const detailsHTML = `
        <p>This action cannot be undone. The following ${itemType.toLowerCase()} will be permanently deleted:</p>
        <div class="confirmation-item">
          <h4>${escapeHtml(itemDetails.title)}</h4>
          ${
            itemDetails.description
              ? `<p>${escapeHtml(itemDetails.description)}</p>`
              : ""
          }
          ${
            itemDetails.price
              ? `<p><strong>Price:</strong> ‚Ç¶${formatPrice(
                  itemDetails.price
                )}</p>`
              : ""
          }
          ${
            itemDetails.created
              ? `<p><small>Created: ${new Date(
                  itemDetails.created
                ).toLocaleDateString()}</small></p>`
              : ""
          }
        </div>
        <p><strong>Warning:</strong> This will permanently remove this item from your database.</p>
      `;

      detailsEl.innerHTML = detailsHTML;

      // Show dialog
      dialog.classList.add("active");
      dialog.setAttribute("aria-hidden", "false");
      deleteBtn.focus();

      // Handle escape key
      const handleEscape = (e) => {
        if (e.key === "Escape") {
          dialog.classList.remove("active");
          dialog.setAttribute("aria-hidden", "true");
          resolve(false);
          document.removeEventListener("keydown", handleEscape);
        }
      };

      document.addEventListener("keydown", handleEscape);

      // Button event handlers
      const handleCancel = () => {
        dialog.classList.remove("active");
        dialog.setAttribute("aria-hidden", "true");
        resolve(false);
        cleanup();
      };

      const handleDelete = () => {
        dialog.classList.remove("active");
        dialog.setAttribute("aria-hidden", "true");
        resolve(true);
        cleanup();
      };

      const cleanup = () => {
        cancelBtn.removeEventListener("click", handleCancel);
        deleteBtn.removeEventListener("click", handleDelete);
        document.removeEventListener("keydown", handleEscape);
      };

      cancelBtn.addEventListener("click", handleCancel, { once: true });
      deleteBtn.addEventListener("click", handleDelete, { once: true });
    });
  }
}

// Initialize the modern confirmation dialog system
const confirmationDialog = new ModernConfirmationDialog();

// Helper function to get item details
async function getItemDetails(itemId, itemType) {
  try {
    const endpoints = {
      featured: API_ENDPOINTS.FEATURED,
      menu: API_ENDPOINTS.MENU,
      gallery: API_ENDPOINTS.GALLERY,
    };

    const endpoint = endpoints[itemType] || API_ENDPOINTS.FEATURED;
    const response = await fetch(
      `${SUPABASE_CONFIG.URL}${endpoint}/${itemId}`,
      {
        headers: {
          apikey: SUPABASE_CONFIG.ANON_KEY,
          Authorization: `Bearer ${SUPABASE_CONFIG.ANON_KEY}`,
          "Content-Type": "application/json",
        },
      }
    );

    if (response.ok) {
      const item = await response.json();
      return {
        id: item.id,
        title: item.title || item.name || "Untitled Item",
        description: item.description || "",
        price: item.price || null,
        created: item.created_at || null,
        type: itemType,
      };
    }
  } catch (error) {
    console.error("Error fetching item details:", error);
  }

  return {
    id: itemId,
    title: "Unknown Item",
    description: "",
    type: itemType,
  };
}

// Price formatting function
function formatPrice(num) {
  return Number(num).toLocaleString("en-NG");
}

// Modified delete functions with modern confirmation dialog
async function deleteFeaturedItem(id) {
  try {
    const itemDetails = await getItemDetails(id, "featured");

    const confirmed = await confirmationDialog.show(itemDetails);

    if (!confirmed) {
      showNotification("Deletion cancelled", "info");
      return;
    }

    await secureRequest(`${API_ENDPOINTS.FEATURED}?id=eq.${id}`, "DELETE");
    showNotification("Featured item deleted!", "success");

    // Clear from cache
    tempImageCache.delete(id);
    clearDataCache();

    await renderFeaturedItems();
    await updateItemCounts();

    dataSync.notifyDataChanged("delete", "featured");
  } catch (error) {
    console.error("Error deleting featured item:", error);
    showNotification("Failed to delete item", "error");
  }
}

async function deleteMenuItem(id) {
  try {
    const itemDetails = await getItemDetails(id, "menu");

    const confirmed = await confirmationDialog.show(itemDetails);

    if (!confirmed) {
      showNotification("Deletion cancelled", "info");
      return;
    }

    await secureRequest(`${API_ENDPOINTS.MENU}?id=eq.${id}`, "DELETE");
    showNotification("Menu item deleted!", "success");

    // Clear from cache
    tempImageCache.delete(id);
    clearDataCache();

    await renderMenuItems();
    await updateItemCounts();

    dataSync.notifyDataChanged("delete", "menu");
  } catch (error) {
    console.error("Error deleting menu item:", error);
    showNotification("Failed to delete menu item", "error");
  }
}

async function deleteGalleryItem(id) {
  try {
    const itemDetails = await getItemDetails(id, "gallery");

    const confirmed = await confirmationDialog.show(itemDetails);

    if (!confirmed) {
      showNotification("Deletion cancelled", "info");
      return;
    }

    await secureRequest(`${API_ENDPOINTS.GALLERY}?id=eq.${id}`, "DELETE");
    showNotification("Gallery image deleted!", "success");

    // Clear from cache
    tempImageCache.delete(id);
    clearDataCache();

    await renderGalleryItems();
    await updateItemCounts();

    dataSync.notifyDataChanged("delete", "gallery");
  } catch (error) {
    console.error("Error deleting gallery item:", error);
    showNotification("Failed to delete gallery item", "error");
  }
}

/* ================== ENHANCED SECURITY FUNCTIONS ================== */

// Generate secure session token
function generateSessionToken() {
  const array = new Uint8Array(32);
  crypto.getRandomValues(array);
  return Array.from(array, (byte) => byte.toString(16).padStart(2, "0")).join(
    ""
  );
}

// Secure storage for session data
const secureStorage = {
  setItem: (key, value) => {
    try {
      sessionStorage.setItem(`secure_${key}`, btoa(JSON.stringify(value)));
    } catch (e) {
      console.warn("Secure storage failed:", e);
      // Fallback to memory storage
      window.tempStorage = window.tempStorage || {};
      window.tempStorage[`secure_${key}`] = value;
    }
  },
  getItem: (key) => {
    try {
      const item = sessionStorage.getItem(`secure_${key}`);
      return item ? JSON.parse(atob(item)) : null;
    } catch (e) {
      console.warn("Secure storage retrieval failed:", e);
      // Check memory storage
      return window.tempStorage ? window.tempStorage[`secure_${key}`] : null;
    }
  },
  removeItem: (key) => {
    try {
      sessionStorage.removeItem(`secure_${key}`);
    } catch (e) {
      console.warn("Secure storage removal failed:", e);
    }
    // Also remove from memory storage
    if (window.tempStorage) {
      delete window.tempStorage[`secure_${key}`];
    }
  },
};

// Input sanitization
function sanitizeInput(input) {
  if (typeof input !== "string") return input;
  return input
    .replace(/[<>]/g, "")
    .replace(/javascript:/gi, "")
    .replace(/on\w+=/gi, "")
    .trim();
}

// Escape HTML for safety
function escapeHtml(text) {
  const div = document.createElement("div");
  div.textContent = text;
  return div.innerHTML;
}

/* ================== CUSTOM POPUP SYSTEM ================== */

// Custom popup system to replace alert/confirm
function showPopup(options) {
  return new Promise((resolve) => {
    // Remove existing popup if any
    const existingPopup = document.getElementById("custom-popup-overlay");
    if (existingPopup) {
      existingPopup.remove();
    }

    const {
      title = "Notification",
      message,
      type = "info",
      showCancel = false,
      cancelText = "Cancel",
      confirmText = "OK",
      onConfirm = () => {},
      onCancel = () => {},
    } = options;

    // Create overlay
    const overlay = document.createElement("div");
    overlay.id = "custom-popup-overlay";
    overlay.style.cssText = `
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10001;
      backdrop-filter: blur(4px);
      animation: fadeIn 0.3s ease;
    `;

    // Create popup
    const popup = document.createElement("div");
    popup.style.cssText = `
      background: white;
      border-radius: 12px;
      padding: 0;
      min-width: 320px;
      max-width: 450px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
      animation: slideIn 0.3s ease;
      overflow: hidden;
      font-family: 'Poppins', sans-serif;
    `;

    // Header with type-based color
    const typeColors = {
      info: "#2196F3",
      success: "#4CAF50",
      warning: "#FF9800",
      error: "#F44336",
      question: "#9C27B0",
    };

    const header = document.createElement("div");
    header.style.cssText = `
      background: ${typeColors[type] || typeColors.info};
      color: white;
      padding: 1.5rem;
      text-align: center;
    `;

    const titleEl = document.createElement("h3");
    titleEl.textContent = title;
    titleEl.style.cssText = `
      margin: 0;
      font-size: 1.4rem;
      font-weight: 600;
    `;

    header.appendChild(titleEl);
    popup.appendChild(header);

    // Message
    const messageEl = document.createElement("div");
    messageEl.style.cssText = `
      padding: 2rem;
      color: #333;
      line-height: 1.6;
      text-align: center;
      font-size: 1rem;
    `;
    messageEl.textContent = message;
    popup.appendChild(messageEl);

    // Buttons container
    const buttonsContainer = document.createElement("div");
    buttonsContainer.style.cssText = `
      display: flex;
      gap: 12px;
      padding: 0 2rem 2rem;
      justify-content: ${showCancel ? "space-between" : "center"};
    `;

    // Cancel button
    if (showCancel) {
      const cancelBtn = document.createElement("button");
      cancelBtn.textContent = cancelText;
      cancelBtn.style.cssText = `
        flex: 1;
        padding: 12px 24px;
        background: #f5f5f5;
        color: #666;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
        font-family: 'Poppins', sans-serif;
      `;

      cancelBtn.addEventListener("mouseenter", () => {
        cancelBtn.style.background = "#e0e0e0";
      });

      cancelBtn.addEventListener("mouseleave", () => {
        cancelBtn.style.background = "#f5f5f5";
      });

      cancelBtn.addEventListener("click", () => {
        overlay.remove();
        onCancel();
        resolve(false);
      });

      buttonsContainer.appendChild(cancelBtn);
    }

    // Confirm button
    const confirmBtn = document.createElement("button");
    confirmBtn.textContent = confirmText;
    confirmBtn.style.cssText = `
      flex: 1;
      padding: 12px 24px;
      background: ${typeColors[type] || typeColors.info};
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      font-family: 'Poppins', sans-serif;
    `;

    confirmBtn.addEventListener("mouseenter", () => {
      confirmBtn.style.opacity = "0.9";
      confirmBtn.style.transform = "translateY(-2px)";
    });

    confirmBtn.addEventListener("mouseleave", () => {
      confirmBtn.style.opacity = "1";
      confirmBtn.style.transform = "translateY(0)";
    });

    confirmBtn.addEventListener("click", () => {
      overlay.remove();
      onConfirm();
      resolve(true);
    });

    buttonsContainer.appendChild(confirmBtn);
    popup.appendChild(buttonsContainer);
    overlay.appendChild(popup);
    document.body.appendChild(overlay);

    // Add animations
    if (!document.querySelector("#popup-animations")) {
      const style = document.createElement("style");
      style.id = "popup-animations";
      style.textContent = `
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }

        @keyframes slideIn {
          from {
            opacity: 0;
            transform: translateY(-20px) scale(0.95);
          }
          to {
            opacity: 1;
            transform: translateY(0) scale(1);
          }
        }

        #custom-popup-overlay button:active {
          transform: scale(0.98);
        }

        @media (max-width: 480px) {
          #custom-popup-overlay > div {
            width: 90%;
            min-width: auto;
            margin: 20px;
          }
        }
      `;
      document.head.appendChild(style);
    }

    // Close on overlay click (outside popup)
    overlay.addEventListener("click", (e) => {
      if (e.target === overlay) {
        if (showCancel) {
          overlay.remove();
          onCancel();
          resolve(false);
        }
      }
    });
  });
}

/* ================== PASSWORD HASHING ================== */

// Enhanced password hashing
async function hashPassword(password) {
  try {
    // Use SHA-256 for consistency with your existing hash
    const encoder = new TextEncoder();
    const data = encoder.encode(password);
    const hashBuffer = await crypto.subtle.digest("SHA-256", data);
    const hashArray = Array.from(new Uint8Array(hashBuffer));
    return hashArray.map((b) => b.toString(16).padStart(2, "0")).join("");
  } catch (error) {
    console.error("Password hashing failed:", error);
    // Simple fallback for very old browsers
    return password; // This is just a fallback - modern browsers support crypto
  }
}

/* ================== PASSWORD SYNC FUNCTIONS ================== */

// Load password from database on startup
async function loadPasswordFromDatabase() {
  try {
    console.log("Loading admin password from database...");

    const response = await fetch(
      `${SUPABASE_CONFIG.URL}/rest/v1/admin_users?username=eq.admin&select=password_hash`,
      {
        method: "GET",
        headers: {
          apikey: SUPABASE_CONFIG.ANON_KEY,
          Authorization: `Bearer ${SUPABASE_CONFIG.ANON_KEY}`,
        },
      }
    );

    if (response.ok) {
      const data = await response.json();
      if (data.length > 0 && data[0].password_hash) {
        const dbHash = data[0].password_hash;

        // Update local hash to match database
        ADMIN_CREDENTIALS.passwordHash = dbHash;

        console.log(
          "‚úÖ Loaded password hash from database:",
          dbHash.substring(0, 20) + "..."
        );

        return true;
      }
    }

    console.log("‚ö†Ô∏è Using local password hash");
    return false;
  } catch (error) {
    console.error("Failed to load password from database:", error);
    return false;
  }
}

// Check password sync status
async function checkPasswordSync() {
  try {
    const response = await fetch(
      `${SUPABASE_CONFIG.URL}/rest/v1/admin_users?username=eq.admin&select=password_hash`,
      {
        method: "GET",
        headers: {
          apikey: SUPABASE_CONFIG.ANON_KEY,
          Authorization: `Bearer ${SUPABASE_CONFIG.ANON_KEY}`,
        },
      }
    );

    if (response.ok) {
      const data = await response.json();
      if (data.length > 0) {
        const dbHash = data[0].password_hash;
        const localHash = ADMIN_CREDENTIALS.passwordHash;

        const isSynced = dbHash === localHash;

        if (!isSynced) {
          console.warn("‚ö†Ô∏è Password NOT synced!");
          console.log("Database hash:", dbHash.substring(0, 20) + "...");
          console.log("Local hash:", localHash.substring(0, 20) + "...");

          // Auto-sync with database
          ADMIN_CREDENTIALS.passwordHash = dbHash;
          console.log("‚úÖ Password synced with database");
        } else {
          console.log("‚úÖ Passwords are synced");
        }

        return isSynced;
      }
    }
    return false;
  } catch (error) {
    console.error("Password sync check error:", error);
    return false;
  }
}

// Update password in database
async function updatePasswordInDatabase(newHash) {
  try {
    const response = await fetch(
      `${SUPABASE_CONFIG.URL}/rest/v1/admin_users?username=eq.admin`,
      {
        method: "PATCH",
        headers: {
          "Content-Type": "application/json",
          apikey: SUPABASE_CONFIG.ANON_KEY,
          Authorization: `Bearer ${SUPABASE_CONFIG.ANON_KEY}`,
          Prefer: "return=representation",
        },
        body: JSON.stringify({
          password_hash: newHash,
          last_login: new Date().toISOString(),
        }),
      }
    );

    if (!response.ok) {
      const errorText = await response.text();
      console.error("Password update failed:", errorText);
      return {
        success: false,
        message: `Database update failed: ${response.status}`,
      };
    }

    const result = await response.json();

    if (result && result.length > 0) {
      console.log("‚úÖ Password updated in database successfully");
      return {
        success: true,
        message: "Password updated in database",
        data: result[0],
      };
    } else {
      return {
        success: false,
        message: "No rows were updated",
      };
    }
  } catch (error) {
    console.error("Update password error:", error);
    return {
      success: false,
      message: `Network error: ${error.message}`,
    };
  }
}

/* ================== ENHANCED UTILITY FUNCTIONS ================== */

/**
 * ULTRA-OPTIMIZED IMAGE COMPRESSION WITH POPUP NOTIFICATIONS
 * Features:
 * - WebP-first compression (25-35% smaller than JPEG)
 * - User-friendly popup errors and progress
 * - Smart quality adjustment for food images
 * - Performance-optimized processing
 * - Fallback to JPEG for old browsers
 */

// ================== IMAGE COMPRESSION ==================

async function compressImage(file, maxSizeKB = 300) {
  return new Promise((resolve, reject) => {
    // 1. VALIDATION WITH USER-FRIENDLY ERRORS
    if (!file.type.startsWith("image/")) {
      showNotification(
        "‚ùå Please select an image file (JPEG, PNG, WebP, etc.)",
        "error"
      );
      reject(new Error("File is not an image"));
      return;
    }

    // Check for unsupported formats
    const unsupportedFormats = [
      "image/heic",
      "image/heif",
      "image/raw",
      "image/tiff",
    ];
    if (unsupportedFormats.includes(file.type.toLowerCase())) {
      showNotification(
        "‚ùå Please convert HEIC/TIFF/RAW images to JPEG or PNG first",
        "error"
      );
      reject(new Error("Unsupported image format"));
      return;
    }

    if (file.size > 10 * 1024 * 1024) {
      // Increased to 10MB for food photography
      showNotification("‚ùå Image is too large! Maximum size is 10MB", "error");
      reject(new Error("Image must be less than 10MB"));
      return;
    }

    // Show compression started notification
    showNotification("üîÑ Optimizing your image...", "info");

    const reader = new FileReader();

    reader.onload = function (event) {
      const img = new Image();

      img.onload = function () {
        // Use requestAnimationFrame for smoother UI
        requestAnimationFrame(() => {
          try {
            // 2. SMART DIMENSION CALCULATION FOR FOOD IMAGES
            const canvas = document.createElement("canvas");
            const maxDimension = 1200; // Higher for food detail

            // Preserve aspect ratio with food-optimized sizing
            let width = img.width;
            let height = img.height;
            const aspectRatio = width / height;

            if (width > height && width > maxDimension) {
              width = maxDimension;
              height = Math.round(maxDimension / aspectRatio);
            } else if (height > maxDimension) {
              height = maxDimension;
              width = Math.round(maxDimension * aspectRatio);
            }

            // Ensure minimum size for food detail
            if (width < 500) width = 500;
            if (height < 500) height = 500;

            canvas.width = width;
            canvas.height = height;
            const ctx = canvas.getContext("2d", { alpha: false }); // Disable alpha for speed

            // Optimized drawing settings
            ctx.imageSmoothingEnabled = true;
            ctx.imageSmoothingQuality = "medium"; // Balance of quality and speed
            ctx.drawImage(img, 0, 0, width, height);

            // 3. WEBP-OPTIMIZED COMPRESSION WITH SMART QUALITY ADJUSTMENT
            showNotification(
              "üîß Adjusting quality for optimal file size...",
              "info"
            );

            const compressionResult = optimizeImage(canvas, maxSizeKB);

            // 4. SUCCESS NOTIFICATION WITH DETAILED STATS
            const originalKB = (file.size / 1024).toFixed(1);
            const compressedKB = (compressionResult.data.length / 1024).toFixed(
              1
            );
            const savings = (
              (1 - compressionResult.data.length / file.size) *
              100
            ).toFixed(1);

            let successMessage;
            if (savings > 75) {
              successMessage = `‚úÖ Amazing compression! ${originalKB}KB ‚Üí ${compressedKB}KB (${savings}% saved)`;
            } else if (savings > 50) {
              successMessage = `‚úÖ Great optimization! ${originalKB}KB ‚Üí ${compressedKB}KB`;
            } else if (savings > 20) {
              successMessage = `‚úÖ Image optimized to ${compressedKB}KB`;
            } else {
              successMessage = `‚úÖ Image ready at ${compressedKB}KB (high quality preserved)`;
            }

            // Add format info
            successMessage += ` ‚Ä¢ ${compressionResult.format.toUpperCase()}`;

            showNotification(successMessage, "success");

            // 5. RETURN COMPRESSED DATA
            const result = {
              data: compressionResult.data,
              format: compressionResult.format,
              size: compressionResult.data.length,
              dimensions: { width, height },
              originalSize: file.size,
              qualityUsed: compressionResult.quality,
            };

            console.log(
              `üç∞ Food Image Compressed: ${originalKB}KB ‚Üí ${compressedKB}KB (${savings}% saved) ` +
                `as ${compressionResult.format.toUpperCase()} at ${(
                  compressionResult.quality * 100
                ).toFixed(0)}% quality`
            );

            resolve(result);
          } catch (error) {
            // 6. PROCESSING ERROR WITH HELPFUL GUIDANCE
            showNotification(
              "‚ùå Failed to process image. Try a different format or smaller size.",
              "error"
            );
            console.error("Image processing failed:", error);
            reject(new Error(`Image processing failed: ${error.message}`));
          }
        });
      };

      img.onerror = () => {
        showNotification(
          "‚ùå Could not load image. The file may be corrupted.",
          "error"
        );
        reject(new Error("Failed to load image"));
      };

      img.src = event.target.result;
    };

    reader.onerror = () => {
      showNotification(
        "‚ùå Error reading file. Please try selecting the image again.",
        "error"
      );
      reject(new Error("Failed to read file"));
    };

    reader.readAsDataURL(file);
  });
}

/**
 * Optimize image to target size with WebP priority
 */
function optimizeImage(canvas, maxSizeKB) {
  const TARGET_SIZE = maxSizeKB * 1024;
  let quality = 0.85; // Start high for food quality
  let base64;
  let format = "webp";

  try {
    // Primary: Try WebP (95% of users)
    base64 = canvas.toDataURL("image/webp", quality);

    // Smart size optimization (fewer iterations = faster)
    if (base64.length > TARGET_SIZE) {
      // Calculate needed reduction
      const oversizeRatio = base64.length / TARGET_SIZE;

      if (oversizeRatio > 2) {
        // Very oversized - bigger quality drop
        quality = 0.7;
        base64 = canvas.toDataURL("image/webp", quality);
      } else if (oversizeRatio > 1.3) {
        // Moderately oversized
        quality = 0.78;
        base64 = canvas.toDataURL("image/webp", quality);
      }

      // One final check
      if (base64.length > TARGET_SIZE * 1.1 && quality > 0.65) {
        quality = 0.65;
        base64 = canvas.toDataURL("image/webp", quality);
      }
    }

    // If still too large after optimization
    if (base64.length > TARGET_SIZE * 1.2) {
      console.warn("Food image remains large - prioritizing quality over size");
    }
  } catch (error) {
    // Secondary: WebP failed, use JPEG fallback (5% of users)
    showNotification(
      "‚ÑπÔ∏è Using standard format for maximum compatibility",
      "info"
    );
    quality = 0.82;
    base64 = canvas.toDataURL("image/jpeg", quality);
    format = "jpeg";

    // JPEG size adjustment
    if (base64.length > TARGET_SIZE && quality > 0.7) {
      quality = 0.75;
      base64 = canvas.toDataURL("image/jpeg", quality);
    }
  }

  return { data: base64, format, quality };
}

// ================== ENHANCED NOTIFICATION SYSTEM ==================

const notificationQueue = [];
let isShowingNotification = false;
let notificationTimeout = null;

/**
 * Advanced notification system with queuing, theming, and animations
 */
function showNotification(message, type = "success") {
  const notification = {
    id: Date.now() + Math.random(),
    message,
    type,
    timestamp: new Date(),
    priority: getNotificationPriority(type),
  };

  // Add to queue (sorted by priority)
  notificationQueue.push(notification);
  notificationQueue.sort((a, b) => b.priority - a.priority);

  if (!isShowingNotification) {
    processNextNotification();
  }
}

/**
 * Priority system: error > warning > info > success
 */
function getNotificationPriority(type) {
  const priorities = {
    error: 40,
    warning: 30,
    info: 20,
    success: 10,
  };
  return priorities[type] || 10;
}

function processNextNotification() {
  if (notificationQueue.length === 0) {
    isShowingNotification = false;
    return;
  }

  isShowingNotification = true;
  const notification = notificationQueue.shift();

  // Remove existing notification
  const existing = document.getElementById("admin-notification");
  if (existing) {
    existing.style.animation = "slideOutRight 0.3s ease-out forwards";
    setTimeout(() => existing.remove(), 300);

    // Small delay before showing next
    setTimeout(() => createNotification(notification), 350);
  } else {
    createNotification(notification);
  }
}

function createNotification(notification) {
  // Notification styling themes
  const themes = {
    success: {
      background: "linear-gradient(135deg, #4caf50, #2e7d32)",
      icon: "‚úÖ",
      border: "2px solid #2e7d32",
      iconBg: "rgba(76, 175, 80, 0.2)",
    },
    error: {
      background: "linear-gradient(135deg, #e64a4a, #c62828)",
      icon: "‚ùå",
      border: "2px solid #c62828",
      iconBg: "rgba(230, 74, 74, 0.2)",
    },
    warning: {
      background: "linear-gradient(135deg, #ff9800, #ef6c00)",
      icon: "‚ö†Ô∏è",
      border: "2px solid #ef6c00",
      iconBg: "rgba(255, 152, 0, 0.2)",
    },
    info: {
      background: "linear-gradient(135deg, #2196f3, #1565c0)",
      icon: "‚ÑπÔ∏è",
      border: "2px solid #1565c0",
      iconBg: "rgba(33, 150, 243, 0.2)",
    },
  };

  const theme = themes[notification.type] || themes.success;

  // Create notification element
  const notificationEl = document.createElement("div");
  notificationEl.id = "admin-notification";
  notificationEl.className = `admin-notification admin-notification-${notification.type}`;

  // Icon container
  const iconEl = document.createElement("div");
  iconEl.className = "notification-icon";
  iconEl.textContent = theme.icon;
  iconEl.style.cssText = `
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: ${theme.iconBg};
    font-size: 1.2rem;
    flex-shrink: 0;
  `;

  // Message container
  const messageEl = document.createElement("div");
  messageEl.className = "notification-message";
  messageEl.textContent = notification.message;
  messageEl.style.cssText = `
    flex: 1;
    font-family: 'Poppins', sans-serif;
    font-size: 0.95rem;
    line-height: 1.4;
  `;

  // Close button
  const closeBtn = document.createElement("button");
  closeBtn.className = "notification-close";
  closeBtn.innerHTML = "&times;";
  closeBtn.setAttribute("aria-label", "Close notification");
  closeBtn.style.cssText = `
    background: rgba(255, 255, 255, 0.15);
    border: none;
    color: white;
    border-radius: 50%;
    width: 28px;
    height: 28px;
    cursor: pointer;
    font-size: 1.2rem;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    flex-shrink: 0;
    margin-left: 10px;
  `;

  // Container
  const container = document.createElement("div");
  container.style.cssText = `
    display: flex;
    align-items: center;
    gap: 12px;
    width: 100%;
  `;

  container.appendChild(iconEl);
  container.appendChild(messageEl);
  container.appendChild(closeBtn);
  notificationEl.appendChild(container);

  // Main notification styles
  notificationEl.style.cssText = `
    position: fixed;
    top: 25px;
    right: 25px;
    background: ${theme.background};
    color: white;
    padding: 1.2rem 1.5rem;
    border-radius: 14px;
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
    z-index: 10000;
    animation: notificationSlideIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    max-width: 380px;
    min-width: 300px;
    cursor: pointer;
    font-family: 'Poppins', sans-serif;
    border: ${theme.border};
    backdrop-filter: blur(20px);
    transition: all 0.3s ease;
  `;

  // Add hover effect
  notificationEl.addEventListener("mouseenter", () => {
    notificationEl.style.transform = "translateY(-3px)";
    notificationEl.style.boxShadow = "0 12px 40px rgba(0, 0, 0, 0.25)";
    closeBtn.style.background = "rgba(255, 255, 255, 0.25)";
  });

  notificationEl.addEventListener("mouseleave", () => {
    notificationEl.style.transform = "translateY(0)";
    notificationEl.style.boxShadow = "0 8px 30px rgba(0, 0, 0, 0.2)";
    closeBtn.style.background = "rgba(255, 255, 255, 0.15)";
  });

  // Close button hover
  closeBtn.addEventListener("mouseenter", () => {
    closeBtn.style.transform = "scale(1.1)";
    closeBtn.style.background = "rgba(255, 255, 255, 0.3)";
  });

  closeBtn.addEventListener("mouseleave", () => {
    closeBtn.style.transform = "scale(1)";
    closeBtn.style.background = "rgba(255, 255, 255, 0.15)";
  });

  // Close button click
  closeBtn.addEventListener("click", (e) => {
    e.stopPropagation();
    dismissNotification(notificationEl);
  });

  // Click anywhere to dismiss
  notificationEl.addEventListener("click", (e) => {
    if (!e.target.closest(".notification-close")) {
      dismissNotification(notificationEl);
    }
  });

  document.body.appendChild(notificationEl);

  // Auto-dismiss based on type
  const dismissTimes = {
    error: 6000, // Longer for errors (users need to read)
    warning: 5000, // Medium for warnings
    info: 4000, // Shorter for info
    success: 3000, // Shortest for success
  };

  notificationTimeout = setTimeout(() => {
    if (document.body.contains(notificationEl)) {
      dismissNotification(notificationEl);
    }
  }, dismissTimes[notification.type] || 3000);
}

function dismissNotification(notificationEl) {
  if (notificationTimeout) {
    clearTimeout(notificationTimeout);
    notificationTimeout = null;
  }

  notificationEl.style.animation =
    "notificationSlideOut 0.3s ease-out forwards";

  setTimeout(() => {
    if (document.body.contains(notificationEl)) {
      notificationEl.remove();
    }
    isShowingNotification = false;
    processNextNotification();
  }, 300);
}

// Add notification animations to the page
if (!document.querySelector("#notification-animations")) {
  const style = document.createElement("style");
  style.id = "notification-animations";
  style.textContent = `
    @keyframes notificationSlideIn {
      from {
        opacity: 0;
        transform: translateX(100%) translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(0) translateY(0);
      }
    }

    @keyframes notificationSlideOut {
      from {
        opacity: 1;
        transform: translateX(0) translateY(0);
      }
      to {
        opacity: 0;
        transform: translateX(100%) translateY(-20px);
      }
    }

    /* Mobile responsiveness */
    @media (max-width: 768px) {
      #admin-notification {
        top: 15px !important;
        right: 15px !important;
        left: 15px !important;
        max-width: none !important;
        min-width: auto !important;
      }
    }
  `;
  document.head.appendChild(style);
}

/* ================== FIXED SECURE API FUNCTIONS ================== */

async function secureRequest(
  endpoint,
  method = "GET",
  data = null,
  options = {}
) {
  const { retries = 3, timeout = 10000 } = options;

  // Check if Supabase is configured
  if (!SUPABASE_CONFIG || !SUPABASE_CONFIG.URL || !SUPABASE_CONFIG.ANON_KEY) {
    throw new Error("Supabase configuration missing. Check config.js");
  }

  const controller = new AbortController();
  const timeoutId = setTimeout(() => controller.abort(), timeout);

  const headers = {
    "Content-Type": "application/json",
    apikey: SUPABASE_CONFIG.ANON_KEY,
    Authorization: `Bearer ${SUPABASE_CONFIG.ANON_KEY}`,
    Prefer: "return=representation",
  };

  const session = secureStorage.getItem("session");
  if (session && session.token) {
    headers["X-Session-Token"] = session.token;
  }

  const config = {
    method: method,
    headers: headers,
    signal: controller.signal,
  };

  if (data && (method === "POST" || method === "PATCH" || method === "PUT")) {
    config.body = JSON.stringify(data);
  }

  for (let attempt = 1; attempt <= retries; attempt++) {
    try {
      console.log(
        `API request ${method} ${endpoint} (attempt ${attempt}/${retries})`
      );

      const response = await fetch(`${SUPABASE_CONFIG.URL}${endpoint}`, config);
      clearTimeout(timeoutId);

      // Handle rate limiting
      if (response.status === 429) {
        const retryAfter = response.headers.get("Retry-After") || 1;
        await new Promise((resolve) => setTimeout(resolve, retryAfter * 1000));
        continue;
      }

      if (!response.ok) {
        const errorData = await response.text();

        // Handle specific error cases
        if (response.status === 401) {
          showNotification(
            "Authentication failed. Please login again.",
            "error"
          );
          logoutAdmin();
          throw new Error("Authentication failed");
        }

        if (response.status === 403) {
          showNotification(
            "Permission denied. Please contact administrator.",
            "error"
          );
          throw new Error("Permission denied");
        }

        if (response.status === 413) {
          showNotification(
            "Image file is too large. Please use a smaller image.",
            "error"
          );
          throw new Error("File too large");
        }

        throw new Error(
          `HTTP ${response.status}: ${errorData.substring(0, 200)}`
        );
      }

      // For DELETE requests that return 204 No Content
      if (method === "DELETE" && response.status === 204) {
        return { success: true, message: "Item deleted successfully" };
      }

      // For successful requests with content
      if (response.status !== 204) {
        const result = await response.json();

        // Cache image data for faster editing
        if (Array.isArray(result)) {
          result.forEach((item) => {
            if (item.image && item.id && tempImageCache.size < 50) {
              tempImageCache.set(item.id, item.image);
            }
          });
        } else if (result.image && result.id && tempImageCache.size < 50) {
          tempImageCache.set(result.id, result.image);
        }

        return result;
      }

      return { success: true };
    } catch (error) {
      clearTimeout(timeoutId);

      if (attempt === retries) {
        console.error("API request failed after retries:", error);

        // User-friendly error messages
        if (error.name === "AbortError") {
          showNotification("Request timeout. Please try again.", "error");
        } else if (error.message.includes("Failed to fetch")) {
          showNotification(
            "Network error. Please check your connection.",
            "error"
          );
        } else if (error.message.includes("CORS")) {
          showNotification(
            "Cross-origin request blocked. Please check configuration.",
            "error"
          );
        } else {
          showNotification(`Operation failed: ${error.message}`, "error");
        }

        throw error;
      }

      // Exponential backoff
      await new Promise((resolve) =>
        setTimeout(resolve, Math.pow(2, attempt) * 1000)
      );
    }
  }
}

// Load data with caching
const dataCache = new Map();
const CACHE_TTL = 60000; // 1 minute

async function loadDataFromSupabase(endpoint, id = null, forceRefresh = false) {
  const cacheKey = id ? `${endpoint}_${id}` : endpoint;

  // Check cache if not forcing refresh
  if (!forceRefresh && dataCache.has(cacheKey)) {
    const cached = dataCache.get(cacheKey);
    if (Date.now() - cached.timestamp < CACHE_TTL) {
      return cached.data;
    }
  }

  try {
    const url = id
      ? `${endpoint}?id=eq.${id}&select=*`
      : `${endpoint}?select=*&order=created_at.desc`;

    const result = await secureRequest(url, "GET");

    // Handle Supabase response format
    let data;
    if (id) {
      // For single item queries, result is an array
      data = Array.isArray(result) && result.length > 0 ? result[0] : null;
    } else {
      // For list queries, result is the array
      data = result || [];
    }

    // Cache the result
    dataCache.set(cacheKey, {
      data,
      timestamp: Date.now(),
    });

    return data;
  } catch (error) {
    console.error(`Error loading from ${endpoint}:`, error);

    // Return cached data if available (even if stale)
    if (dataCache.has(cacheKey)) {
      console.log("Using cached data. Some information may be outdated.");
      return dataCache.get(cacheKey).data;
    }

    console.error("Failed to load data from cloud");
    return id ? null : [];
  }
}

// Clear cache function
function clearDataCache() {
  dataCache.clear();
  tempImageCache.clear();
}

/* ================== FIXED AUTHENTICATION - KEY CHANGES ================== */

// Fixed login attempts storage
let loginAttempts = {
  count: 0,
  timestamp: Date.now(),
  ipKey: "login_attempts",
};

// Enhanced login with rate limiting
const MAX_LOGIN_ATTEMPTS = 5;
const LOCKOUT_TIME = 15 * 60 * 1000; // 15 minutes

async function checkLogin(username, password) {
  try {
    console.log("üîê Login attempt for:", username);

    // Check if locked out
    const storedAttempts = JSON.parse(
      sessionStorage.getItem("login_attempts") || '{"count":0,"timestamp":0}'
    );

    if (storedAttempts.count >= MAX_LOGIN_ATTEMPTS) {
      const timeSinceFirstAttempt = Date.now() - storedAttempts.timestamp;
      if (timeSinceFirstAttempt < LOCKOUT_TIME) {
        const remainingMinutes = Math.ceil(
          (LOCKOUT_TIME - timeSinceFirstAttempt) / 60000
        );
        showNotification(
          `Too many login attempts. Try again in ${remainingMinutes} minutes.`,
          "error"
        );
        return false;
      } else {
        // Reset after lockout period
        sessionStorage.removeItem("login_attempts");
      }
    }

    // Validate username
    const sanitizedUsername = sanitizeInput(username);
    if (sanitizedUsername !== ADMIN_CREDENTIALS.username) {
      console.log("‚ùå Username mismatch");
      storedAttempts.count++;
      storedAttempts.timestamp =
        storedAttempts.count === 1 ? Date.now() : storedAttempts.timestamp;
      sessionStorage.setItem("login_attempts", JSON.stringify(storedAttempts));
      return false;
    }

    console.log("‚úÖ Username matches");

    // Hash password and compare
    const hashedPassword = await hashPassword(password);
    console.log("Generated hash:", hashedPassword.substring(0, 20) + "...");
    console.log(
      "Stored hash:",
      ADMIN_CREDENTIALS.passwordHash.substring(0, 20) + "..."
    );

    const isValid = hashedPassword === ADMIN_CREDENTIALS.passwordHash;
    console.log("Hash match?", isValid);

    if (isValid) {
      // Clear login attempts on success
      sessionStorage.removeItem("login_attempts");

      // Create secure session
      const session = {
        token: generateSessionToken(),
        username: username,
        loginTime: new Date().toISOString(),
        expiresAt: new Date(
          Date.now() + SESSION_TIMEOUT_MINUTES * 60 * 1000
        ).toISOString(),
      };

      secureStorage.setItem("session", session);
      startSessionTimeout();
      setupActivityMonitoring();

      console.log("‚úÖ Login successful!");
      return true;
    } else {
      // Increment failed attempts
      storedAttempts.count++;
      storedAttempts.timestamp =
        storedAttempts.count === 1 ? Date.now() : storedAttempts.timestamp;
      sessionStorage.setItem("login_attempts", JSON.stringify(storedAttempts));

      console.log("‚ùå Password incorrect");
      return false;
    }
  } catch (error) {
    console.error("Login error:", error);
    return false;
  }
}

// Session timeout functions
function startSessionTimeout() {
  if (sessionTimeout) {
    clearTimeout(sessionTimeout);
  }

  sessionTimeout = setTimeout(() => {
    showNotification("Session expired. Please log in again.", "warning");
    logoutAdmin();
  }, SESSION_TIMEOUT_MINUTES * 60 * 1000);
}

function clearSessionTimeout() {
  if (sessionTimeout) {
    clearTimeout(sessionTimeout);
    sessionTimeout = null;
  }
}

function setupActivityMonitoring() {
  const resetSessionTimer = () => {
    if (sessionTimeout) {
      clearTimeout(sessionTimeout);
      startSessionTimeout();
    }
  };

  ["click", "keypress", "mousemove", "scroll"].forEach((event) => {
    document.addEventListener(event, resetSessionTimer, { passive: true });
  });
}

// Enhanced logout
function logoutAdmin() {
  console.log("Logging out admin...");

  // Clear all sensitive data
  currentAdmin = null;
  isEditing = false;
  currentEditId = null;
  clearSessionTimeout();
  clearDataCache();
  secureStorage.removeItem("session");

  // Reset UI
  const loginScreen = document.getElementById("login-screen");
  const adminDashboard = document.getElementById("admin-dashboard");

  if (loginScreen) loginScreen.style.display = "block";
  if (adminDashboard) adminDashboard.style.display = "none";

  // Clear forms
  resetFeaturedForm();
  resetMenuForm();
  resetGalleryForm();

  console.log("‚úÖ Logged out successfully");
}

// FIXED: Password change with enhanced validation
async function changePassword(currentPass, newPass, confirmPass) {
  try {
    // Step 1: Validate current password
    console.log("Verifying current password...");

    // Check current password
    const currentValid = await checkLogin("admin", currentPass);
    if (!currentValid) {
      return { success: false, message: "Current password is incorrect" };
    }

    // Step 2: Validate new password
    if (newPass !== confirmPass) {
      return { success: false, message: "New passwords do not match" };
    }

    if (newPass.length < 8) {
      return {
        success: false,
        message: "Password must be at least 8 characters",
      };
    }

    // Check for common passwords
    const commonPasswords = [
      "password",
      "12345678",
      "qwerty",
      "admin123",
      "tokebakes",
      "toke123",
      "password123",
      "adminadmin",
    ];
    if (commonPasswords.includes(newPass.toLowerCase())) {
      return {
        success: false,
        message: "Password is too common. Please choose a stronger password.",
      };
    }

    // Step 3: Generate new hash
    console.log("Generating secure hash...");
    const newHash = await hashPassword(newPass);

    // Step 4: Update database
    console.log("Updating password in database...");
    const dbResult = await updatePasswordInDatabase(newHash);

    if (!dbResult.success) {
      console.error("Database update failed:", dbResult.message);

      // Use custom popup instead of confirm
      const continueLocal = await showPopup({
        title: "Database Update Failed",
        message: `Failed to update database: ${dbResult.message}\n\nDo you want to update the password locally only?\nYou will need to manually update the database later.`,
        type: "warning",
        showCancel: true,
        cancelText: "Cancel",
        confirmText: "Update Locally",
      });

      if (!continueLocal) {
        return { success: false, message: "Password change cancelled" };
      }

      // Update local only
      ADMIN_CREDENTIALS.passwordHash = newHash;

      console.log(
        "‚úÖ Password updated locally only. Manual database update required."
      );

      return {
        success: true,
        message:
          "Password updated locally only. Manual database update required.",
        requiresManualUpdate: true,
      };
    }

    // Step 5: Update local credentials AFTER successful database update
    ADMIN_CREDENTIALS.passwordHash = newHash;

    // Step 6: Update session
    const session = secureStorage.getItem("session");
    if (session) {
      session.passwordUpdated = new Date().toISOString();
      secureStorage.setItem("session", session);
    }

    // Step 7: Verify sync
    await checkPasswordSync();

    // Step 8: Log success
    console.log(
      `üîí Password changed successfully at ${new Date().toISOString()}`
    );

    return {
      success: true,
      message: "Password updated successfully in both local and database",
      timestamp: new Date().toISOString(),
    };
  } catch (error) {
    console.error("Password change error:", error);

    let userMessage = "Error changing password";
    if (error.message.includes("Failed to fetch")) {
      userMessage = "Network error. Cannot connect to database.";
    } else if (error.message.includes("crypto.subtle")) {
      userMessage = "Browser security error. Try using a modern browser.";
    }

    return { success: false, message: userMessage };
  }
}

/* ================== ENHANCED CONTENT MANAGEMENT ================== */

// Common save function with validation
async function saveItem(itemType, formData) {
  try {
    const endpoints = {
      featured: API_ENDPOINTS.FEATURED,
      menu: API_ENDPOINTS.MENU,
      gallery: API_ENDPOINTS.GALLERY,
    };

    const endpoint = endpoints[itemType];
    if (!endpoint) {
      throw new Error(`Invalid item type: ${itemType}`);
    }

    // Validate required fields
    const requiredFields = {
      featured: ["title", "description", "image"],
      menu: ["title", "description", "price", "image"],
      gallery: ["alt", "image"],
    };

    const missingFields = requiredFields[itemType].filter(
      (field) => !formData[field]
    );
    if (missingFields.length > 0) {
      throw new Error(`Missing required fields: ${missingFields.join(", ")}`);
    }

    // Sanitize text fields
    Object.keys(formData).forEach((key) => {
      if (typeof formData[key] === "string") {
        formData[key] = sanitizeInput(formData[key]);
      }
    });

    // Send to API
    if (isEditing && currentEditId) {
      await secureRequest(
        `${endpoint}?id=eq.${currentEditId}`,
        "PATCH",
        formData
      );
      console.log(`${itemType} item updated successfully!`);
    } else {
      await secureRequest(endpoint, "POST", formData);
      console.log(`${itemType} item added successfully!`);
    }

    // Clear cache for this endpoint
    dataCache.forEach((value, key) => {
      if (key.startsWith(endpoint)) {
        dataCache.delete(key);
      }
    });

    return true;
  } catch (error) {
    console.error(`Error saving ${itemType} item:`, error);
    return false;
  }
}

/* ================== SPECIFIC CONTENT MANAGEMENT FUNCTIONS ================== */

// Featured Items Management
async function renderFeaturedItems() {
  const container = document.getElementById("featured-items-list");
  if (!container) return;

  try {
    const items = await loadDataFromSupabase(API_ENDPOINTS.FEATURED);

    if (!items || items.length === 0) {
      container.innerHTML = `
        <div class="empty-state">
          <i class="fas fa-star"></i>
          <p>No featured items yet. Add your first item!</p>
        </div>
      `;
      return;
    }

    container.innerHTML = items
      .map(
        (item) => `
      <div class="item-card" data-id="${item.id}">
        <img src="${item.image}" alt="${item.title}" class="item-card-img" loading="lazy">
        <div class="item-card-content">
          <h3 class="item-card-title">${item.title}</h3>
          <p class="item-card-desc">${item.description}</p>
          <div class="item-card-actions">
            <button class="btn-edit" onclick="editFeaturedItem('${item.id}')">
              <i class="fas fa-edit"></i> Edit
            </button>
            <button class="btn-delete" onclick="deleteFeaturedItem('${item.id}')">
              <i class="fas fa-trash"></i> Delete
            </button>
          </div>
        </div>
      </div>
    `
      )
      .join("");
  } catch (error) {
    console.error(`Error rendering featured items:`, error);
    container.innerHTML = `
      <div class="empty-state error">
        <i class="fas fa-exclamation-triangle"></i>
        <p>Failed to load featured items. Please check your connection.</p>
      </div>
    `;
  }
}

async function saveFeaturedItem(e) {
  e.preventDefault();

  const title = document.getElementById("featured-title").value.trim();
  const description = document
    .getElementById("featured-description")
    .value.trim();
  const imageFile = document.getElementById("featured-image").files[0];
  const itemId = document.getElementById("featured-id").value;

  try {
    let imageBase64 = "";

    if (imageFile) {
      const compressed = await compressImage(imageFile);
      imageBase64 = compressed.data;
    } else if (isEditing && itemId && tempImageCache.has(itemId)) {
      imageBase64 = tempImageCache.get(itemId);
    } else {
      showPopup({
        title: "Image Required",
        message: "Please select an image",
        type: "error",
        confirmText: "OK",
      });
      return;
    }

    const formData = {
      title,
      description,
      image: imageBase64,
    };

    const success = await saveItem("featured", formData);

    if (success) {
      resetFeaturedForm();
      await renderFeaturedItems();
      await updateItemCounts();
      showNotification("Featured item saved successfully!", "success");
      dataSync.notifyDataChanged(isEditing ? "update" : "create", "featured");
    }
  } catch (error) {
    console.error("Error saving featured item:", error);
    showNotification("Failed to save item", "error");
  }
}

async function editFeaturedItem(id) {
  try {
    const item = await loadDataFromSupabase(API_ENDPOINTS.FEATURED, id);

    if (!item) {
      showNotification("Item not found", "error");
      return;
    }

    document.getElementById("featured-id").value = item.id;
    document.getElementById("featured-title").value = item.title;
    document.getElementById("featured-description").value = item.description;

    const preview = document.getElementById("featured-image-preview");
    preview.innerHTML = `<img src="${item.image}" alt="Current image" style="max-height: 150px; border-radius: 8px;">`;

    document.getElementById("featured-form-container").style.display = "block";
    isEditing = true;
    currentEditId = id;

    document
      .getElementById("featured-form-container")
      .scrollIntoView({ behavior: "smooth" });
  } catch (error) {
    console.error("Error loading featured item for edit:", error);
    showNotification("Failed to load item for editing", "error");
  }
}

// Menu Items Management - FIXED: Price removed from visible display
async function renderMenuItems() {
  const container = document.getElementById("menu-items-list");
  if (!container) return;

  try {
    const items = await loadDataFromSupabase(API_ENDPOINTS.MENU);

    if (!items || items.length === 0) {
      container.innerHTML = `
        <div class="empty-state">
          <i class="fas fa-utensils"></i>
          <p>No menu items yet. Add your first item!</p>
        </div>
      `;
      return;
    }

    container.innerHTML = items
      .map(
        (item) => `
      <div class="item-card" data-id="${item.id}" data-item="${escapeHtml(
          item.title
        )}" data-price="${item.price}">
        <img src="${item.image}" alt="${
          item.title
        }" class="item-card-img" loading="lazy">
        <div class="item-card-content">
          <h3 class="item-card-title">${item.title}</h3>
          <p class="item-card-desc">${item.description}</p>
          <!-- Price is NOT displayed here, only stored in data attributes -->
          <div class="item-card-actions">
            <button class="btn-edit" onclick="editMenuItem('${item.id}')">
              <i class="fas fa-edit"></i> Edit
            </button>
            <button class="btn-delete" onclick="deleteMenuItem('${item.id}')">
              <i class="fas fa-trash"></i> Delete
            </button>
          </div>
        </div>
      </div>
    `
      )
      .join("");
  } catch (error) {
    console.error(`Error rendering menu items:`, error);
    container.innerHTML = `
      <div class="empty-state error">
        <i class="fas fa-exclamation-triangle"></i>
        <p>Failed to load menu items. Please check your connection.</p>
      </div>
    `;
  }
}

async function saveMenuItem(e) {
  e.preventDefault();

  const title = document.getElementById("menu-title").value.trim();
  const description = document.getElementById("menu-description").value.trim();
  const price = document.getElementById("menu-price").value;
  const imageFile = document.getElementById("menu-image").files[0];
  const itemId = document.getElementById("menu-id").value;

  // Validation
  if (price < 0) {
    showNotification("Price must be a positive number", "error");
    return;
  }

  try {
    let imageBase64 = "";

    if (imageFile) {
      const compressed = await compressImage(imageFile);
      imageBase64 = compressed.data;
    } else if (isEditing && itemId && tempImageCache.has(itemId)) {
      imageBase64 = tempImageCache.get(itemId);
    } else {
      showNotification("Please select an image", "error");
      return;
    }

    const formData = {
      title,
      description,
      price: Number(price),
      image: imageBase64,
    };

    const success = await saveItem("menu", formData);

    if (success) {
      resetMenuForm();
      await renderMenuItems();
      await updateItemCounts();
      showNotification("Menu item saved successfully!", "success");
      dataSync.notifyDataChanged(isEditing ? "update" : "create", "menu");
    }
  } catch (error) {
    console.error("Error saving menu item:", error);
    showNotification("Failed to save menu item", "error");
  }
}

async function editMenuItem(id) {
  try {
    const item = await loadDataFromSupabase(API_ENDPOINTS.MENU, id);

    if (!item) {
      showNotification("Menu item not found", "error");
      return;
    }

    document.getElementById("menu-id").value = item.id;
    document.getElementById("menu-title").value = item.title;
    document.getElementById("menu-description").value = item.description;
    document.getElementById("menu-price").value = item.price;

    const preview = document.getElementById("menu-image-preview");
    preview.innerHTML = `<img src="${item.image}" alt="Current image" style="max-height: 150px; border-radius: 8px;">`;

    document.getElementById("menu-form-container").style.display = "block";
    isEditing = true;
    currentEditId = id;

    document
      .getElementById("menu-form-container")
      .scrollIntoView({ behavior: "smooth" });
  } catch (error) {
    console.error("Error loading menu item for edit:", error);
    showNotification("Failed to load menu item for editing", "error");
  }
}

// Gallery Management
async function renderGalleryItems() {
  const container = document.getElementById("gallery-admin-grid");
  if (!container) return;

  try {
    const items = await loadDataFromSupabase(API_ENDPOINTS.GALLERY);

    if (!items || items.length === 0) {
      container.innerHTML = `
        <div class="empty-state">
          <i class="fas fa-images"></i>
          <p>No gallery images yet. Add your first image!</p>
        </div>
      `;
      return;
    }

    container.innerHTML = items
      .map(
        (item) => `
      <div class="gallery-admin-item" data-id="${item.id}">
        <img src="${item.image}" alt="${item.alt}" loading="lazy">
        <div class="gallery-admin-overlay">
          <p><strong>Alt Text:</strong> ${item.alt}</p>
          <div class="gallery-admin-actions">
            <button class="btn-edit" onclick="editGalleryItem('${item.id}')">
              <i class="fas fa-edit"></i> Edit
            </button>
            <button class="btn-delete" onclick="deleteGalleryItem('${item.id}')">
              <i class="fas fa-trash"></i> Delete
            </button>
          </div>
        </div>
      </div>
    `
      )
      .join("");
  } catch (error) {
    console.error(`Error rendering gallery items:`, error);
    container.innerHTML = `
      <div class="empty-state error">
        <i class="fas fa-exclamation-triangle"></i>
        <p>Failed to load gallery items. Please check your connection.</p>
      </div>
    `;
  }
}

async function saveGalleryItem(e) {
  e.preventDefault();

  const alt = document.getElementById("gallery-alt").value.trim();
  const imageFile = document.getElementById("gallery-image").files[0];
  const itemId = document.getElementById("gallery-id").value;

  try {
    let imageBase64 = "";

    if (imageFile) {
      const compressed = await compressImage(imageFile);
      imageBase64 = compressed.data;
    } else if (isEditing && itemId && tempImageCache.has(itemId)) {
      imageBase64 = tempImageCache.get(itemId);
    } else {
      showNotification("Please select an image", "error");
      return;
    }

    const formData = {
      alt,
      image: imageBase64,
    };

    const success = await saveItem("gallery", formData);

    if (success) {
      resetGalleryForm();
      await renderGalleryItems();
      await updateItemCounts();
      showNotification("Gallery image saved successfully!", "success");
      dataSync.notifyDataChanged(isEditing ? "update" : "create", "gallery");
    }
  } catch (error) {
    console.error("Error saving gallery item:", error);
    showNotification("Failed to save gallery item", "error");
  }
}

async function editGalleryItem(id) {
  try {
    const item = await loadDataFromSupabase(API_ENDPOINTS.GALLERY, id);

    if (!item) {
      showNotification("Gallery item not found", "error");
      return;
    }

    document.getElementById("gallery-id").value = item.id;
    document.getElementById("gallery-alt").value = item.alt;

    const preview = document.getElementById("gallery-image-preview");
    preview.innerHTML = `<img src="${item.image}" alt="Current image" style="max-height: 150px; border-radius: 8px;">`;

    document.getElementById("gallery-form-container").style.display = "block";
    isEditing = true;
    currentEditId = id;

    document
      .getElementById("gallery-form-container")
      .scrollIntoView({ behavior: "smooth" });
  } catch (error) {
    console.error("Error loading gallery item for edit:", error);
    showNotification("Failed to load gallery item for editing", "error");
  }
}

/* ================== ENHANCED STORAGE MANAGEMENT ================== */

async function updateStorageUsage() {
  try {
    const [featured, menu, gallery] = await Promise.all([
      loadDataFromSupabase(API_ENDPOINTS.FEATURED),
      loadDataFromSupabase(API_ENDPOINTS.MENU),
      loadDataFromSupabase(API_ENDPOINTS.GALLERY),
    ]);

    const allItems = [...featured, ...menu, ...gallery];
    let totalBytes = 0;

    allItems.forEach((item) => {
      if (item.image) {
        // Base64 size calculation
        const base64Length = item.image.length;
        const padding = item.image.endsWith("==")
          ? 2
          : item.image.endsWith("=")
          ? 1
          : 0;
        totalBytes += (base64Length * 3) / 4 - padding;
      }
    });

    const mbUsed = (totalBytes / (1024 * 1024)).toFixed(2);
    const percentage = Math.min((mbUsed / 500) * 100, 100).toFixed(1);

    // Update UI
    const storageUsedEl = document.getElementById("storage-used");
    const storageFillEl = document.getElementById("storage-fill");
    const storageInfoEl = document.getElementById("storage-info");

    if (storageUsedEl) storageUsedEl.textContent = mbUsed;
    if (storageFillEl) storageFillEl.style.width = `${percentage}%`;
    if (storageInfoEl) storageInfoEl.textContent = `${mbUsed} MB / 500 MB`;

    // Add warnings
    if (mbUsed > 450) {
      showNotification("CRITICAL: Storage usage is at 90%+!", "error");
    } else if (mbUsed > 400) {
      showNotification(
        `Warning: Storage usage is high (${mbUsed}MB).`,
        "warning"
      );
    }

    return { mbUsed, itemCount: allItems.length };
  } catch (error) {
    console.error("Error updating storage usage:", error);
    return { mbUsed: 0, itemCount: 0 };
  }
}

async function updateItemCounts() {
  try {
    const [featured, menu, gallery] = await Promise.all([
      loadDataFromSupabase(API_ENDPOINTS.FEATURED),
      loadDataFromSupabase(API_ENDPOINTS.MENU),
      loadDataFromSupabase(API_ENDPOINTS.GALLERY),
    ]);

    const countFeatured = document.getElementById("count-featured");
    const countMenu = document.getElementById("count-menu");
    const countGallery = document.getElementById("count-gallery");

    if (countFeatured) countFeatured.textContent = featured.length || 0;
    if (countMenu) countMenu.textContent = menu.length || 0;
    if (countGallery) countGallery.textContent = gallery.length || 0;

    await updateStorageUsage();
  } catch (error) {
    console.error("Error updating counts:", error);
  }
}

/* ================== ENHANCED DATA BACKUP/RESTORE ================== */

async function exportData() {
  try {
    showNotification("Preparing export...", "info");

    const [featured, menu, gallery] = await Promise.all([
      loadDataFromSupabase(API_ENDPOINTS.FEATURED),
      loadDataFromSupabase(API_ENDPOINTS.MENU),
      loadDataFromSupabase(API_ENDPOINTS.GALLERY),
    ]);

    const data = {
      featured,
      menu,
      gallery,
      exportDate: new Date().toISOString(),
      version: "2.0.0",
      source: "Toke Bakes CMS",
      itemCount: {
        featured: featured.length,
        menu: menu.length,
        gallery: gallery.length,
      },
    };

    // Create and download file
    const blob = new Blob([JSON.stringify(data, null, 2)], {
      type: "application/json",
    });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = `toke-bakes-backup-${
      new Date().toISOString().split("T")[0]
    }.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);

    showNotification("Data exported successfully!", "success");
  } catch (error) {
    console.error("Error exporting data:", error);
    showNotification("Failed to export data", "error");
  }
}

async function importData(file) {
  try {
    const text = await file.text();
    const data = JSON.parse(text);

    // Validate backup file
    if (!data.featured || !data.menu || !data.gallery) {
      showNotification("Invalid backup file format", "error");
      return;
    }

    const confirmed = await showPopup({
      title: "Import Data",
      message:
        "WARNING: This will replace ALL current data. This action cannot be undone.\n\nAre you sure you want to continue?",
      type: "warning",
      showCancel: true,
      cancelText: "Cancel",
      confirmText: "Import",
    });

    if (!confirmed) {
      return;
    }

    showNotification("Starting import...", "info");

    // Clear existing data
    await Promise.all([
      secureRequest(`${API_ENDPOINTS.FEATURED}?id=gt.0`, "DELETE"),
      secureRequest(`${API_ENDPOINTS.MENU}?id=gt.0`, "DELETE"),
      secureRequest(`${API_ENDPOINTS.GALLERY}?id=gt.0`, "DELETE"),
    ]);

    // Import new data
    const totalItems =
      data.featured.length + data.menu.length + data.gallery.length;
    let imported = 0;

    // Import batches
    const importBatch = async (items, endpoint) => {
      for (const item of items) {
        await secureRequest(endpoint, "POST", item);
        imported++;

        // Small delay to prevent rate limiting
        await new Promise((resolve) => setTimeout(resolve, 100));
      }
    };

    await importBatch(data.featured, API_ENDPOINTS.FEATURED);
    await importBatch(data.menu, API_ENDPOINTS.MENU);
    await importBatch(data.gallery, API_ENDPOINTS.GALLERY);

    // Cleanup
    clearDataCache();

    showNotification(`Successfully imported ${imported} items!`, "success");

    // Refresh displays
    await Promise.all([
      renderFeaturedItems(),
      renderMenuItems(),
      renderGalleryItems(),
    ]);
    await updateItemCounts();

    dataSync.notifyDataChanged("import", "all");
  } catch (error) {
    console.error("Error importing data:", error);
    showNotification("Failed to import data", "error");
  }
}

/* ================== RESET FORM FUNCTIONS ================== */

function resetFeaturedForm() {
  const form = document.getElementById("featured-form");
  if (form) form.reset();
  document.getElementById("featured-id").value = "";
  document.getElementById("featured-image-preview").innerHTML = "";
  document.getElementById("featured-form-container").style.display = "none";
  isEditing = false;
  currentEditId = null;
}

function resetMenuForm() {
  const form = document.getElementById("menu-form");
  if (form) form.reset();
  document.getElementById("menu-id").value = "";
  document.getElementById("menu-image-preview").innerHTML = "";
  document.getElementById("menu-form-container").style.display = "none";
  isEditing = false;
  currentEditId = null;
}

function resetGalleryForm() {
  const form = document.getElementById("gallery-form");
  if (form) form.reset();
  document.getElementById("gallery-id").value = "";
  document.getElementById("gallery-image-preview").innerHTML = "";
  document.getElementById("gallery-form-container").style.display = "none";
  isEditing = false;
  currentEditId = null;
}

/* ================== FIXED INITIALIZATION ================== */

async function initAdminPanel() {
  console.log("üîß Initializing Admin Panel v2.0 (MODERN CONFIRMATION)...");

  // üîí Initialize admin credentials from database
  try {
    await loadPasswordFromDatabase();

    // Check password sync status
    setTimeout(async () => {
      await checkPasswordSync();
    }, 1000);
  } catch (error) {
    console.error("Failed to initialize credentials:", error);
  }

  // Check session
  const session = secureStorage.getItem("session");
  console.log("Session check:", session);

  if (session && session.token) {
    // Check if session is still valid
    const expiresAt = new Date(session.expiresAt);
    if (expiresAt > new Date()) {
      // Valid session, show dashboard
      currentAdmin = session.username;
      document.getElementById("login-screen").style.display = "none";
      document.getElementById("admin-dashboard").style.display = "block";
      startSessionTimeout();
      setupActivityMonitoring();
      console.log("‚úÖ Restored existing session");
    } else {
      // Session expired
      secureStorage.removeItem("session");
      console.log("‚ùå Session expired");
    }
  }

  // Check Supabase configuration
  if (!SUPABASE_CONFIG || !SUPABASE_CONFIG.URL || !SUPABASE_CONFIG.ANON_KEY) {
    const warning = document.createElement("div");
    warning.style.cssText = `
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: #ff6b6b;
      color: white;
      padding: 10px;
      text-align: center;
      z-index: 10000;
      font-weight: bold;
    `;
    warning.textContent =
      "WARNING: Supabase not configured. Please check config.js";
    document.body.appendChild(warning);
    return;
  }

  // Set current year
  const yearElement = document.getElementById("admin-year");
  if (yearElement) {
    yearElement.textContent = new Date().getFullYear();
  }

  // Load initial data if logged in
  if (currentAdmin) {
    try {
      await Promise.all([
        renderFeaturedItems(),
        renderMenuItems(),
        renderGalleryItems(),
      ]);
      await updateItemCounts();
    } catch (error) {
      console.error("Error loading initial data:", error);
    }
  }

  // Setup event listeners
  setupEventListeners();
}

function setupEventListeners() {
  console.log("Setting up event listeners...");

  // Tab switching
  document.querySelectorAll(".admin-tab").forEach((tab) => {
    tab.addEventListener("click", function () {
      const tabId = this.dataset.tab;

      // Update active tab
      document
        .querySelectorAll(".admin-tab")
        .forEach((t) => t.classList.remove("active"));
      this.classList.add("active");

      // Show corresponding content
      document
        .querySelectorAll(".tab-pane")
        .forEach((pane) => pane.classList.remove("active"));
      const targetTab = document.getElementById(`${tabId}-tab`);
      if (targetTab) {
        targetTab.classList.add("active");

        // Refresh storage analysis when settings tab is opened
        if (tabId === "settings") {
          updateItemCounts();
        }
      }

      // Reset any open forms
      resetFeaturedForm();
      resetMenuForm();
      resetGalleryForm();
    });
  });

  // Login form
  const loginForm = document.getElementById("login-form");
  if (loginForm) {
    loginForm.addEventListener("submit", async function (e) {
      e.preventDefault();
      console.log("Login form submitted");

      const username = sanitizeInput(
        document.getElementById("admin-username").value
      );
      const password = document.getElementById("admin-password").value;

      console.log("Attempting login with:", username);

      const isValid = await checkLogin(username, password);
      if (isValid) {
        currentAdmin = username;
        document.getElementById("login-screen").style.display = "none";
        document.getElementById("admin-dashboard").style.display = "block";
        showNotification(`Welcome back, ${username}!`, "success");

        // Load data after successful login
        await Promise.all([
          renderFeaturedItems(),
          renderMenuItems(),
          renderGalleryItems(),
        ]);
        await updateItemCounts();
      } else {
        showNotification("Invalid username or password", "error");
      }
    });
  }

  // Logout
  const logoutBtn = document.getElementById("logout-btn");
  if (logoutBtn) {
    logoutBtn.addEventListener("click", function (e) {
      e.preventDefault();
      logoutAdmin();
    });
  }

  // Form submissions
  const featuredForm = document.getElementById("featured-form");
  const menuForm = document.getElementById("menu-form");
  const galleryForm = document.getElementById("gallery-form");

  if (featuredForm) {
    featuredForm.addEventListener("submit", saveFeaturedItem);
  }
  if (menuForm) {
    menuForm.addEventListener("submit", saveMenuItem);
  }
  if (galleryForm) {
    galleryForm.addEventListener("submit", saveGalleryItem);
  }

  // Change password form
  const passwordForm = document.getElementById("change-password-form");
  if (passwordForm) {
    passwordForm.addEventListener("submit", async function (e) {
      e.preventDefault();
      const currentPass = document.getElementById("current-password").value;
      const newPass = document.getElementById("new-password").value;
      const confirmPass = document.getElementById("confirm-password").value;

      const result = await changePassword(currentPass, newPass, confirmPass);
      if (result.success) {
        showNotification(result.message, "success");
        passwordForm.reset();
      } else {
        showNotification(result.message, "error");
      }
    });
  }

  // Add buttons
  const addFeaturedBtn = document.getElementById("add-featured-btn");
  const addMenuBtn = document.getElementById("add-menu-btn");
  const addGalleryBtn = document.getElementById("add-gallery-btn");

  if (addFeaturedBtn) {
    addFeaturedBtn.addEventListener("click", () => {
      resetFeaturedForm();
      document.getElementById("featured-form-container").style.display =
        "block";
      document
        .getElementById("featured-form-container")
        .scrollIntoView({ behavior: "smooth" });
    });
  }

  if (addMenuBtn) {
    addMenuBtn.addEventListener("click", () => {
      resetMenuForm();
      document.getElementById("menu-form-container").style.display = "block";
      document
        .getElementById("menu-form-container")
        .scrollIntoView({ behavior: "smooth" });
    });
  }

  if (addGalleryBtn) {
    addGalleryBtn.addEventListener("click", () => {
      resetGalleryForm();
      document.getElementById("gallery-form-container").style.display = "block";
      document
        .getElementById("gallery-form-container")
        .scrollIntoView({ behavior: "smooth" });
    });
  }

  // Cancel buttons
  const cancelFeatured = document.getElementById("cancel-featured");
  const cancelMenu = document.getElementById("cancel-menu");
  const cancelGallery = document.getElementById("cancel-gallery");

  if (cancelFeatured) {
    cancelFeatured.addEventListener("click", resetFeaturedForm);
  }
  if (cancelMenu) {
    cancelMenu.addEventListener("click", resetMenuForm);
  }
  if (cancelGallery) {
    cancelGallery.addEventListener("click", resetGalleryForm);
  }

  // Data management buttons
  const exportDataBtn = document.getElementById("export-data");
  const importDataBtn = document.getElementById("import-data");
  const resetDataBtn = document.getElementById("reset-data");
  const importFileInput = document.getElementById("import-file");

  if (exportDataBtn) {
    exportDataBtn.addEventListener("click", exportData);
  }

  if (importDataBtn) {
    importDataBtn.addEventListener("click", () => {
      if (importFileInput) importFileInput.click();
    });
  }

  if (importFileInput) {
    importFileInput.addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (file) {
        importData(file);
      }
      e.target.value = ""; // Reset file input
    });
  }

  if (resetDataBtn) {
    resetDataBtn.addEventListener("click", async () => {
      const confirmed = await showPopup({
        title: "Danger: Delete All Data",
        message:
          'This will PERMANENTLY delete ALL data. This action cannot be undone!\n\nTo confirm, please type "DELETE ALL" in the box below:',
        type: "error",
        showCancel: true,
        cancelText: "Cancel",
        confirmText: "Continue",
      });

      if (!confirmed) {
        return;
      }

      const confirmation = await showPopup({
        title: "Type Confirmation",
        message: 'Please type "DELETE ALL" to confirm deletion:',
        type: "warning",
        showInput: true,
        inputPlaceholder: "Type DELETE ALL here",
        showCancel: true,
        cancelText: "Cancel",
        confirmText: "Delete All",
      });

      if (confirmation !== "DELETE ALL") {
        showNotification("Deletion cancelled", "info");
        return;
      }

      try {
        showNotification("Resetting data...", "info");

        await Promise.all([
          secureRequest(`${API_ENDPOINTS.FEATURED}?id=gt.0`, "DELETE"),
          secureRequest(`${API_ENDPOINTS.MENU}?id=gt.0`, "DELETE"),
          secureRequest(`${API_ENDPOINTS.GALLERY}?id=gt.0`, "DELETE"),
        ]);

        clearDataCache();
        showNotification("All data has been reset!", "success");

        await Promise.all([
          renderFeaturedItems(),
          renderMenuItems(),
          renderGalleryItems(),
        ]);
        await updateItemCounts();

        dataSync.notifyDataChanged("reset", "all");
      } catch (error) {
        console.error("Error resetting data:", error);
        showNotification("Failed to reset data", "error");
      }
    });
  }
}

// Make functions available globally
window.editFeaturedItem = editFeaturedItem;
window.deleteFeaturedItem = deleteFeaturedItem;
window.editMenuItem = editMenuItem;
window.deleteMenuItem = deleteMenuItem;
window.editGalleryItem = editGalleryItem;
window.deleteGalleryItem = deleteGalleryItem;

// Initialize when DOM is loaded
if (document.readyState === "loading") {
  document.addEventListener("DOMContentLoaded", initAdminPanel);
} else {
  initAdminPanel();
}

/* ================== FINAL OPTIMIZATIONS ================== */

// Add connection status indicator
function setupConnectionMonitor() {
  window.addEventListener("online", () => {
    showNotification("‚úÖ Back online - Sync active", "success");
  });

  window.addEventListener("offline", () => {
    showNotification("‚ö†Ô∏è Offline - Working locally", "warning");
  });
}

// Add to initAdminPanel
setupConnectionMonitor();

console.log("‚úÖ Toke Bakes Admin Panel v2.0 - MODERN CONFIRMATION SYSTEM");

--- FILE: ./config.js ---
// config.js - WORKING VERSION (FIXED)
const SUPABASE_CONFIG = {
  URL: "https://lmqoflcikfcxoeyinjus.supabase.co",
  ANON_KEY:
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxtcW9mbGNpa2ZjeG9leWluanVzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUyMzAyOTQsImV4cCI6MjA4MDgwNjI5NH0.eiKT9S_HHtNUO0yXHHDE-rfL8BhZXj5p90mT4FKdpWo",
};

const API_ENDPOINTS = {
  GALLERY: "/rest/v1/gallery",
  FEATURED: "/rest/v1/featured_items",
  MENU: "/rest/v1/menu_items",
};

window.SUPABASE_CONFIG = SUPABASE_CONFIG;
window.API_ENDPOINTS = API_ENDPOINTS;

--- FILE: ./gallery.html ---
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gallery | Toke Bakes</title>
    <link rel="icon" href="images/favicon.webp" type="image/webp" />
    <link rel="stylesheet" href="style.css?v=6" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
  </head>

  <body>
    <header>
      <div class="header-inner">
        <div class="brand">
          <img src="images/logo.webp" alt="logo" class="logo-sm" />
          <h1>Toke Bakes</h1>
        </div>
        <nav class="navbar">
          <!-- Navigation links (visible on desktop) -->
          <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="menu.html">Menu</a></li>
            <li><a href="gallery.html">Gallery</a></li>
          </ul>

          <!-- Cart -->
          <a href="order.html" class="cart-link">
            <i class="fas fa-shopping-cart"></i>
            <span id="cart-count">0</span>
          </a>

          <!-- Theme toggle -->
          <button
            class="theme-toggle"
            id="themeToggle"
            aria-label="Toggle theme"
          >
            <i class="fas fa-sun icon sun"></i>
            <i class="fas fa-moon icon moon"></i>
          </button>

          <!-- Hamburger menu (visible on mobile only) -->
          <button class="navbar-toggle" id="navbarToggle">
            <i class="fas fa-bars"></i>
          </button>
        </nav>
      </div>
    </header>

    <main>
      <section class="gallery-section">
        <h2>Our Creations</h2>
        <p class="lead">
          Browse handcrafted cakes, cupcakes and dessert tables.
        </p>

        <div id="gallery-container" class="gallery-grid">
          <!-- Content will be loaded dynamically by JavaScript -->
          <div class="loading-message">Loading gallery images...</div>
        </div>
      </section>
    </main>

    <footer class="bakes-footer">
      <div class="footer-content">
        <div class="footer-brand">
          <h3>Toke Bakes</h3>
          <p class="tagline">Taking Love, One Slice at a Time</p>
        </div>

        <div class="footer-info">
          <!-- Phone should be a clickable link, not just text -->
          <a href="tel:07063466822" class="phone-link">
            <i class="fas fa-phone"></i>
            <span>07063466822</span>
          </a>

          <div class="social-links">
            <span class="follow-text">Follow Us</span>
            <div class="social-icons">
              <a href="#" class="social-icon" aria-label="Instagram">
                <i class="fab fa-instagram"></i>
              </a>
              <a href="#" class="social-icon" aria-label="TikTok">
                <i class="fab fa-tiktok"></i>
              </a>
            </div>
          </div>
        </div>
      </div>

      <div class="footer-bottom">
        <!-- Add legal-link class to these -->
        <div class="legal-links">
          <a href="privacy.html" class="legal-link">Privacy Policy</a>
          <a href="terms-of-use.html" class="legal-link">Terms of Use</a>
        </div>
        <p class="copyright">
          &copy; <span id="current-year">2024</span> Toke Bakes. All rights
          reserved.
        </p>
      </div>
    </footer>

    <script src="config.js?v=6"></script>
    <script src="script.js?v=6"></script>
  </body>
</html>

--- FILE: ./index.html ---
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Toke Bakes ‚Äî Home</title>
    <link rel="icon" href="images/favicon.webp" type="image/webp" />
    <link rel="stylesheet" href="style.css?v=6" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
  </head>
  <body>
    <div id="loader"><img src="images/logo.webp" alt="Toke Bakes" /></div>

    <header>
      <div class="header-inner">
        <div class="brand">
          <img src="images/logo.webp" alt="Toke Bakes logo" class="logo-sm" />
          <h1>Toke Bakes</h1>
        </div>
        <nav class="navbar">
          <!-- Navigation links (visible on desktop) -->
          <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="menu.html">Menu</a></li>
            <li><a href="gallery.html">Gallery</a></li>
          </ul>

          <!-- Cart -->
          <a href="order.html" class="cart-link">
            <i class="fas fa-shopping-cart"></i>
            <span id="cart-count">0</span>
          </a>

          <!-- Theme toggle -->
          <button
            class="theme-toggle"
            id="themeToggle"
            aria-label="Toggle theme"
          >
            <i class="fas fa-sun icon sun"></i>
            <i class="fas fa-moon icon moon"></i>
          </button>

          <!-- Hamburger menu (visible on mobile only) -->
          <button class="navbar-toggle" id="navbarToggle">
            <i class="fas fa-bars"></i>
          </button>
        </nav>
      </div>
    </header>

    <main>
      <section class="hero">
        <img src="images/logo.webp" alt="Toke Bakes logo" class="hero-logo" />
        <h2>Baking Love, One Slice at a Time</h2>
        <p class="lead">
          Artisan cakes, cupcakes & pastries baked with passion and precision.
          Small-batch, handcrafted, unforgettable.
        </p>
        <a class="btn" href="menu.html">Explore Our Menu</a>
      </section>

      <section class="about-preview">
        <h3>Our Story</h3>
        <p>
          Founded in 2020, Toke Bakes blends traditional techniques with modern
          flavors. From custom wedding cakes to everyday treats, our goal is to
          make every moment sweeter.
        </p>
        <div class="about-features">
          <div class="feature">
            <h4>Handcrafted</h4>
            <p>Every item is made by hand with attention to detail.</p>
          </div>
          <div class="feature">
            <h4>Premium Ingredients</h4>
            <p>
              We only use the best ingredients: real butter, quality chocolate,
              and fresh fruit.
            </p>
          </div>
          <div class="feature">
            <h4>Tell us your vision</h4>
            <p>we bring it to life with flavor and style.</p>
          </div>
        </div>
      </section>

      <section class="featured">
        <h3>Featured Creations</h3>
        <div id="featured-container" class="featured-grid">
          <!-- Content will be loaded dynamically by JavaScript -->
          <div class="loading-message">Loading featured items...</div>
        </div>
      </section>
    </main>

    <footer class="bakes-footer">
      <div class="footer-content">
        <div class="footer-brand">
          <h3>Toke Bakes</h3>
          <p class="tagline">Taking Love, One Slice at a Time</p>
        </div>

        <div class="footer-info">
          <!-- Phone should be a clickable link, not just text -->
          <a href="tel:07063466822" class="phone-link">
            <i class="fas fa-phone"></i>
            <span>07063466822</span>
          </a>

          <div class="social-links">
            <span class="follow-text">Follow Us</span>
            <div class="social-icons">
              <a href="#" class="social-icon" aria-label="Instagram">
                <i class="fab fa-instagram"></i>
              </a>
              <a href="#" class="social-icon" aria-label="TikTok">
                <i class="fab fa-tiktok"></i>
              </a>
            </div>
          </div>
        </div>
      </div>

      <div class="footer-bottom">
        <!-- Add legal-link class to these -->
        <div class="legal-links">
          <a href="privacy.html" class="legal-link">Privacy Policy</a>
          <a href="terms-of-use.html" class="legal-link">Terms of Use</a>
        </div>
        <p class="copyright">
          &copy; <span id="current-year">2024</span> Toke Bakes. All rights
          reserved.
        </p>
      </div>
    </footer>

    <script src="config.js?v=6"></script>
    <script src="script.js?v=6"></script>
  </body>
</html>

--- FILE: ./menu.html ---
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Menu | Toke Bakes</title>
    <link rel="icon" href="images/favicon.webp" type="image/webp" />
    <link rel="stylesheet" href="style.css?v=6" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
  </head>

  <body>
    <header>
      <div class="header-inner">
        <div class="brand">
          <img src="images/logo.webp" alt="Toke Bakes logo" class="logo-sm" />
          <h1>Toke Bakes</h1>
        </div>
        <nav class="navbar">
          <!-- Navigation links (visible on desktop) -->
          <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="menu.html">Menu</a></li>
            <li><a href="gallery.html">Gallery</a></li>
          </ul>

          <!-- Cart -->
          <a href="order.html" class="cart-link">
            <i class="fas fa-shopping-cart"></i>
            <span id="cart-count">0</span>
          </a>

          <!-- Theme toggle -->
          <button
            class="theme-toggle"
            id="themeToggle"
            aria-label="Toggle theme"
          >
            <i class="fas fa-sun icon sun"></i>
            <i class="fas fa-moon icon moon"></i>
          </button>

          <!-- Hamburger menu (visible on mobile only) -->
          <button class="navbar-toggle" id="navbarToggle">
            <i class="fas fa-bars"></i>
          </button>
        </nav>
      </div>
    </header>

    <main>
      <section class="menu-section">
        <h2>Our Signature Menu</h2>
        <p class="lead">
          Tap an item for options ‚Äî add to cart or order now. Items are saved
          locally so you can browse freely.
        </p>

        <div id="menu-container" class="menu-grid">
          <!-- Content will be loaded dynamically by JavaScript -->
          <div class="loading-message">Loading menu items...</div>
        </div>
      </section>
    </main>

    <footer class="bakes-footer">
      <div class="footer-content">
        <div class="footer-brand">
          <h3>Toke Bakes</h3>
          <p class="tagline">Taking Love, One Slice at a Time</p>
        </div>

        <div class="footer-info">
          <!-- Phone should be a clickable link, not just text -->
          <a href="tel:07063466822" class="phone-link">
            <i class="fas fa-phone"></i>
            <span>07063466822</span>
          </a>

          <div class="social-links">
            <span class="follow-text">Follow Us</span>
            <div class="social-icons">
              <a href="#" class="social-icon" aria-label="Instagram">
                <i class="fab fa-instagram"></i>
              </a>
              <a href="#" class="social-icon" aria-label="TikTok">
                <i class="fab fa-tiktok"></i>
              </a>
            </div>
          </div>
        </div>
      </div>

      <div class="footer-bottom">
        <!-- Add legal-link class to these -->
        <div class="legal-links">
          <a href="privacy.html" class="legal-link">Privacy Policy</a>
          <a href="terms-of-use.html" class="legal-link">Terms of Use</a>
        </div>
        <p class="copyright">
          &copy; <span id="current-year">2024</span> Toke Bakes. All rights
          reserved.
        </p>
      </div>
    </footer>

    <script src="config.js?v=6"></script>
    <script src="script.js?v=6"></script>
  </body>
</html>

--- FILE: ./order.html ---
<!-- ================== order.html ================== -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Toke Bakes ‚Äî Your Order</title>
    <link rel="icon" href="images/favicon.webp" type="image/webp" />
    <link rel="stylesheet" href="style.css?v=6" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
  </head>
  <body>
    <header>
      <div class="header-inner">
        <div class="brand">
          <img src="images/logo.webp" alt="logo" class="logo-sm" />
          <h1>Toke Bakes</h1>
        </div>
        <nav class="navbar">
          <!-- Navigation links (visible on desktop) -->
          <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="menu.html">Menu</a></li>
            <li><a href="gallery.html">Gallery</a></li>
          </ul>

          <!-- Cart -->
          <a href="order.html" class="cart-link">
            <i class="fas fa-shopping-cart"></i>
            <span id="cart-count">0</span>
          </a>

          <!-- Theme toggle -->
          <button
            class="theme-toggle"
            id="themeToggle"
            aria-label="Toggle theme"
          >
            <i class="fas fa-sun icon sun"></i>
            <i class="fas fa-moon icon moon"></i>
          </button>

          <!-- Hamburger menu (visible on mobile only) -->
          <button class="navbar-toggle" id="navbarToggle">
            <i class="fas fa-bars"></i>
          </button>
        </nav>
      </div>
    </header>

    <main>
      <section class="order-section">
        <h2>Your Cart</h2>
        <p class="lead">
          Review the items you have added. Adjust quantities or remove items.
          When ready, click <strong>Proceed to Order</strong> to open Gmail or
          WhatsApp with your order pre-filled.
        </p>
        <div id="cart-container"><!-- Cart items inserted here by JS --></div>
        <div class="order-actions">
          <button id="clear-cart" class="btn-secondary">Clear Cart</button>
          <button id="proceed-order" class="btn">Proceed to Order</button>
        </div>
      </section>
    </main>

    <footer class="bakes-footer">
      <div class="footer-content">
        <div class="footer-brand">
          <h3>Toke Bakes</h3>
          <p class="tagline">Taking Love, One Slice at a Time</p>
        </div>

        <div class="footer-info">
          <!-- Phone should be a clickable link, not just text -->
          <a href="tel:07063466822" class="phone-link">
            <i class="fas fa-phone"></i>
            <span>07063466822</span>
          </a>

          <div class="social-links">
            <span class="follow-text">Follow Us</span>
            <div class="social-icons">
              <a href="#" class="social-icon" aria-label="Instagram">
                <i class="fab fa-instagram"></i>
              </a>
              <a href="#" class="social-icon" aria-label="TikTok">
                <i class="fab fa-tiktok"></i>
              </a>
            </div>
          </div>
        </div>
      </div>

      <div class="footer-bottom">
        <!-- Add legal-link class to these -->
        <div class="legal-links">
          <a href="privacy.html" class="legal-link">Privacy Policy</a>
          <a href="terms-of-use.html" class="legal-link">Terms of Use</a>
        </div>
        <p class="copyright">
          &copy; <span id="current-year">2024</span> Toke Bakes. All rights
          reserved.
        </p>
      </div>
    </footer>

    <script src="config.js?v=6"></script>
    <script src="script.js?v=6"></script>
  </body>
</html>

--- FILE: ./privacy.html ---
<!-- ================== privacy.html ================== -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Privacy Policy ‚Äî Toke Bakes</title>
    <link rel="icon" href="images/logo.webp" type="image/webp" />
    <link rel="stylesheet" href="style.css?v=6" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
  </head>
  <body>
    <!-- Header -->
    <header>
      <div class="header-inner">
        <div class="brand">
          <img src="images/logo.webp" alt="Toke Bakes logo" class="logo-sm" />
          <h1>Toke Bakes</h1>
        </div>
        <nav class="navbar">
          <!-- Navigation links (visible on desktop) -->
          <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="menu.html">Menu</a></li>
            <li><a href="gallery.html">Gallery</a></li>
          </ul>

          <!-- Cart -->
          <a href="order.html" class="cart-link">
            <i class="fas fa-shopping-cart"></i>
            <span id="cart-count">0</span>
          </a>

          <!-- Theme toggle -->
          <button
            class="theme-toggle"
            id="themeToggle"
            aria-label="Toggle theme"
          >
            <i class="fas fa-sun icon sun"></i>
            <i class="fas fa-moon icon moon"></i>
          </button>

          <!-- Hamburger menu (visible on mobile only) -->
          <button class="navbar-toggle" id="navbarToggle">
            <i class="fas fa-bars"></i>
          </button>
        </nav>
      </div>
    </header>

    <!-- Main Content -->
    <main class="content-wrapper legal-content">
      <h1>Privacy Policy</h1>
      <p><strong>Last updated:</strong> November 2025</p>

      <p>
        At <strong>Toke Bakes</strong>, we respect your privacy. We collect only
        the information necessary to process orders and contact you. Requests
        for access, correction or deletion may be sent to
        <a href="mailto:hello@tokebakes.com">hello@tokebakes.com</a>.
      </p>

      <h2>Information We Collect</h2>
      <p>
        Contact and order details provided when you place an order, such as your
        name, email address, delivery information, and order preferences.
      </p>

      <h2>How We Use Information</h2>
      <p>
        To process orders, respond to enquiries, and send updates if you opt in.
        We do not sell or share your data with third parties.
      </p>
    </main>

    <!-- Footer -->
    <footer class="bakes-footer">
      <div class="footer-content">
        <div class="footer-brand">
          <h3>Toke Bakes</h3>
          <p class="tagline">Taking Love, One Slice at a Time</p>
        </div>

        <div class="footer-info">
          <!-- Phone should be a clickable link, not just text -->
          <a href="tel:07063466822" class="phone-link">
            <i class="fas fa-phone"></i>
            <span>07063466822</span>
          </a>

          <div class="social-links">
            <span class="follow-text">Follow Us</span>
            <div class="social-icons">
              <a href="#" class="social-icon" aria-label="Instagram">
                <i class="fab fa-instagram"></i>
              </a>
              <a href="#" class="social-icon" aria-label="TikTok">
                <i class="fab fa-tiktok"></i>
              </a>
            </div>
          </div>
        </div>
      </div>

      <div class="footer-bottom">
        <!-- Add legal-link class to these -->
        <div class="legal-links">
          <a href="privacy.html" class="legal-link">Privacy Policy</a>
          <a href="terms-of-use.html" class="legal-link">Terms of Use</a>
        </div>
        <p class="copyright">
          &copy; <span id="current-year">2024</span> Toke Bakes. All rights
          reserved.
        </p>
      </div>
    </footer>

    <script src="config.js?v=6"></script>
    <script src="script.js?v=6"></script>
  </body>
</html>

--- FILE: ./script.js ---
/* ================== script.js - TOKE BAKES WEBSITE ================== */
/* ================== CRITICAL: PREVENT THEME FLASH & TOGGLE FIX ================== */
// This runs IMMEDIATELY when script loads, before any rendering
(function preventThemeFlash() {
  // 1. Check localStorage for saved theme
  const savedTheme = localStorage.getItem("toke_bakes_theme");

  // 2. Determine which theme to use
  let theme;
  if (savedTheme) {
    theme = savedTheme;
  } else {
    const prefersDark = window.matchMedia(
      "(prefers-color-scheme: dark)"
    ).matches;
    theme = prefersDark ? "dark" : "light";
  }

  // 3. Apply theme IMMEDIATELY to HTML element
  document.documentElement.setAttribute("data-theme", theme);

  // 4. Update footer IMMEDIATELY too (CRITICAL FIX!)
  updateFooterTheme(theme);

  // 5. FIX THEME TOGGLE ICON IMMEDIATELY - CRITICAL!
  // Set the correct icon BEFORE the page renders
  setTimeout(() => {
    const themeToggle = document.getElementById("themeToggle");
    if (themeToggle) {
      const sunIcon = themeToggle.querySelector(".sun");
      const moonIcon = themeToggle.querySelector(".moon");

      if (theme === "dark") {
        if (sunIcon) sunIcon.style.display = "none";
        if (moonIcon) moonIcon.style.display = "inline-block";
        themeToggle.classList.add("dark");
      } else {
        if (sunIcon) sunIcon.style.display = "inline-block";
        if (moonIcon) moonIcon.style.display = "none";
        themeToggle.classList.remove("dark");
      }
    }
  }, 0);

  // 6. Disable CSS transitions during initial page load
  document.documentElement.style.transition = "none";
  document.body.style.transition = "none";

  // 7. Re-enable transitions after page is fully loaded
  window.addEventListener("load", function () {
    setTimeout(function () {
      document.documentElement.style.transition = "";
      document.body.style.transition = "";
    }, 10);
  });
})();

/* ================== ENHANCED AUTO-UPDATE SYSTEM ================== */
class WebsiteAutoUpdater {
  constructor() {
    this.lastUpdateKey = "toke_bakes_last_update";
    this.broadcastChannel = null;
    this.pollingInterval = null;
    this.init();
  }

  init() {
    console.log("üîß Initializing Enhanced WebsiteAutoUpdater...");

    // 1. Setup BroadcastChannel for instant sync (same browser tabs)
    if (typeof BroadcastChannel !== "undefined") {
      this.broadcastChannel = new BroadcastChannel("toke_bakes_data_updates");
      this.broadcastChannel.onmessage = (event) => {
        if (event.data.type === "DATA_UPDATED") {
          console.log("üì° BroadcastChannel update received!", event.data);
          this.refreshDataWithUI();
        }
      };
      console.log("‚úÖ BroadcastChannel ready for instant sync");
    }

    // 2. Check for updates every 25 seconds
    this.startPolling(25000); // 25 seconds

    // 3. Check when user returns to tab
    document.addEventListener("visibilitychange", () => {
      if (!document.hidden) {
        console.log("üëÅÔ∏è Tab became visible, checking for updates...");
        this.checkForUpdates();
      }
    });

    // 4. Initial check on page load
    setTimeout(() => this.checkForUpdates(), 3000);
  }

  startPolling(interval = 25000) {
    if (this.pollingInterval) clearInterval(this.pollingInterval);
    this.pollingInterval = setInterval(() => {
      this.checkForUpdates();
    }, interval);
    console.log(`‚úÖ Polling started (every ${interval / 1000}s)`);
  }

  async checkForUpdates() {
    const lastUpdate = localStorage.getItem(this.lastUpdateKey);
    const myLastCheck = localStorage.getItem("my_last_check") || "0";

    if (lastUpdate && lastUpdate > myLastCheck) {
      console.log("üîÑ Update detected via localStorage/timestamp");
      localStorage.setItem("my_last_check", lastUpdate);
      await this.refreshDataWithUI();
      return true;
    }
    return false;
  }

  async refreshDataWithUI() {
    // Show syncing indicator
    this.showSyncIndicator("syncing");

    try {
      console.log("üîÑ Refreshing website data...");

      // Clear ALL caches aggressively
      if (window.cachedMenuItems) {
        window.cachedMenuItems = null;
        window.cacheTimestamp = null;
      }

      // Clear dataCache if it exists (from admin.js)
      if (window.dataCache && window.dataCache.clear) {
        window.dataCache.clear();
      }

      // Reload content based on current page
      if (typeof loadDynamicContent === "function") {
        await loadDynamicContent();
        console.log("‚úÖ Dynamic content reloaded");
      }

      // Also refresh cart if on order page
      if (
        window.location.pathname.includes("order") &&
        typeof renderCartOnOrderPage === "function"
      ) {
        await renderCartOnOrderPage(true);
        console.log("‚úÖ Cart refreshed");
      }

      // Show success indicator
      this.showSyncIndicator("updated");

      // Show notification
      this.showUpdateNotification();

      // Hide indicator after 2 seconds
      setTimeout(() => {
        this.hideSyncIndicator();
      }, 2000);
    } catch (error) {
      console.error("‚ùå Sync refresh failed:", error);
      this.hideSyncIndicator();

      // Show error state briefly
      this.showSyncIndicator("error");
      setTimeout(() => this.hideSyncIndicator(), 3000);
    }
  }

  showSyncIndicator(state) {
    let indicator = document.getElementById("sync-status-indicator");

    if (!indicator) {
      // Create indicator if it doesn't exist
      indicator = document.createElement("div");
      indicator.id = "sync-status-indicator";
      document.body.appendChild(indicator);
    }

    // Reset classes
    indicator.className = "";

    // Set state
    if (state === "syncing") {
      indicator.classList.add("syncing");
      indicator.innerHTML = "‚ü≥";
      indicator.title = "Updating content...";
    } else if (state === "updated") {
      indicator.classList.add("updated");
      indicator.innerHTML = "‚úì";
      indicator.title = "Content updated!";
    } else if (state === "error") {
      indicator.style.cssText = `
        position: fixed; bottom: 20px; right: 20px;
        width: 40px; height: 40px; border-radius: 50%;
        background: #dc3545; color: white; display: flex;
        align-items: center; justify-content: center;
        font-size: 1.2rem; z-index: 10000;
      `;
      indicator.innerHTML = "!";
      indicator.title = "Update failed";
    }
  }

  hideSyncIndicator() {
    const indicator = document.getElementById("sync-status-indicator");
    if (indicator) {
      indicator.style.display = "none";
      indicator.className = "";
    }
  }

  showUpdateNotification() {
    // Optional: You can enable this for visual toast
    // For now, just log to console
    console.log("‚úÖ Website content updated successfully!");

    // If you want a toast notification later, uncomment:
    /*
    showNotification('Content updated! New items are available.', 'success');
    */
  }
}

// ================== DATA SOURCE CONFIGURATION ==================

const useSupabase = true; // Always use Supabase

// ================== DATA LOADING FUNCTIONS ==================

// Cache for menu items to reduce API calls
let cachedMenuItems = null;
let cacheTimestamp = null;
const CACHE_DURATION = 5 * 60 * 1000; // 5 minutes

// Load from Supabase
async function loadFromSupabase(endpoint) {
  try {
    // Check if Supabase config is available
    if (
      !window.SUPABASE_CONFIG ||
      !window.SUPABASE_CONFIG.URL ||
      !window.SUPABASE_CONFIG.ANON_KEY
    ) {
      console.error("Supabase configuration not found in script.js");
      return [];
    }

    const response = await fetch(
      `${SUPABASE_CONFIG.URL}${endpoint}?select=*&order=created_at.desc`,
      {
        headers: {
          apikey: SUPABASE_CONFIG.ANON_KEY,
          Authorization: `Bearer ${SUPABASE_CONFIG.ANON_KEY}`,
          "Content-Type": "application/json",
        },
        cache: "no-cache",
      }
    );

    if (!response.ok) {
      console.warn(`Failed to load from ${endpoint}:`, response.status);
      return [];
    }

    const data = await response.json();
    return Array.isArray(data) ? data : [];
  } catch (error) {
    console.error(`Error loading from Supabase ${endpoint}:`, error);
    return [];
  }
}

// Get menu items with caching
async function getMenuItems() {
  const now = Date.now();

  if (
    cachedMenuItems &&
    cacheTimestamp &&
    now - cacheTimestamp < CACHE_DURATION
  ) {
    return cachedMenuItems;
  }

  cachedMenuItems = await loadFromSupabase(API_ENDPOINTS.MENU);
  cacheTimestamp = now;
  return cachedMenuItems;
}

// Load featured items
async function loadFeaturedItems() {
  const container = document.getElementById("featured-container");
  if (!container) return;

  try {
    const items = await loadFromSupabase(API_ENDPOINTS.FEATURED);

    if (!items || items.length === 0) {
      container.innerHTML = `
        <div class="empty-state">
          <i class="fas fa-star"></i>
          <p>Featured items coming soon! Check back later.</p>
        </div>
      `;
      return;
    }

    // Generate HTML from data
    container.innerHTML = items
      .map(
        (item) => `
          <article class="featured-item">
            <img src="${item.image}" alt="${
          item.title
        }" loading="lazy" onerror="this.onerror=null; this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZmZlNWNjIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIyNCIgZmlsbD0iIzMzMyIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkZlYXR1cmVkPC90ZXh0Pjwvc3ZnPg=='">
            <h4>${escapeHtml(item.title)}</h4>
            <p>${escapeHtml(item.description)}</p>
          </article>
        `
      )
      .join("");
  } catch (error) {
    console.error("Error loading featured items:", error);
    container.innerHTML = `
      <div class="empty-state error">
        <i class="fas fa-exclamation-triangle"></i>
        <p>Unable to load featured items. Please try again later.</p>
      </div>
    `;
  }
}

// Load menu items - FIXED: Price removed from visible display
async function loadMenuItems() {
  const container = document.getElementById("menu-container");
  if (!container) return;

  try {
    const items = await getMenuItems();

    if (!items || items.length === 0) {
      container.innerHTML = `
        <div class="empty-state">
          <i class="fas fa-utensils"></i>
          <p>Our menu is being updated. Please check back soon!</p>
        </div>
      `;
      return;
    }

    // Generate HTML from data - Price is NOT displayed directly
    container.innerHTML = items
      .map(
        (item) => `
          <div class="menu-item" data-item="${escapeHtml(
            item.title
          )}" data-price="${item.price}" data-id="${item.id || ""}">
            <img src="${item.image}" alt="${
          item.title
        }" loading="lazy" onerror="this.onerror=null; this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZmZlNWNjIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIyNCIgZmlsbD0iIzMzMyIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk1lbnUgSXRlbTwvdGV4dD48L3N2Zz4='">
            <h3>${escapeHtml(item.title)}</h3>
            <p>${escapeHtml(item.description)}</p>
            <!-- Price is NOT displayed here - only in data attributes and popup -->
            <div class="popup">
              <button class="add-cart">Add to Cart</button>
              <a class="order-now" href="#">Order Now</a>
            </div>
          </div>
        `
      )
      .join("");
  } catch (error) {
    console.error("Error loading menu items:", error);
    container.innerHTML = `
      <div class="empty-state error">
        <i class="fas fa-exclamation-triangle"></i>
        <p>Unable to load menu items. Please try again later.</p>
      </div>
    `;
  }
}

// Load gallery images
async function loadGalleryImages() {
  const container = document.getElementById("gallery-container");
  if (!container) return;

  try {
    const items = await loadFromSupabase(API_ENDPOINTS.GALLERY);

    if (!items || items.length === 0) {
      container.innerHTML = `
        <div class="empty-state">
          <i class="fas fa-images"></i>
          <p>Gallery coming soon! Check back later.</p>
        </div>
      `;
      return;
    }

    // Generate HTML from data
    container.innerHTML = items
      .map(
        (item) => `
          <img src="${item.image}" alt="${item.alt}" loading="lazy" onerror="this.onerror=null; this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZmZlNWNjIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcrialCIgZm9udC1zaXplPSIyNCIgZmlsbD0iIzMzMyIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkdhbGxlcnk8L3RleHQ+PC9zdmc+='">
        `
      )
      .join("");
  } catch (error) {
    console.error("Error loading gallery images:", error);
    container.innerHTML = `
      <div class="empty-state error">
        <i class="fas fa-exclamation-triangle"></i>
        <p>Unable to load gallery. Please try again later.</p>
      </div>
    `;
  }
}

// Load dynamic content based on page
async function loadDynamicContent() {
  const currentPage = window.location.pathname.split("/").pop() || "index.html";

  console.log("Loading content for page:", currentPage);

  // Check if Supabase config exists
  if (!window.SUPABASE_CONFIG || !window.API_ENDPOINTS) {
    console.error("Supabase configuration not loaded");
    showConfigError();
    return;
  }

  if (
    currentPage.includes("index") ||
    currentPage === "" ||
    currentPage === "/"
  ) {
    await loadFeaturedItems();
  } else if (currentPage.includes("menu")) {
    await loadMenuItems();
  } else if (currentPage.includes("gallery")) {
    await loadGalleryImages();
  }
}

function showConfigError() {
  const containers = document.querySelectorAll(
    "#featured-container, #menu-container, #gallery-container"
  );
  containers.forEach((container) => {
    if (container) {
      container.innerHTML = `
        <div class="empty-state error">
          <i class="fas fa-exclamation-triangle"></i>
          <p>Website configuration error. Please check config.js file.</p>
        </div>
      `;
    }
  });
}

// ================== ORIGINAL TOKE BAKES CODE ==================

const currentPage = (() => {
  const p = window.location.pathname.split("/").pop();
  return p === "" ? "index.html" : p;
})();

/* Storage keys */
const CART_KEY = "toke_bakes_cart_v1";
const THEME_KEY = "toke_bakes_theme";

/* Business info */
const BUSINESS_PHONE_E164 = "+234 706 346 6822";
const BUSINESS_PHONE_WAME = "2347063466822";
const BUSINESS_EMAIL = "tokebakes@gmail.com";

/* Utility functions */
function readCart() {
  try {
    return JSON.parse(localStorage.getItem(CART_KEY)) || [];
  } catch {
    return [];
  }
}

function saveCart(cart) {
  localStorage.setItem(CART_KEY, JSON.stringify(cart));
  refreshCartCount();
}

function formatPrice(num) {
  return Number(num).toLocaleString("en-NG");
}

// Escape HTML for security (already defined in admin.js, but defined here too)
function escapeHtml(text) {
  const div = document.createElement("div");
  div.textContent = text;
  return div.innerHTML;
}

/* ================== CART VALIDATION FUNCTIONS ================== */

// NEW: Validate cart items against current menu
async function validateCartItems() {
  try {
    const cart = readCart();
    if (cart.length === 0) return { valid: true, items: [] };

    // Load current menu items using cache
    const currentMenu = await getMenuItems();

    const validationResults = [];
    let hasChanges = false;
    let hasRemovals = false;

    // Check each item in cart
    cart.forEach((cartItem, index) => {
      const currentItem = currentMenu.find(
        (item) => item.title === cartItem.name || item.id === cartItem.id
      );

      if (!currentItem) {
        // Item no longer exists in menu
        validationResults.push({
          index,
          name: cartItem.name,
          status: "removed",
          message: "This item is no longer available",
          oldPrice: cartItem.price,
          newPrice: null,
        });
        hasRemovals = true;
        hasChanges = true;
      } else if (currentItem.price !== cartItem.price) {
        // Price has changed
        validationResults.push({
          index,
          name: cartItem.name,
          status: "price_changed",
          message: `Price updated from ‚Ç¶${formatPrice(
            cartItem.price
          )} to ‚Ç¶${formatPrice(currentItem.price)}`,
          oldPrice: cartItem.price,
          newPrice: currentItem.price,
        });
        hasChanges = true;
      } else if (currentItem.image !== cartItem.image) {
        // Image has changed (optional check)
        validationResults.push({
          index,
          name: cartItem.name,
          status: "updated",
          message: "This item has been updated",
          oldPrice: cartItem.price,
          newPrice: currentItem.price,
        });
        hasChanges = true;
      } else {
        // Item is still valid
        validationResults.push({
          index,
          name: cartItem.name,
          status: "valid",
          message: null,
          oldPrice: cartItem.price,
          newPrice: currentItem.price,
        });
      }
    });

    return {
      valid: !hasRemovals,
      hasChanges,
      hasRemovals,
      results: validationResults,
    };
  } catch (error) {
    console.error("Error validating cart:", error);
    return { valid: false, hasChanges: false, hasRemovals: false, results: [] };
  }
}

// NEW: Update cart with validated prices
function updateCartWithValidation(validationResults) {
  const cart = readCart();
  let updatedCart = [...cart];
  let changesMade = false;

  validationResults.forEach((result) => {
    if (result.status === "price_changed" && result.newPrice !== null) {
      // Update price in cart
      updatedCart[result.index].price = result.newPrice;
      changesMade = true;
    } else if (result.status === "removed") {
      // Mark item as unavailable (we'll handle display separately)
      updatedCart[result.index].unavailable = true;
      changesMade = true;
    }
  });

  if (changesMade) {
    saveCart(updatedCart);
  }

  return updatedCart;
}

/* ================== NOTIFICATION FUNCTION ================== */
function showNotification(message, type = "success") {
  // Create a simple notification element
  const notification = document.createElement("div");
  notification.textContent = message;
  notification.style.cssText = `
    position: fixed;
    top: 25px;
    right: 25px;
    background: ${type === "success" ? "#4CAF50" : "#F44336"};
    color: white;
    padding: 1rem 1.5rem;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    z-index: 9999;
    animation: slideInRight 0.3s ease-out;
    font-family: 'Poppins', sans-serif;
    font-weight: 500;
    max-width: 300px;
  `;

  document.body.appendChild(notification);

  // Remove after 3 seconds
  setTimeout(() => {
    notification.style.animation = "slideOutRight 0.3s ease-out forwards";
    setTimeout(() => notification.remove(), 300);
  }, 3000);
}

// Add animation keyframes for notifications
if (!document.querySelector("#notification-styles")) {
  const style = document.createElement("style");
  style.id = "notification-styles";
  style.textContent = `
    @keyframes slideInRight {
      from {
        opacity: 0;
        transform: translateX(100%);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes slideOutRight {
      from {
        opacity: 1;
        transform: translateX(0);
      }
      to {
        opacity: 0;
        transform: translateX(100%);
      }
    }
  `;
  document.head.appendChild(style);
}

/* ================== Old LOADER ================== */
// window.addEventListener("load", () => {
//   const loader = document.getElementById("loader");
//   if (loader) {
//     setTimeout(() => {
//       loader.style.opacity = "0";
//       setTimeout(() => (loader.style.display = "none"), 600);
//     }, 600);
//   }
// });

/* ================== ENHANCED SESSION AWARE LOADER ================== */
(function () {
  const loader = document.getElementById("loader");
  if (!loader) return;

  const isHomePage =
    window.location.pathname.endsWith("/") ||
    window.location.pathname.endsWith("/index.html") ||
    window.location.pathname === "";

  if (!isHomePage) {
    loader.style.display = "none";
    return;
  }

  // Session tracking (more intelligent than daily)
  const SESSION_KEY = "toke_bakes_session";
  const sessionData = JSON.parse(localStorage.getItem(SESSION_KEY) || "{}");
  const now = Date.now();
  const SESSION_TIMEOUT = 30 * 60 * 1000; // 30 minutes

  // Check if user is in an active "session"
  const hasActiveSession =
    sessionData.timestamp && now - sessionData.timestamp < SESSION_TIMEOUT;

  if (hasActiveSession) {
    // User is in active session (visited within 30 minutes)
    loader.style.display = "none";
    console.log("üîÅ Active session - seamless experience");
  } else {
    // New session or session expired
    sessionData.timestamp = now;
    sessionData.visitCount = (sessionData.visitCount || 0) + 1;
    localStorage.setItem(SESSION_KEY, JSON.stringify(sessionData));

    // Show loader on first 2 visits, then never again
    if (sessionData.visitCount <= 2) {
      window.addEventListener("load", () => {
        // Shorter loader on second visit
        const duration = sessionData.visitCount === 1 ? 1200 : 600;

        setTimeout(() => {
          loader.style.opacity = "0";
          setTimeout(() => (loader.style.display = "none"), 800);
        }, duration);
      });
    } else {
      // Experienced user - no loader at all
      loader.style.display = "none";
    }
  }

  // Update session timestamp on user activity
  ["click", "scroll", "mousemove", "keypress"].forEach((event) => {
    document.addEventListener(
      event,
      () => {
        const updatedData = JSON.parse(
          localStorage.getItem(SESSION_KEY) || "{}"
        );
        updatedData.timestamp = Date.now();
        localStorage.setItem(SESSION_KEY, JSON.stringify(updatedData)); // ‚úÖ FIXED
      },
      { passive: true }
    );
  });
})();

/* ================== BULLETPROOF NAV HIGHLIGHT ================== */
(function highlightNav() {
  const navLinks = document.querySelectorAll("nav a");

  // Get current location info
  const loc = {
    href: window.location.href.toLowerCase(),
    pathname: window.location.pathname.toLowerCase(),
    hostname: window.location.hostname,
  };

  // Determine if we're local or online
  const isLocal =
    loc.hostname === "localhost" || loc.href.startsWith("file://");

  // Parse current page
  let currentPage = loc.pathname.split("/").pop() || "index";
  currentPage = currentPage.replace(/\.(html|htm)$/, "").split("?")[0];
  if (currentPage === "") currentPage = "index";

  console.log(
    `Nav Debug: Current page="${currentPage}", Path="${loc.pathname}", Local=${isLocal}`
  );

  navLinks.forEach((link, index) => {
    const href = link.getAttribute("href");
    if (!href) return;

    // Parse link page
    let linkPage = href.split("/").pop() || "index";
    linkPage = linkPage.replace(/\.(html|htm)$/, "").split("?")[0];
    if (linkPage === "") linkPage = "index";

    // Reset
    link.classList.remove("active");

    // LOGIC THAT WORKS EVERYWHERE:

    // 1. Home page check
    if (linkPage === "index" && currentPage === "index") {
      link.classList.add("active");
      console.log(`‚úì Link ${index} (${href}) activated as HOME`);
      return;
    }

    // 2. Direct match
    if (linkPage === currentPage && linkPage !== "index") {
      link.classList.add("active");
      console.log(`‚úì Link ${index} (${href}) activated as DIRECT MATCH`);
      return;
    }

    // 3. For online (Netlify) - check if current path contains page name
    if (!isLocal && loc.pathname.includes(linkPage) && linkPage !== "index") {
      link.classList.add("active");
      console.log(`‚úì Link ${index} (${href}) activated as PATH CONTAINS`);
      return;
    }

    // 4. For local - check full path
    if (isLocal && loc.href.endsWith(href)) {
      link.classList.add("active");
      console.log(`‚úì Link ${index} (${href}) activated as LOCAL MATCH`);
      return;
    }

    console.log(`‚úó Link ${index} (${href}) NOT activated`);
  });

  console.log("--- Navigation Highlight Complete ---");
})();

/* ================== FIXED CART COUNT - NO ZERO FLASH ================== */
function refreshCartCount() {
  const countEls = document.querySelectorAll("#cart-count");
  const cart = readCart();
  const totalItems = cart.reduce((s, it) => s + (it.quantity || 1), 0);

  countEls.forEach((el) => {
    el.textContent = totalItems;
    el.setAttribute("data-count", String(totalItems));

    // FIX: Hide immediately if zero
    if (totalItems === 0) {
      el.style.display = "none";
    } else {
      el.style.display = "inline-block";
    }
  });
}

/* ================== MOBILE MENU ================== */
function initMobileMenu() {
  const toggleBtn = document.getElementById("navbarToggle");
  const navList = document.querySelector(".navbar ul");

  if (toggleBtn && navList) {
    toggleBtn.addEventListener("click", (e) => {
      e.stopPropagation();
      navList.classList.toggle("show");
    });

    // Close when clicking outside
    document.addEventListener("click", (e) => {
      if (
        navList.classList.contains("show") &&
        !e.target.closest(".navbar") &&
        !e.target.closest("#navbarToggle")
      ) {
        navList.classList.remove("show");
      }
    });

    // Close when clicking links
    document.querySelectorAll(".navbar a").forEach((link) => {
      link.addEventListener("click", () => {
        navList.classList.remove("show");
      });
    });
  }
}

/* ================== FOOTER THEME ================== */
function updateFooterTheme(theme) {
  const footer = document.querySelector(".bakes-footer");
  if (!footer) return;

  // If no theme provided, get it from HTML attribute
  if (!theme) {
    theme = document.documentElement.getAttribute("data-theme") || "light";
  }

  if (theme === "dark") {
    footer.classList.add("dark-theme");
    footer.classList.remove("light-theme");
  } else {
    footer.classList.add("light-theme");
    footer.classList.remove("dark-theme");
  }
}

/* ================== THEME TOGGLE ================== */
function initThemeToggle() {
  const themeToggle = document.getElementById("themeToggle");
  if (!themeToggle) return;

  // Get icon elements once
  const sunIcon = themeToggle.querySelector(".sun");
  const moonIcon = themeToggle.querySelector(".moon");

  // Function to update icons based on theme
  const updateIcons = (theme) => {
    if (theme === "dark") {
      if (sunIcon) sunIcon.style.display = "none";
      if (moonIcon) moonIcon.style.display = "inline-block";
      themeToggle.classList.add("dark");
    } else {
      if (sunIcon) sunIcon.style.display = "inline-block";
      if (moonIcon) moonIcon.style.display = "none";
      themeToggle.classList.remove("dark");
    }
  };

  // Initial icon setup
  const currentTheme =
    document.documentElement.getAttribute("data-theme") || "light";
  updateIcons(currentTheme);
  updateFooterTheme(currentTheme);

  // Click handler
  themeToggle.addEventListener("click", () => {
    const current = document.documentElement.getAttribute("data-theme");
    const newTheme = current === "dark" ? "light" : "dark";

    document.documentElement.setAttribute("data-theme", newTheme);

    // Update icons immediately
    updateIcons(newTheme);

    localStorage.setItem(THEME_KEY, newTheme);
    updateFooterTheme(newTheme);
  });
}

function initFooterTheme() {
  // Footer theme is already set by preventThemeFlash(),
  // just listen for system preference changes
  window.matchMedia("(prefers-color-scheme: dark)").addListener(() => {
    // Only update if user hasn't set a preference
    const savedTheme = localStorage.getItem(THEME_KEY);
    if (!savedTheme) {
      const prefersDark = window.matchMedia(
        "(prefers-color-scheme: dark)"
      ).matches;
      const theme = prefersDark ? "dark" : "light";
      document.documentElement.setAttribute("data-theme", theme);
      updateFooterTheme(theme);
    }
  });
}

/* ================== FIXED MENU INTERACTIONS ================== */
function initMenuInteractions() {
  // Close popups when clicking outside
  document.addEventListener("click", (e) => {
    if (!e.target.closest(".menu-item")) {
      document.querySelectorAll(".menu-item.show-popup").forEach((el) => {
        el.classList.remove("show-popup");
      });
    }
  });

  // Menu item click handling
  document.addEventListener("click", (e) => {
    const menuItem = e.target.closest(".menu-item");
    if (!menuItem) return;

    if (e.target.closest(".add-cart") || e.target.closest(".order-now")) return;

    const isShown = menuItem.classList.contains("show-popup");
    document
      .querySelectorAll(".menu-item")
      .forEach((i) => i.classList.remove("show-popup"));
    if (!isShown) menuItem.classList.add("show-popup");
  });

  // Add to cart functionality - NOW WITH ITEM ID
  document.addEventListener("click", (e) => {
    const addBtn = e.target.closest(".add-cart");
    if (!addBtn) return;
    e.stopPropagation();

    const menuItem = addBtn.closest(".menu-item");
    const name =
      menuItem.dataset.item ||
      menuItem.querySelector("h3")?.textContent?.trim();
    const price = Number(menuItem.dataset.price || 0);
    const image = menuItem.querySelector("img")?.getAttribute("src") || "";
    const id = menuItem.dataset.id || null;

    if (!name) return;

    const cart = readCart();
    const existing = cart.find((it) => it.name === name);
    if (existing) {
      existing.quantity = (existing.quantity || 1) + 1;
      existing.id = id; // Update ID if it exists
    } else {
      cart.push({ name, price, quantity: 1, image, id });
    }
    saveCart(cart);

    const prevText = addBtn.textContent;
    addBtn.textContent = "Added ‚úì";
    setTimeout(() => (addBtn.textContent = prevText), 900);
  });
}

/* ================== ORDER FUNCTIONALITY ================== */
function initOrderFunctionality() {
  // Order now buttons
  document.addEventListener("click", (e) => {
    const orderNow = e.target.closest(".order-now");
    if (!orderNow) return;
    e.preventDefault();
    e.stopPropagation();

    const menuItem = orderNow.closest(".menu-item");
    const name =
      menuItem.dataset.item ||
      menuItem.querySelector("h3")?.textContent?.trim();
    const price = menuItem.dataset.price || "";

    const orderData = {
      type: "single",
      items: [{ name, price: price ? Number(price) : 0, qty: 1 }],
      subject: `Order Inquiry: ${name}`,
    };

    showOrderOptions(orderData);
  });

  // Proceed to order button - NOW WITH CART VALIDATION
  document.addEventListener("click", async (e) => {
    if (!e.target || e.target.id !== "proceed-order") return;

    const cart = readCart();
    if (!cart || cart.length === 0) {
      const cartContainer = document.getElementById("cart-container");
      if (cartContainer) {
        const existingMessage = cartContainer.querySelector(
          ".empty-cart-message"
        );
        if (!existingMessage) {
          const message = document.createElement("div");
          message.className = "empty-cart-message";
          message.style.cssText =
            "background: #fff3cd; color: #856404; padding: 12px; border-radius: 8px; margin: 15px 0; text-align: center; border: 1px solid #ffeaa7;";
          message.textContent =
            "Your cart is empty. Visit the menu to add items.";
          cartContainer.appendChild(message);
          setTimeout(() => message.remove(), 4000);
        }
      }
      return;
    }

    // Validate cart before proceeding
    const validation = await validateCartItems();
    if (validation.hasChanges) {
      // Show warning about changes
      const continueOrder = confirm(
        "Some items in your cart have changed. Please review your cart before proceeding.\n\nClick OK to review changes, or Cancel to continue anyway."
      );

      if (continueOrder) {
        // User wants to review changes, don't proceed to order
        return;
      }
    }

    const orderData = {
      type: "cart",
      items: cart.map((it) => ({
        name: it.name,
        price: Number(it.price || 0),
        qty: it.quantity || 1,
      })),
      subject: "New Order from Website",
    };
    showOrderOptions(orderData);
  });
}

function showOrderOptions(orderData) {
  const sheet = document.getElementById("order-bottom-sheet");
  if (!sheet) return;

  const summaryEl = sheet.querySelector(".order-summary");
  if (summaryEl) {
    summaryEl.innerHTML = "";
    const list = document.createElement("div");

    orderData.items.forEach((it) => {
      const row = document.createElement("div");
      row.className = "summary-row";

      if (it.qty > 1) {
        row.innerHTML = `
          <div class="s-left">${escapeHtml(it.name)}</div>
          <div class="s-right">${it.qty}√ó NGN ${formatPrice(it.price)}</div>
        `;
      } else {
        row.innerHTML = `
          <div class="s-left">${escapeHtml(it.name)}</div>
          <div class="s-right">NGN ${formatPrice(it.price)}</div>
        `;
      }
      list.appendChild(row);

      if (it.qty > 1) {
        const subtotalRow = document.createElement("div");
        subtotalRow.className = "summary-subtotal";
        subtotalRow.innerHTML = `
          <div class="s-left"><em>Subtotal</em></div>
          <div class="s-right"><em>NGN ${formatPrice(
            it.price * it.qty
          )}</em></div>
        `;
        list.appendChild(subtotalRow);
      }
    });

    summaryEl.appendChild(list);

    const total = orderData.items.reduce(
      (s, it) => s + (it.price || 0) * (it.qty || 1),
      0
    );
    const totalRow = document.createElement("div");
    totalRow.className = "summary-total";
    totalRow.innerHTML = `
      <div class="s-left"><strong>Order total:</strong></div>
      <div class="s-right"><strong>NGN ${formatPrice(total)}</strong></div>
    `;
    summaryEl.appendChild(totalRow);
  }

  sheet.dataset.order = JSON.stringify(orderData);
  sheet.classList.add("visible");
}

// Bottom sheet functionality
function initBottomSheet() {
  if (document.getElementById("order-bottom-sheet")) return;

  const html = `
    <div id="order-bottom-sheet" class="order-bottom-sheet" aria-hidden="true">
      <div class="sheet-backdrop"></div>
      <div class="sheet-panel" role="dialog" aria-modal="true" aria-label="Choose order method">
        <button class="sheet-close" aria-label="Close">‚úï</button>
        <h3>Place your order</h3>
        <div class="order-summary" aria-live="polite"></div>
        <div class="sheet-actions">
          <button id="order-via-gmail" class="order-option-btn">Order via Gmail</button>
          <button id="order-via-whatsapp" class="order-option-btn">Order via WhatsApp</button>
        </div>
        <small class="sheet-note">We will open your chosen app with the order pre-filled. Please complete your contact details before sending.</small>
      </div>
    </div>
  `;
  document.body.insertAdjacentHTML("beforeend", html);

  // Sheet event listeners
  document.addEventListener("click", (e) => {
    const sheet = document.getElementById("order-bottom-sheet");
    if (!sheet) return;

    if (
      e.target.closest(".sheet-close") ||
      e.target.classList.contains("sheet-backdrop")
    ) {
      sheet.classList.remove("visible");
    }

    const gmailBtn = e.target.closest("#order-via-gmail");
    const waBtn = e.target.closest("#order-via-whatsapp");

    if (gmailBtn || waBtn) {
      const orderData = sheet.dataset.order
        ? JSON.parse(sheet.dataset.order)
        : null;
      if (!orderData) return;

      if (gmailBtn) {
        const lines = [
          "Hello Toke Bakes,",
          "",
          "I would like to place the following order:",
          "",
          ...orderData.items.map(
            (it) =>
              `- ${it.name} x ${it.qty} ${
                it.price ? `(NGN ${formatPrice(it.price)} each)` : ""
              }`
          ),
          "",
          `Order total: NGN ${formatPrice(
            orderData.items.reduce(
              (s, it) => s + (it.price || 0) * (it.qty || 1),
              0
            )
          )}`,
          "",
          "Name: ",
          "Phone: ",
          "Delivery address: ",
          "",
          "Please confirm availability and payment method.",
          "",
          "Thank you!",
        ];

        const subject = encodeURIComponent(
          orderData.subject || "Order from website"
        );
        const body = encodeURIComponent(lines.join("\n"));
        const gmailUrl = `https://mail.google.com/mail/?view=cm&fs=1&to=${encodeURIComponent(
          BUSINESS_EMAIL
        )}&su=${subject}&body=${body}`;
        window.open(gmailUrl, "_blank");
      }

      if (waBtn) {
        const lines = [
          "Hello Toke Bakes,",
          "",
          "I would like to place the following order:",
          ...orderData.items.map(
            (it) =>
              `- ${it.name} x ${it.qty} ${
                it.price ? `(NGN ${formatPrice(it.price)} each)` : ""
              }`
          ),
          "",
          `Order total: NGN ${formatPrice(
            orderData.items.reduce(
              (s, it) => s + (it.price || 0) * (it.qty || 1),
              0
            )
          )}`,
          "",
          "Name:",
          "Phone:",
          "Delivery address:",
          "",
          "Please confirm availability and payment method.",
        ];

        const waText = encodeURIComponent(lines.join("\n"));
        const waUrl = `https://wa.me/${BUSINESS_PHONE_WAME}?text=${waText}`;
        window.open(waUrl, "_blank");
      }

      sheet.classList.remove("visible");
    }
  });

  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") {
      const sheet = document.getElementById("order-bottom-sheet");
      if (sheet) sheet.classList.remove("visible");
    }
  });
}

/* ================== FIXED CART QUANTITY FUNCTION ================== */
async function renderCartOnOrderPage(shouldValidate = true) {
  const cartContainer = document.getElementById("cart-container");
  if (!cartContainer) return;

  let validation = null;
  let cart = readCart();

  // Only validate on initial load
  if (shouldValidate) {
    validation = await validateCartItems();
    cart = updateCartWithValidation(validation.results);
  }

  cartContainer.innerHTML = "";

  if (cart.length === 0) {
    cartContainer.innerHTML =
      '<p class="empty-cart">Your cart is empty. Visit the <a href="menu.html">menu</a> to add items.</p>';

    const clearCartBtn = document.getElementById("clear-cart");
    if (clearCartBtn) clearCartBtn.style.display = "none";
    return;
  }

  // Show clear cart button
  const clearCartBtn = document.getElementById("clear-cart");
  if (clearCartBtn) {
    clearCartBtn.style.display = "block";
    clearCartBtn.onclick = (e) => {
      e.preventDefault();
      saveCart([]);
      renderCartOnOrderPage(false);
      showNotification("Cart cleared successfully", "success");
    };
  }

  // Show validation warnings if needed
  if (shouldValidate && validation && validation.hasChanges) {
    const warningDiv = document.createElement("div");
    warningDiv.className = "cart-validation-warning";
    warningDiv.style.cssText = `
      background: linear-gradient(135deg, #fff3cd, #ffeaa7);
      color: #856404;
      padding: 1rem;
      border-radius: 10px;
      margin-bottom: 1.5rem;
      border-left: 4px solid #ffc107;
      box-shadow: 0 4px 12px rgba(255, 193, 7, 0.15);
    `;

    let warningMessage = "‚ö†Ô∏è Some items in your cart have changed:";
    validation.results.forEach((result) => {
      if (result.status === "removed") {
        warningMessage += `<br>‚Ä¢ <strong>${escapeHtml(result.name)}</strong>: ${
          result.message
        }`;
      } else if (result.status === "price_changed") {
        warningMessage += `<br>‚Ä¢ <strong>${escapeHtml(result.name)}</strong>: ${
          result.message
        }`;
      }
    });
    warningMessage +=
      "<br><br><em>Please review your cart before proceeding.</em>";
    warningDiv.innerHTML = warningMessage;
    cartContainer.appendChild(warningDiv);
  }

  // Render cart items with PROPER event handling
  cart.forEach((item, index) => {
    const row = document.createElement("div");
    row.className = "cart-row";
    row.dataset.index = index; // Store index on the row itself

    // Check if item is unavailable
    const isUnavailable = item.unavailable;
    const validationResult =
      validation && validation.results.find((r) => r.index === index);
    const isPriceChanged =
      validationResult && validationResult.status === "price_changed";

    if (isUnavailable) {
      row.style.cssText = `
        opacity: 0.6;
        background: linear-gradient(135deg, #f8d7da, #f5c6cb);
        border-left: 4px solid #dc3545;
      `;
    } else if (isPriceChanged) {
      row.style.cssText = `
        background: linear-gradient(135deg, #fff3cd, #ffeaa7);
        border-left: 4px solid #ffc107;
      `;
    }

    row.innerHTML = `
      <img src="${
        item.image ||
        "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iODAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2ZmZTVjYyIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTIiIGZpbGw9IiMzMzMiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj5DYXJ0PC90ZXh0Pjwvc3ZnPg=="
      }"
           alt="${escapeHtml(item.name)}" loading="lazy" />
      <div class="item-info">
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <strong>${escapeHtml(item.name)}</strong>
          ${
            isUnavailable
              ? '<span style="color:#dc3545;font-weight:bold;font-size:0.9rem;">UNAVAILABLE</span>'
              : ""
          }
          <button class="remove-item">Remove</button>
        </div>
        ${
          isUnavailable
            ? `
          <div style="color:#dc3545;font-size:0.9rem;margin-top:4px;margin-bottom:8px;">
            <i class="fas fa-exclamation-circle"></i> This item is no longer available
          </div>
        `
            : ""
        }
        ${
          isPriceChanged
            ? `
          <div style="color:#856404;font-size:0.9rem;margin-top:4px;margin-bottom:8px;">
            <i class="fas fa-info-circle"></i> Price updated
          </div>
        `
            : ""
        }
        <div class="qty-controls">
          <button class="qty-btn decrease" ${
            isUnavailable
              ? 'disabled style="opacity:0.5;cursor:not-allowed;"'
              : ""
          }>-</button>
          <span class="qty-display">${item.quantity}</span>
          <button class="qty-btn increase" ${
            isUnavailable
              ? 'disabled style="opacity:0.5;cursor:not-allowed;"'
              : ""
          }>+</button>
          <div style="margin-left:auto;font-weight:700;">NGN ${formatPrice(
            (item.price || 0) * (item.quantity || 1)
          )}</div>
        </div>
      </div>
    `;

    cartContainer.appendChild(row);
  });

  // Add event listeners AFTER rendering
  setupCartEventListeners();
}

/* ================== FIXED CART EVENT HANDLING ================== */
function setupCartEventListeners() {
  const cartContainer = document.getElementById("cart-container");
  if (!cartContainer) return;

  // Remove old listeners to prevent duplicates
  cartContainer.replaceWith(cartContainer.cloneNode(true));
  const freshContainer = document.getElementById("cart-container");

  // Add fresh event listener
  freshContainer.addEventListener("click", function (e) {
    const target = e.target;
    const row = target.closest(".cart-row");

    if (!row) return;

    const index = parseInt(row.dataset.index);
    let cart = readCart();

    if (isNaN(index) || index < 0 || index >= cart.length) return;

    // Handle quantity buttons

    if (target.classList.contains("qty-btn")) {
      e.preventDefault();
      e.stopPropagation();

      if (target.classList.contains("increase")) {
        cart[index].quantity = (cart[index].quantity || 1) + 1;
      } else if (target.classList.contains("decrease")) {
        // Only decrease if quantity is greater than 1
        if (cart[index].quantity > 1) {
          cart[index].quantity = cart[index].quantity - 1;
        }
        // If quantity is 1, do nothing (don't decrease to 0)
      }

      saveCart(cart);
      renderCartOnOrderPage(false); // Don't validate on button clicks
    }

    // Handle remove button
    if (target.classList.contains("remove-item")) {
      e.preventDefault();
      e.stopPropagation();

      cart.splice(index, 1);
      saveCart(cart);
      renderCartOnOrderPage(false);
      showNotification("Item removed from cart", "success");
    }
  });
}

/* ================== RIPPLE EFFECT ================== */
function initRipple(selector) {
  document.addEventListener(
    "click",
    function (e) {
      const el = e.target.closest(selector);
      if (!el) return;

      const rect = el.getBoundingClientRect();
      const ripple = document.createElement("span");
      ripple.className = "ripple-effect";
      const size = Math.max(rect.width, rect.height) * 1.2;
      ripple.style.width = ripple.style.height = size + "px";
      ripple.style.left = e.clientX - rect.left - size / 2 + "px";
      ripple.style.top = e.clientY - rect.top - size / 2 + "px";

      el.style.position = el.style.position || "relative";
      el.appendChild(ripple);
      setTimeout(() => ripple.remove(), 600);
    },
    { passive: true }
  );
}

// Initialize when DOM is loaded
document.addEventListener("DOMContentLoaded", async () => {
  console.log("üöÄ Initializing Toke Bakes with Enhanced Sync...");

  // STEP 2: Initialize sync system FIRST (IMPORTANT!)
  window.websiteUpdater = new WebsiteAutoUpdater();

  // STEP 3: Tiny delay for sync to initialize (using requestAnimationFrame - faster)
  await new Promise((resolve) => requestAnimationFrame(resolve));

  // STEP 4: NOW load cart (after sync is ready)
  refreshCartCount();

  // STEP 5: Load dynamic content
  await loadDynamicContent();

  // STEP 6: Initialize everything else
  initMobileMenu();
  initThemeToggle();
  initFooterTheme();
  initMenuInteractions();
  initOrderFunctionality();
  initBottomSheet();
  initRipple(
    ".btn, .add-cart, .order-now, .qty-controls button, .order-option-btn, .remove-item .theme-toggle"
  );

  if (currentPage.includes("order")) {
    await renderCartOnOrderPage(true);
  }

  // Update copyright year
  const yearElement = document.getElementById("current-year");
  if (yearElement) {
    yearElement.textContent = new Date().getFullYear();
  }

  console.log("‚úÖ Toke Bakes fully initialized with enhanced sync");
});

// Global event listener for clear cart button (fallback)
document.addEventListener("click", (e) => {
  if (e.target && e.target.id === "clear-cart") {
    e.preventDefault();
    saveCart([]);
    renderCartOnOrderPage(false);
    showNotification("Cart cleared successfully", "success");
  }
});

--- FILE: ./style.css ---
/* ================== GLOBAL RESETS & VARIABLES ================== */
:root {
  --primary: #e67a00;
  --secondary: #444;
  --text: #333;
  --text-light: #666;
  --background: #fff;
  --surface: #faf7f5;
  --border: #eee;
  --shadow: rgba(0, 0, 0, 0.1);

  /* Dark theme variables */
  --bg-primary: #1a1a1a;
  --bg-secondary: #2d2d2d;
  --text-primary: #ffffff;
  --text-secondary: #cccccc;
  --border-dark: #444;
}

[data-theme="dark"] {
  --text: var(--text-primary);
  --text-light: var(--text-secondary);
  --background: var(--bg-primary);
  --surface: var(--bg-secondary);
  --border: var(--border-dark);
  --shadow: rgba(0, 0, 0, 0.3);
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html,
body {
  height: 100%;
  font-family: "Poppins", sans-serif;
  color: var(--text);
  scroll-behavior: smooth;
  background: var(--background);
  overflow-x: hidden;
  transition: background-color 0.3s ease, color 0.3s ease;
  line-height: 1.6;
}

a {
  color: inherit;
  text-decoration: none;
}

/* ================== ENHANCED LOADER ================== */
#loader {
  position: fixed;
  inset: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  background: var(--background);
  z-index: 9999;
  transition: opacity 0.6s ease;
}

#loader img {
  width: 120px;
  height: 120px;
  border-radius: 50%;
  animation: enhancedPulse 2s ease-in-out infinite;
  box-shadow: 0 0 30px rgba(230, 122, 0, 0.2);
}

@keyframes enhancedPulse {
  0%,
  100% {
    transform: scale(1) rotate(0deg);
    opacity: 1;
    box-shadow: 0 0 20px rgba(230, 122, 0, 0.2);
  }
  50% {
    transform: scale(1.1) rotate(5deg);
    opacity: 0.8;
    box-shadow: 0 0 40px rgba(230, 122, 0, 0.4);
  }
}

/* ================== ENHANCED HEADER & NAVIGATION ================== */
header {
  width: 100%;
  background: rgba(255, 255, 255, 0.95);
  box-shadow: 0 2px 8px var(--shadow);
  position: sticky;
  top: 0;
  z-index: 1000;
  transition: all 0.3s ease;
  animation: slideDownFade 0.8s ease-out;
}

@keyframes slideDownFade {
  from {
    opacity: 0;
    transform: translateY(-30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

[data-theme="dark"] header {
  background: rgba(45, 45, 45, 0.95);
}

.header-inner {
  max-width: 1200px;
  margin: 0 auto;
  padding: 1rem 1.25rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.brand {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  animation: brandSlideIn 0.6s ease-out 0.2s both;
}

@keyframes brandSlideIn {
  from {
    opacity: 0;
    transform: translateX(-20px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

.brand h1 {
  font-size: 1.5rem;
  font-weight: 600;
}

.logo-sm {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  object-fit: cover;
  transition: transform 0.3s ease;
}

.logo-sm:hover {
  transform: scale(1.1) rotate(5deg);
}

/* ================== NAVBAR ================== */
.navbar {
  display: flex;
  align-items: center;
  gap: 1.25rem; /* Better spacing between nav elements */
}

.navbar ul {
  display: flex;
  list-style: none;
  gap: 1.75rem; /* Improved spacing between nav links */
  margin: 0;
  padding: 0;
  align-items: center;
}

.navbar a {
  font-weight: 500;
  padding: 0.5rem 0.75rem; /* Better touch target size */
  transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  position: relative;
  border-radius: 4px; /* Added for better hover area */
}

.navbar a::before {
  content: "";
  position: absolute;
  bottom: -2px;
  left: 50%;
  width: 0;
  height: 2px;
  background: var(--primary);
  transition: all 0.3s ease;
  transform: translateX(-50%);
}

.navbar a:hover::before,
.navbar a.active::before {
  width: 80%;
}

.navbar a:hover,
.navbar a.active {
  color: var(--primary);
  transform: translateY(-2px);
}

/* ================== ADMIN NAVBAR ================== */
.admin-navbar {
  display: flex;
  align-items: center;
  gap: 1.25rem; /* Better spacing between nav elements */
}

.admin-navbar ul {
  display: flex;
  list-style: none;
  gap: 1.75rem; /* Improved spacing between nav links */
  margin: 0;
  padding: 0;
  align-items: center;
}

.admin-navbar a {
  font-weight: 500;
  padding: 0.5rem 0.75rem; /* Better touch target size */
  transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  position: relative;
  border-radius: 4px; /* Added for better hover area */
}

.admin-navbar a::before {
  content: "";
  position: absolute;
  bottom: -2px;
  left: 50%;
  width: 0;
  height: 2px;
  background: var(--primary);
  transition: all 0.3s ease;
  transform: translateX(-50%);
}

.admin-navbar a:hover::before,
.admin-navbar a.active::before {
  width: 80%;
}

.admin-navbar a:hover,
.admin-navbar a.active {
  color: var(--primary);
  transform: translateY(-2px);
}

/* ================== CART LINK ================== */
.cart-link {
  position: relative;
  display: flex;
  align-items: center;
  font-size: 1.2rem;
  padding: 0.5rem;
  color: inherit;
  transition: transform 0.3s ease;
  border-radius: 4px;
}

.cart-link:hover {
  transform: scale(1.1);
}

.cart-link #cart-count {
  background: var(--primary);
  color: #fff;
  border-radius: 50%;
  font-size: 0.7rem;
  padding: 2px 6px;
  position: absolute;
  top: -2px;
  right: -2px;
  min-width: 18px;
  text-align: center;
  line-height: 1;
  transition: all 0.3s ease;
  animation: countPulse 0.6s ease-out;
}

@keyframes countPulse {
  0% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.3);
  }
  100% {
    transform: scale(1);
  }
}

.cart-link #cart-count[data-count="0"] {
  display: none;
}

/* ================== GLASS THEME TOGGLE - VISIBLE IN LIGHT MODE ================== */
.theme-toggle {
  background: rgba(255, 255, 255, 0.7); /* Much more opaque */
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 2px solid rgba(230, 122, 0, 0.3); /* Orange border for contrast */
  border-radius: 50%;
  padding: 0.75rem;
  margin-left: 1.25rem;
  cursor: pointer;
  transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  display: flex;
  align-items: center;
  justify-content: center;
  width: 3rem;
  height: 3rem;
  font-size: 1.25rem;
  color: var(--text);
  position: relative;
  overflow: hidden;
  /* Inner shadow for depth */
  box-shadow: inset 0 2px 4px rgba(255, 255, 255, 0.8),
    inset 0 -1px 2px rgba(0, 0, 0, 0.1), 0 2px 8px rgba(0, 0, 0, 0.1); /* Subtle outer shadow */
}

/* Glass effect for dark theme */
[data-theme="dark"] .theme-toggle {
  background: rgba(0, 0, 0, 0.4);
  border: 2px solid rgba(230, 122, 0, 0.4);
  box-shadow: inset 0 2px 4px rgba(255, 255, 255, 0.1),
    inset 0 -1px 2px rgba(0, 0, 0, 0.3), 0 2px 8px rgba(0, 0, 0, 0.3);
}

/* RIPPLE EFFECT */
.theme-toggle .ripple-effect {
  position: absolute;
  border-radius: 50%;
  background: radial-gradient(
    circle,
    rgba(230, 122, 0, 0.4) 0%,
    rgba(230, 122, 0, 0.2) 40%,
    transparent 70%
  );
  transform: scale(0);
  animation: themeRipple 0.6s ease-out;
  pointer-events: none;
  z-index: 1;
}

@keyframes themeRipple {
  0% {
    transform: scale(0);
    opacity: 1;
  }
  50% {
    opacity: 0.7;
  }
  100% {
    transform: scale(3);
    opacity: 0;
  }
}

/* ====== KEEP YOUR ORIGINAL ROTATION LOGIC ====== */
.theme-toggle .icon {
  transition: all 0.3s ease;
  display: inline-block;
}

.theme-toggle .moon {
  opacity: 0;
  transform: scale(0.8) rotate(90deg);
  position: absolute;
}

.theme-toggle.dark .sun {
  opacity: 0;
  transform: scale(0.8) rotate(90deg);
}

.theme-toggle.dark .moon {
  opacity: 1;
  transform: scale(1) rotate(0deg);
}

/* Fix icon flash */
.theme-toggle .moon {
  display: none;
}
[data-theme="dark"] .theme-toggle .moon {
  display: inline;
}

/* ====== ORIGINAL HOVER EFFECT ====== */
.theme-toggle:hover {
  background: rgba(230, 122, 0, 0.2); /* Orange tint on hover */
  transform: rotate(180deg) scale(1.1);
  border-color: rgba(230, 122, 0, 0.5);
}

[data-theme="dark"] .theme-toggle:hover {
  background: rgba(230, 122, 0, 0.3);
}

/* Glass shine effect */
.theme-toggle::before {
  content: "";
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(
    90deg,
    transparent,
    rgba(255, 255, 255, 0.5),
    transparent
  );
  transition: left 0.6s ease;
  z-index: 1;
  pointer-events: none;
}

.theme-toggle:hover::before {
  left: 100%;
}

/* ================== NAVBAR TOGGLE ================== */
.navbar-toggle {
  display: none;
  font-size: 1.3rem;
  background: none;
  border: none;
  cursor: pointer;
  color: var(--text);
  width: 2.5rem;
  height: 2.5rem;
  align-items: center;
  justify-content: center;
  padding: 0;
  transition: transform 0.3s ease;
  border-radius: 4px;
}

.navbar-toggle:hover {
  transform: scale(1.1);
}

/* ================== HERO SECTION ================== */
.hero {
  text-align: center;
  color: #fff;
  padding: 8rem 1.25rem 6rem;
  background: linear-gradient(
    to bottom,
    rgba(0, 0, 0, 0.65),
    rgba(0, 0, 0, 0.85)
  );
  animation: heroEntrance 1.1s ease-out;
}

@keyframes heroEntrance {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* ================== HERO LOGO ================== */
.hero-logo {
  width: 200px;
  height: 200px;
  border-radius: 50%;
  margin-bottom: 1.75rem;
  position: relative;
  z-index: 1;

  background: radial-gradient(
    circle at top,
    rgba(255, 200, 120, 0.4),
    rgba(0, 0, 0, 0.85)
  );
  padding: 0.65rem;

  box-shadow: 0 0 0 2.5px rgba(255, 190, 90, 0.9),
    0 0 35px rgba(255, 165, 60, 0.65), 0 0 90px rgba(255, 130, 40, 0.5);

  animation: logoFloat 4.5s ease-in-out infinite;
}

.hero-logo::after {
  content: "";
  position: absolute;
  inset: -35%;
  border-radius: 50%;
  background: radial-gradient(circle, rgba(255, 175, 95, 0.4), transparent 70%);
  filter: blur(45px);
  z-index: -1;
}

/* ================== LOGO FLOAT ================== */
@keyframes logoFloat {
  0%,
  100% {
    transform: translateY(0);
  }
  50% {
    transform: translateY(-10px);
  }
}

/* ================== HEADLINE ================== */
.hero h2 {
  font-size: clamp(2.2rem, 4vw, 3rem);
  font-weight: 700;
  letter-spacing: 0.03em;
  margin-bottom: 0.75rem;
  text-shadow: 0 4px 20px rgba(0, 0, 0, 0.8), 0 0 25px rgba(255, 165, 0, 0.35);
  animation: fadeInUp 0.8s ease-out 0.2s both;
}

/* ================== SUBTEXT ================== */
.hero .lead {
  font-size: 1.15rem;
  line-height: 1.7;
  max-width: 640px;
  margin: 0 auto 2rem;
  color: rgba(255, 255, 255, 0.9);
  animation: fadeInUp 0.8s ease-out 0.4s both;
}

/* ================== FADE UP ================== */
@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(18px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* ================== MOBILE SAFETY ================== */
@media (max-width: 768px) {
  .hero {
    padding: 6rem 1rem 4.5rem;
  }

  .hero-logo {
    width: 150px;
    height: 150px;
  }
}

/* ================== BUTTONS ================== */
.btn {
  background: linear-gradient(135deg, var(--primary), #ff8c42);
  color: #fff;
  padding: 0.75rem 1.75rem;
  border-radius: 25px;
  transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  font-weight: 500;
  position: relative;
  overflow: hidden;
  border: none;
  cursor: pointer;
  display: inline-block;
  transform-style: preserve-3d;
  line-height: 1.5;
}

.btn::before {
  content: "";
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(
    90deg,
    transparent,
    rgba(255, 255, 255, 0.3),
    transparent
  );
  transition: left 0.6s ease;
}

.btn:hover::before {
  left: 100%;
}

.btn:hover {
  transform: translateY(-4px) scale(1.05);
  box-shadow: 0 12px 20px rgba(230, 122, 0, 0.25); /* Reduced from 30px to 20px */
}

.btn-secondary {
  background: linear-gradient(135deg, var(--surface), var(--background));
  color: var(--text);
  padding: 0.75rem 1.5rem;
  border-radius: 22px;
  border: 1px solid var(--border);
  transition: all 0.3s ease;
  cursor: pointer;
  position: relative;
  overflow: hidden;
  line-height: 1.5;
}

.btn-secondary:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 20px var(--shadow); /* Reduced from 20px to 20px */
  border-color: var(--primary);
}

/* ================== ABOUT PREVIEW ================== */
.about-preview {
  background: rgba(255, 255, 255, 0.92);
  backdrop-filter: blur(4px);
  padding: 3.75rem 1.25rem;
  text-align: center;
  transition: all 0.3s ease;
  position: relative;
}

.about-preview::after {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: radial-gradient(
    ellipse at center,
    rgba(230, 122, 0, 0.03) 0%,
    transparent 70%
  );
  pointer-events: none;
  opacity: 0;
  transition: opacity 0.6s ease;
}

.about-preview:hover::after {
  opacity: 1;
}

[data-theme="dark"] .about-preview {
  background: rgba(45, 45, 45, 0.92);
}

.about-preview h3 {
  font-size: 1.8rem;
  margin-bottom: 1.25rem;
}

.about-features {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 1.5rem;
  margin-top: 1.25rem;
}

.feature {
  flex: 1 1 280px;
  background: linear-gradient(135deg, var(--background), var(--surface));
  padding: 1.5rem;
  border-radius: 12px;
  box-shadow: 0 2px 10px var(--shadow);
  transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  position: relative;
  overflow: hidden;
}

.feature::after {
  content: "";
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(
    90deg,
    transparent,
    rgba(230, 122, 0, 0.05),
    transparent
  );
  transition: left 0.6s ease;
}

.feature:hover::after {
  left: 100%;
}

.feature:hover {
  transform: translateY(-6px) scale(1.03);
  box-shadow: 0 12px 20px var(--shadow); /* Reduced from 30px to 20px */
}

/* ================== FEATURED CREATIONS - PERMANENT IMAGE ENHANCEMENT ================== */
.featured {
  text-align: center;
  padding: 5rem 1.25rem;
  position: relative;
  background: linear-gradient(
    135deg,
    rgba(255, 248, 240, 0.6) 0%,
    rgba(255, 253, 250, 0.3) 50%,
    rgba(255, 248, 240, 0.6) 100%
  );
  margin: 3rem 0;
  border-radius: 0;
  overflow: hidden;
}

[data-theme="dark"] .featured {
  background: linear-gradient(
    135deg,
    rgba(26, 26, 26, 0.8) 0%,
    rgba(45, 45, 45, 0.4) 50%,
    rgba(26, 26, 26, 0.8) 100%
  );
}

.featured::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 1px;
  background: linear-gradient(
    90deg,
    transparent,
    rgba(230, 122, 0, 0.5),
    transparent
  );
}

.featured::after {
  content: "";
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 1px;
  background: linear-gradient(
    90deg,
    transparent,
    rgba(230, 122, 0, 0.5),
    transparent
  );
}

/* CONTAINER */
#featured-container,
.featured-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
  gap: 3rem;
  margin-top: 3rem;
  position: relative;
  z-index: 1;
}

/* ========== ORANGE TINTED GLASS ========== */
.featured-item,
.item-card {
  /* Orange-tinted glass background */
  background: linear-gradient(
    145deg,
    rgba(255, 245, 235, 0.9) 0%,
    rgba(255, 250, 240, 0.85) 100%
  );
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border-radius: 24px;
  overflow: hidden;

  position: relative;
  border: 1px solid rgba(230, 122, 0, 0.3);

  box-shadow: 0 10px 30px rgba(230, 122, 0, 0.15),
    inset 0 1px 0 rgba(255, 255, 255, 0.9),
    inset 0 0 20px rgba(255, 223, 186, 0.3), 0 0 0 1px rgba(255, 197, 111, 0.4);

  transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.1);
  animation: featuredItemAppear 0.6s ease-out backwards;
  cursor: pointer;
}

/* ORANGE GLASS RIPPLE */
.featured-item::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  border-radius: 24px;

  border: 2px solid rgba(230, 122, 0, 0.2);
  background: linear-gradient(
    145deg,
    rgba(255, 223, 186, 0.15),
    rgba(255, 197, 111, 0.1),
    rgba(255, 223, 186, 0.15)
  );

  /* Add standard properties first, then vendor prefixes */
  mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
  mask-composite: exclude;
  -webkit-mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
  -webkit-mask-composite: xor;
  z-index: 1;
  pointer-events: none;
}

/* ORANGE SHINE EFFECT */
.featured-item::after {
  content: "";
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(
    90deg,
    transparent,
    rgba(255, 223, 186, 0.5) 20%,
    rgba(255, 197, 111, 0.7) 50%,
    rgba(255, 223, 186, 0.5) 80%,
    transparent
  );
  transition: left 0.8s cubic-bezier(0.4, 0, 0.2, 1);
  z-index: 2;
  pointer-events: none;
  mix-blend-mode: overlay;
}

.featured-item:hover::after {
  left: 100%;
}

/* HOVER EFFECT */
.featured-item:hover {
  transform: translateY(-8px) scale(1.02);

  box-shadow: 0 20px 40px rgba(230, 122, 0, 0.25),
    inset 0 1px 0 rgba(255, 255, 255, 0.95),
    inset 0 0 30px rgba(255, 223, 186, 0.4), 0 0 0 2px rgba(255, 197, 111, 0.6);

  background: linear-gradient(
    145deg,
    rgba(255, 240, 230, 0.95) 0%,
    rgba(255, 248, 235, 0.92) 100%
  );
}

/* ========== IMAGE WITH PERMANENT ENHANCEMENT ========== */
.featured-item img {
  width: 100%;
  aspect-ratio: 4/3;
  object-fit: cover;
  transition: all 0.5s cubic-bezier(0.2, 0.8, 0.4, 1);
  display: block;

  image-rendering: -webkit-optimize-contrast;
  background: linear-gradient(45deg, #f8f3e9, #f5e8d0);
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
  overflow: hidden;
  filter: none;
  border-bottom: none;
  border-radius: 16px;
}

/* FIXED: Image enhancement stays after ripple */
.featured-item:hover img {
  transform: scale(1.05);
  filter: brightness(1.1) saturate(1.2); /* Enhanced values */
  border-radius: 14px;

  /* Keep these styles even after ripple animation completes */
  transition: transform 0.5s cubic-bezier(0.2, 0.8, 0.4, 1),
    filter 0.5s cubic-bezier(0.2, 0.8, 0.4, 1) 0s,
    /* No delay on filter */ border-radius 0.5s cubic-bezier(0.2, 0.8, 0.4, 1);
}

/* Make sure image stays enhanced when card is hovered (even after ripple) */
.featured-item:hover img {
  animation: none; /* Remove any animations that might reset the filter */
}

/* Optional: Add a separate shine effect for the image itself */
.featured-item .img-shine {
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 280px; /* Match image height */
  background: linear-gradient(
    90deg,
    transparent,
    rgba(255, 255, 255, 0.4) 30%,
    rgba(255, 255, 255, 0.6) 50%,
    rgba(255, 255, 255, 0.4) 70%,
    transparent
  );
  transition: left 0.8s cubic-bezier(0.4, 0, 0.2, 1);
  z-index: 3;
  pointer-events: none;
  mix-blend-mode: overlay;
}

.featured-item:hover .img-shine {
  left: 100%;
}

@supports not (aspect-ratio: 4/3) {
  .featured-item img {
    height: 280px;
  }
}

/* ========== STAGGERED ENTRANCE ========== */
.featured-item:nth-child(1) {
  animation-delay: 0.1s;
}
.featured-item:nth-child(2) {
  animation-delay: 0.2s;
}
.featured-item:nth-child(3) {
  animation-delay: 0.3s;
}
.featured-item:nth-child(4) {
  animation-delay: 0.4s;
}
.featured-item:nth-child(5) {
  animation-delay: 0.5s;
}
.featured-item:nth-child(6) {
  animation-delay: 0.6s;
}
.featured-item:nth-child(7) {
  animation-delay: 0.7s;
}
.featured-item:nth-child(8) {
  animation-delay: 0.8s;
}

@keyframes featuredItemAppear {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* ========== TEXT ========== */
.featured-item h3,
.featured-item h4 {
  margin: 1rem 0 0.5rem;
  position: relative;
  color: #2c3e50;
  font-size: 1.3rem;
  text-align: center;
  font-weight: 700;
  transition: all 0.5s cubic-bezier(0.2, 0.8, 0.4, 1);
}

.featured-item p {
  margin: 0 0 1.5rem;
  position: relative;
  color: #666;
  font-size: 0.95rem;
  text-align: center;
  line-height: 1.6;
  transition: all 0.5s cubic-bezier(0.2, 0.8, 0.4, 1);
  padding: 0 0.5rem;
}

.featured-item:hover h3,
.featured-item:hover h4 {
  transform: translateY(20px);
  margin-top: 1.2rem;
  color: #2c3e50;
}

.featured-item:hover p {
  transform: translateY(18px);
  color: #666;
  margin-bottom: 1.8rem;
}

/* ========== DARK THEME ========== */
[data-theme="dark"] .featured-item {
  background: linear-gradient(
    145deg,
    rgba(60, 45, 30, 0.85) 0%,
    rgba(70, 55, 40, 0.8) 100%
  );
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);

  border: 1px solid rgba(230, 122, 0, 0.4);

  box-shadow: 0 10px 30px rgba(230, 122, 0, 0.2),
    inset 0 1px 0 rgba(255, 255, 255, 0.1),
    inset 0 0 20px rgba(255, 197, 111, 0.2), 0 0 0 1px rgba(255, 223, 186, 0.3);
}

[data-theme="dark"] .featured-item::before {
  border: 2px solid rgba(230, 122, 0, 0.3);
  background: linear-gradient(
    145deg,
    rgba(230, 122, 0, 0.15),
    rgba(211, 84, 0, 0.1),
    rgba(230, 122, 0, 0.15)
  );
}

[data-theme="dark"] .featured-item::after {
  background: linear-gradient(
    90deg,
    transparent,
    rgba(230, 122, 0, 0.3) 20%,
    rgba(230, 122, 0, 0.5) 50%,
    rgba(230, 122, 0, 0.3) 80%,
    transparent
  );
}

[data-theme="dark"] .featured-item:hover img {
  filter: brightness(1.15) saturate(1.3); /* Even more enhancement in dark mode */
}

[data-theme="dark"] .featured-item img {
  background: linear-gradient(45deg, #2a2a2a, #333);
}

[data-theme="dark"] .featured-item h3,
[data-theme="dark"] .featured-item h4 {
  color: #ecf0f1;
}

[data-theme="dark"] .featured-item p {
  color: #bdc3c7;
}

[data-theme="dark"] .featured-item:hover h3,
[data-theme="dark"] .featured-item:hover h4 {
  color: #ecf0f1;
}

[data-theme="dark"] .featured-item:hover p {
  color: #bdc3c7;
}

/* ========== RESPONSIVE ========== */
@media (max-width: 768px) {
  .featured {
    padding: 3rem 1rem;
  }

  #featured-container,
  .featured-grid {
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 2rem;
  }

  .featured-item {
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
  }

  .featured-item img {
    aspect-ratio: 3/2;
  }

  .featured-item:hover img {
    transform: scale(1.03);
    filter: brightness(1.08) saturate(1.15); /* Slightly less on mobile */
  }

  .featured-item:hover {
    transform: translateY(-6px) scale(1.01);
  }

  .featured-item p {
    margin: 0 0 1.25rem;
  }

  .featured-item:hover p {
    margin-bottom: 1.5rem;
  }
}

@media (min-width: 769px) and (max-width: 1024px) {
  .featured-item img {
    aspect-ratio: 5/4;
  }
}

@media (min-width: 1200px) {
  .featured-item p {
    margin: 0 0 1.75rem;
  }

  .featured-item:hover p {
    margin-bottom: 2rem;
  }

  .featured-item:hover img {
    filter: brightness(1.12) saturate(1.25); /* Even more on large screens */
  }
}

/* ================== MENU SECTION ================== */
.menu-section {
  padding: 3.75rem 1.25rem;
  text-align: center;
  position: relative;
}

/* CONTAINER */
#menu-container,
.menu-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 2rem;
  margin-top: 2.5rem;
}

/* CMS-GENERATED MENU ITEMS - FIXED APPEARANCE */
.menu-item,
.cms-menu-item {
  background: linear-gradient(145deg, #ffffff, #fff9f0);
  padding: 1.5rem;
  border-radius: 20px;
  position: relative;
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08),
    inset 0 1px 0 rgba(255, 255, 255, 0.8), 0 0 0 1px rgba(255, 223, 186, 0.3);
  transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.1);
  cursor: pointer;
  overflow: hidden;
  isolation: isolate;
  border: 1px solid rgba(255, 223, 186, 0.5);
  /* Ensure proper image container */
  display: flex;
  flex-direction: column;
}

[data-theme="dark"] .menu-item,
[data-theme="dark"] .cms-menu-item {
  background: linear-gradient(145deg, #2a2a2a, #333);
  border-color: rgba(211, 84, 0, 0.2);
}

/* BAKERY SHINE EFFECT */
.menu-item::before,
.cms-menu-item::before {
  content: "";
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(
    90deg,
    transparent,
    rgba(255, 249, 230, 0.3) 20%,
    rgba(255, 223, 186, 0.4) 50%,
    rgba(255, 249, 230, 0.3) 80%,
    transparent
  );
  transition: left 0.8s cubic-bezier(0.4, 0, 0.2, 1);
  z-index: 1;
}

.menu-item:hover::before,
.cms-menu-item:hover::before {
  left: 100%;
}

/* HOVER EFFECT - FIXED */
.menu-item:hover,
.cms-menu-item:hover {
  transform: translateY(-8px) scale(1.02);
  box-shadow: 0 15px 35px rgba(211, 84, 0, 0.18),
    inset 0 1px 0 rgba(255, 255, 255, 0.9), 0 0 0 2px rgba(255, 223, 186, 0.5);
}

/* ================== IMAGE FIX - RESPONSIVE ASPECT RATIO ================== */
/* FIX: Use aspect ratio instead of fixed height */
.menu-item img,
.cms-menu-item img {
  width: 100%;
  /* Responsive aspect ratio - works on all screen sizes */
  aspect-ratio: 4/3; /* Standard food photography ratio */
  border-radius: 16px;
  object-fit: cover;
  transition: all 0.7s cubic-bezier(0.2, 0.8, 0.4, 1);
  display: block;

  /* REMOVED: transform: scale(1.05) - causes cropping issues */
  /* REMOVED: height: 220px - causes aspect ratio problems */

  /* Better image quality */
  image-rendering: -webkit-optimize-contrast;

  /* Bakery fallback for missing images */
  background: linear-gradient(45deg, #f8f3e9, #f5e8d0);

  /* Shadow for depth */
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);

  /* Ensure image doesn't overflow */
  overflow: hidden;
}

/* Hover zoom - subtle and contained */
.menu-item:hover img,
.cms-menu-item:hover img {
  transform: scale(1.05); /* Reduced from 1.12 - more subtle */
  filter: brightness(1.08);
  border-radius: 14px;
}

/* Fallback for browsers without aspect-ratio support */
@supports not (aspect-ratio: 4/3) {
  .menu-item img,
  .cms-menu-item img {
    height: 220px; /* Fallback */
  }
}

/* Mobile optimization */
@media (max-width: 768px) {
  .menu-item img,
  .cms-menu-item img {
    aspect-ratio: 3/2; /* Slightly taller on mobile */
  }
}

/* Tablet optimization */
@media (min-width: 769px) and (max-width: 1024px) {
  .menu-item img,
  .cms-menu-item img {
    aspect-ratio: 5/4; /* Balanced for tablets */
  }
}

/* ================== TEXT ELEMENTS - MOVE DOWN ON HOVER ================== */
.menu-item h3,
.cms-menu-item h3 {
  margin: 1rem 0 0.5rem;
  position: relative;
  color: #2c3e50;
  font-size: 1.3rem;
  text-align: center;
  font-weight: 700;
  transition: all 0.5s cubic-bezier(0.2, 0.8, 0.4, 1);
}

.menu-item p,
.cms-menu-item p {
  margin: 0 0 1rem;
  position: relative;
  color: #666;
  font-size: 0.95rem;
  text-align: center;
  line-height: 1.6;
  transition: all 0.5s cubic-bezier(0.2, 0.8, 0.4, 1);
}

.menu-item .price,
.cms-menu-item .price,
.item-card-price {
  margin: 1rem 0;
  position: relative;
  font-size: 1.6rem;
  font-weight: 800;
  color: #d35400;
  transition: all 0.5s cubic-bezier(0.2, 0.8, 0.4, 1);
}

/* FINAL FIX: Small gap between image and text on hover */
.menu-item:hover h3,
.cms-menu-item:hover h3 {
  transform: translateY(20px); /* Creates small gap */
  margin-top: 1.2rem; /* Additional spacing */
}

.menu-item:hover p,
.cms-menu-item:hover p {
  transform: translateY(18px); /* Slightly less than h3 */
}

.menu-item:hover .price,
.cms-menu-item:hover .price,
.menu-item:hover .item-card-price {
  transform: translateY(16px); /* Slightly less than p */
}

[data-theme="dark"] .menu-item h3,
[data-theme="dark"] .cms-menu-item h3 {
  color: #ecf0f1;
}

[data-theme="dark"] .menu-item p,
[data-theme="dark"] .cms-menu-item p {
  color: #bdc3c7;
}

/* ================== POPUP STYLING - REVERTED TO ORIGINAL ================== */
.menu-item .popup,
.cms-menu-item .popup {
  display: none;
  position: absolute;
  bottom: 10px; /* Reverted to original */
  left: 10px; /* Reverted to original */
  right: 10px; /* Reverted to original */
  background: rgba(255, 255, 255, 0.95); /* Reverted to original */
  padding: 10px; /* Reverted to original */
  border-radius: 8px; /* Reverted to original */
  box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15); /* Reverted to original */
  animation: slideUpFade 0.3s ease-out; /* Reverted to original */
  z-index: 10; /* Keep high z-index */
}

[data-theme="dark"] .menu-item .popup,
[data-theme="dark"] .cms-menu-item .popup {
  background: rgba(45, 45, 45, 0.95); /* Reverted to original */
}

.menu-item.show-popup .popup,
.cms-menu-item.show-popup .popup {
  display: flex;
  justify-content: space-between;
  gap: 0.5rem; /* Reverted to original */
  align-items: center;
}

/* BUTTONS - REVERTED TO ORIGINAL */
.menu-item .add-cart,
.menu-item .order-now,
.cms-menu-item .add-cart,
.cms-menu-item .order-now {
  background: var(--primary); /* Reverted to original */
  border: none;
  color: #fff;
  padding: 0.5rem 0.875rem; /* Reverted to original */
  border-radius: 8px; /* Reverted to original */
  cursor: pointer;
  font-size: 0.95rem;
  font-weight: 600;
  position: relative;
  overflow: hidden;
  transition: all 0.3s ease; /* Reverted to original */
  line-height: 1.4;
  min-width: 100px; /* Reverted to original */
  /* Removed: gradients, text-shadow, box-shadow */
}

.menu-item .add-cart:hover,
.cms-menu-item .add-cart:hover {
  transform: translateY(-2px); /* Simplified */
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Simplified */
}

.menu-item .order-now,
.cms-menu-item .order-now {
  background: var(--secondary); /* Reverted to original */
}

.menu-item .order-now:hover,
.cms-menu-item .order-now:hover {
  transform: translateY(-2px); /* Simplified */
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Simplified */
}

/* ANIMATION - REVERTED TO ORIGINAL */
@keyframes slideUpFade {
  from {
    opacity: 0;
    transform: translateY(20px); /* Reverted to original */
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* CONFIRMATION ANIMATION (if JS uses .added class) */
.menu-item .add-cart.added,
.cms-menu-item .add-cart.added {
  animation: addConfirmation 0.6s ease-out; /* Reverted to original timing */
}

@keyframes addConfirmation {
  0% {
    background: var(--primary);
    transform: scale(1);
  }
  50% {
    background: #4caf50;
    transform: scale(1.1);
  }
  100% {
    background: var(--primary);
    transform: scale(1);
  }
}

/* ================== ENHANCED GALLERY SECTION ================== */
.gallery-section {
  padding: 4rem 1.25rem;
  text-align: center;
  position: relative;
}

.gallery-section::before {
  content: "";
  position: absolute;
  top: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 100px;
  height: 2px;
  background: linear-gradient(
    90deg,
    transparent,
    rgba(230, 122, 0, 0.4),
    transparent
  );
}

#gallery-container {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 1.75rem;
  margin-top: 2rem;
  perspective: 800px;
  /* Contain the blur */
  /* overflow: hidden;
  border-radius: 20px; */
}

/* ENHANCED BAKERY GALLERY - WITH SUBTLE ANIMATIONS */
#gallery-container img {
  width: 100%;
  aspect-ratio: 4/3;
  object-fit: cover;
  object-position: center center;
  border-radius: 16px;
  cursor: pointer;
  display: block;
  transition: all 0.6s cubic-bezier(0.23, 1, 0.32, 1);
  background: linear-gradient(135deg, #fff9e6, #fff3d6);
  /* Subtle border for light mode */
  border: 1px solid rgba(230, 122, 0, 0.1);
  position: relative;
  overflow: hidden;
  transform-origin: center center;
  filter: saturate(0.95) brightness(1);
  animation: galleryImageAppear 0.8s ease-out backwards;
  will-change: transform, filter;
  /* Light mode subtle effect - SMALL BLUR */
  box-shadow: 0 2px 8px rgba(230, 122, 0, 0.06);
}

/* STAGGERED ENTRANCE ANIMATION */
#gallery-container img {
  animation: galleryImageAppear 0.8s ease-out backwards;
}

#gallery-container img:nth-child(10n + 1) {
  animation-delay: 0.1s;
}
#gallery-container img:nth-child(10n + 2) {
  animation-delay: 0.2s;
}
#gallery-container img:nth-child(10n + 3) {
  animation-delay: 0.3s;
}
#gallery-container img:nth-child(10n + 4) {
  animation-delay: 0.4s;
}
#gallery-container img:nth-child(10n + 5) {
  animation-delay: 0.5s;
}
#gallery-container img:nth-child(10n + 6) {
  animation-delay: 0.6s;
}
#gallery-container img:nth-child(10n + 7) {
  animation-delay: 0.7s;
}
#gallery-container img:nth-child(10n + 8) {
  animation-delay: 0.8s;
}
#gallery-container img:nth-child(10n + 9) {
  animation-delay: 0.9s;
}
#gallery-container img:nth-child(10n + 10) {
  animation-delay: 1s;
}

@keyframes galleryImageAppear {
  from {
    opacity: 0;
    transform: translateY(25px) scale(0.95);
    filter: blur(5px);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
    filter: blur(0);
  }
}

/* GLOSSY OVERLAY EFFECT */
#gallery-container img::before {
  content: "";
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(
    90deg,
    transparent,
    rgba(255, 255, 255, 0.1) 30%,
    rgba(255, 255, 255, 0.2) 50%,
    rgba(255, 255, 255, 0.1) 70%,
    transparent
  );
  transition: left 1.2s cubic-bezier(0.23, 1, 0.32, 1);
  z-index: 2;
  pointer-events: none;
}

#gallery-container img:hover::before {
  left: 100%;
}

/* ENHANCED HOVER EFFECT - LIGHT MODE */
#gallery-container img:hover {
  transform: scale(1.06) translateY(-8px) rotateX(4deg) rotateY(2deg);
  border-color: rgba(230, 122, 0, 0.3);
  filter: saturate(1.15) brightness(1.08) contrast(1.05);
  z-index: 50;
  border-radius: 14px;
  /* CONTROLLED BLUR - small radius */
  box-shadow: 0 8px 20px rgba(230, 122, 0, 0.12),
    /* 20px max blur */ 0 3px 10px rgba(230, 122, 0, 0.06); /* 10px max blur */
}

/* ACTIVE/CLICK EFFECT */
#gallery-container img:active {
  transform: scale(0.97);
  transition: transform 0.15s ease;
  box-shadow: 0 4px 12px rgba(230, 122, 0, 0.15),
    0 2px 6px rgba(230, 122, 0, 0.08);
}

/* ================== DARK THEME - CONTROLLED BLUR GLOW ================== */
[data-theme="dark"] #gallery-container img {
  background: linear-gradient(135deg, #0a0a0a, #1a1a1a);
  border: 1px solid rgba(255, 255, 255, 0.08);
  position: relative;
  overflow: hidden;
  /* Clean base - no shadows */
  box-shadow: none;
}

/* INTERIOR CORNER GLOW - TIGHT AND CONTAINED */
[data-theme="dark"] #gallery-container img::after {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  border-radius: 16px;
  pointer-events: none;
  z-index: 1;
  /* Tight interior glow - small radius */
  background: radial-gradient(
      circle at 85% 85%,
      rgba(230, 122, 0, 0.25) 0%,
      rgba(230, 122, 0, 0.15) 25%,
      transparent 45% /* TIGHTER: was 60% */
    ),
    linear-gradient(
      to top,
      rgba(230, 122, 0, 0.12) 0%,
      transparent 20% /* TIGHTER: was 25% */
    ),
    linear-gradient(
      to left,
      rgba(230, 122, 0, 0.12) 0%,
      transparent 20% /* TIGHTER: was 25% */
    );
  opacity: 0.7;
  transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
}

/* DARK MODE HOVER - CONTROLLED BLUR (NO SPILL) */
[data-theme="dark"] #gallery-container img:hover {
  transform: scale(1.08) translateY(-12px) rotateX(8deg) rotateY(4deg);
  filter: saturate(1.25) brightness(1.2) contrast(1.15);
  z-index: 100;
  border-radius: 14px;
  border-color: rgba(230, 122, 0, 0.4);

  /* CONTROLLED GLOW - SMALL BLUR RADIUS */
  box-shadow:
    /* Crisp orange border - NO BLUR */ 0 0 0 1px
      rgba(230, 122, 0, 0.25),
    /* Main glow - SMALL BLUR */ 0 0 15px rgba(230, 122, 0, 0.2),
    /* 15px blur (was 30px) */ /* Outer glow - SMALLER BLUR */ 0 0 25px
      rgba(230, 122, 0, 0.1),
    /* 25px blur (was 60px) */ /* Minimal lift - VERY SMALL BLUR */ 0 10px 20px
      rgba(230, 122, 0, 0.08); /* 20px blur (was 35px) */
}

/* Interior glow intensifies */
[data-theme="dark"] #gallery-container img:hover::after {
  opacity: 0.9;
  background: radial-gradient(
      circle at 85% 85%,
      rgba(230, 122, 0, 0.35) 0%,
      rgba(230, 122, 0, 0.25) 30%,
      transparent 55% /* TIGHTER: was 70% */
    ),
    linear-gradient(
      to top,
      rgba(230, 122, 0, 0.2) 0%,
      rgba(230, 122, 0, 0.12) 15%,
      transparent 30% /* TIGHTER: was 40% */
    ),
    linear-gradient(
      to left,
      rgba(230, 122, 0, 0.2) 0%,
      rgba(230, 122, 0, 0.12) 15%,
      transparent 30% /* TIGHTER: was 40% */
    );
}

/* DARK MODE ACTIVE/CLICK - CONTROLLED PULSE */
[data-theme="dark"] #gallery-container img:active {
  transform: scale(0.96) translateY(-4px);
  transition: transform 0.12s ease;
  /* Controlled pulse - small blur */
  box-shadow: 0 0 0 2px rgba(230, 122, 0, 0.35),
    0 0 20px rgba(230, 122, 0, 0.25),
    /* 20px blur (was 40px) */ 0 0 35px rgba(230, 122, 0, 0.12),
    /* 35px blur (was 80px) */ 0 8px 18px rgba(230, 122, 0, 0.1); /* 18px blur (was 25px) */
}

[data-theme="dark"] #gallery-container img:active::after {
  /* Tighter interior pulse */
  background: radial-gradient(
    circle at 85% 85%,
    rgba(230, 122, 0, 0.45) 0%,
    rgba(230, 122, 0, 0.35) 25%,
    transparent 50% /* TIGHTER: was 65% */
  );
}

/* DARK MODE SPECIFIC GLOSSY OVERLAY */
[data-theme="dark"] #gallery-container img::before {
  background: linear-gradient(
    90deg,
    transparent,
    rgba(255, 255, 255, 0.08) 30%,
    rgba(255, 255, 255, 0.12) 50%,
    rgba(255, 255, 255, 0.08) 70%,
    transparent
  );
}

/* Browser fallback */
@supports not (aspect-ratio: 4/3) {
  #gallery-container img {
    height: 300px;
  }
}

/* CALCULATION: MAX BLUR RADIUS = 25px */
/* With 1.75rem gap (28px), blur stays within bounds */

/* ================== ORDER PAGE ================== */
.order-section {
  padding: 3.75rem 1.25rem 6.25rem;
  text-align: center;
  background: rgba(255, 255, 255, 0.9);
  animation: contentSlideUp 0.8s ease-out;
}

@keyframes contentSlideUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

[data-theme="dark"] .order-section {
  background: rgba(45, 45, 45, 0.9);
}

.cart-row {
  display: flex;
  align-items: center;
  gap: 1rem;
  margin: 1rem 0;
  background: linear-gradient(180deg, var(--background), var(--surface));
  border-radius: 12px;
  padding: 0.875rem;
  box-shadow: 0 6px 15px var(--shadow); /* Reduced from 18px */
  border: 1px solid var(--border);
  transition: box-shadow 0.3s ease, border-color 0.3s ease;
  min-height: 100px;
  position: relative;
}

.cart-row:hover {
  box-shadow: 0 8px 20px var(--shadow); /* Reduced from 25px */
  border-color: rgba(230, 122, 0, 0.3);
}

.cart-row img {
  width: 76px;
  height: 76px;
  border-radius: 10px;
  object-fit: cover;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
  transition: transform 0.3s ease;
  flex-shrink: 0;
}

.cart-row:hover img {
  transform: scale(1.05);
}

.item-info {
  flex: 1;
  min-width: 0;
}

.qty-controls {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  margin-top: 0.5rem;
  flex-wrap: nowrap;
}

.qty-controls button {
  border: none;
  background: var(--primary);
  color: #fff;
  border-radius: 50%;
  width: 1.75rem;
  height: 1.75rem;
  cursor: pointer;
  font-weight: 600;
  box-shadow: 0 6px 12px rgba(230, 122, 0, 0.12);
  transition: all 0.2s ease;
  position: relative;
  overflow: hidden;
  line-height: 1;
  flex-shrink: 0;
}

.qty-controls button:hover {
  transform: scale(1.1);
  box-shadow: 0 4px 12px rgba(230, 122, 0, 0.3);
}

.qty-controls span {
  min-width: 30px;
  text-align: center;
  font-weight: 600;
  display: inline-block;
}

.remove-item {
  background: transparent;
  border: 1px solid rgba(230, 74, 74, 0.12);
  color: #c94b4b;
  padding: 0.375rem 0.625rem;
  border-radius: 18px;
  font-size: 0.87rem;
  cursor: pointer;
  transition: background 160ms ease, transform 120ms ease, box-shadow 160ms;
  display: inline-block;
  margin-left: 0.625rem;
  line-height: 1.4;
  flex-shrink: 0;
}

.remove-item:hover {
  background: rgba(230, 74, 74, 0.06);
  transform: translateY(-2px);
  box-shadow: 0 6px 15px rgba(201, 73, 73, 0.08); /* Reduced from 18px */
}

.order-actions {
  margin-top: 1.5rem;
  display: flex;
  justify-content: center;
  gap: 1rem;
}

#cart-message {
  background: #fff4e6;
  color: #6a4b14;
  padding: 0.625rem 0.875rem;
  border-radius: 8px;
  margin-bottom: 0.875rem;
  display: inline-block;
  opacity: 0;
  transform: translateY(-6px);
  transition: opacity 220ms, transform 220ms;
}

[data-theme="dark"] #cart-message {
  background: #3a2e1a;
  color: #e6c17a;
}

#cart-message.show {
  opacity: 1;
  transform: translateY(0);
}

/* ================== CONTENT PAGES ================== */
.content-wrapper {
  max-width: 900px;
  margin: 7.5rem auto 5rem;
  background: var(--background);
  padding: 2.5rem;
  border-radius: 10px;
  box-shadow: 0 2px 10px var(--shadow);
  animation: contentSlideUp 0.8s ease-out;
}

.content-wrapper h1 {
  margin-bottom: 1rem;
  font-size: 2rem;
  color: var(--primary);
}

.content-wrapper h2 {
  margin-top: 1.25rem;
  color: var(--secondary);
}

/* ================== BOTTOM SHEET ================== */
.order-bottom-sheet {
  position: fixed;
  inset: 0;
  z-index: 2000;
  pointer-events: none;
  font-family: inherit;
}

.order-bottom-sheet .sheet-backdrop {
  position: absolute;
  inset: 0;
  background: rgba(0, 0, 0, 0.35);
  opacity: 0;
  transition: opacity 240ms ease;
  backdrop-filter: blur(2px);
}

.order-bottom-sheet .sheet-panel {
  position: absolute;
  left: 50%;
  transform: translate(-50%, 110%);
  bottom: 1.5rem;
  width: calc(100% - 1.75rem);
  max-width: 640px;
  background: linear-gradient(180deg, var(--background), var(--surface));
  border-radius: 14px;
  box-shadow: 0 12px 35px rgba(0, 0, 0, 0.18); /* Reduced from 40px */
  padding: 1.125rem;
  pointer-events: auto;
  transition: transform 360ms cubic-bezier(0.2, 0.9, 0.3, 1), opacity 260ms;
  opacity: 0;
}

.order-bottom-sheet.visible {
  pointer-events: auto;
}

.order-bottom-sheet.visible .sheet-backdrop {
  opacity: 1;
}

.order-bottom-sheet.visible .sheet-panel {
  transform: translate(-50%, 0);
  opacity: 1;
}

.sheet-close {
  position: absolute;
  right: 0.75rem;
  top: 0.625rem;
  border: none;
  background: transparent;
  font-size: 1.05rem;
  cursor: pointer;
  color: var(--text);
  transition: transform 0.3s ease;
  padding: 0.25rem;
  border-radius: 4px;
}

.sheet-close:hover {
  transform: scale(1.1);
}

.sheet-panel h3 {
  font-size: 1.1rem;
  margin-bottom: 0.5rem;
  color: var(--text);
}

.order-summary {
  margin: 0.375rem 0 0.75rem;
  padding: 0.625rem;
  border-radius: 8px;
  background: rgba(246, 246, 246, 0.9);
}

[data-theme="dark"] .order-summary {
  background: rgba(60, 60, 60, 0.9);
}

.summary-row {
  display: flex;
  justify-content: space-between;
  padding: 0.375rem 0;
  font-size: 0.95rem;
  color: var(--text);
}

.summary-total {
  padding-top: 0.5rem;
  font-weight: 700;
  text-align: right;
}

.sheet-actions {
  display: flex;
  gap: 0.625rem;
  margin-top: 0.75rem;
}

.order-option-btn {
  flex: 1;
  padding: 0.75rem;
  border-radius: 12px;
  border: none;
  cursor: pointer;
  font-weight: 600;
  transition: transform 0.3s ease;
  position: relative;
  overflow: hidden;
  line-height: 1.4;
}

.order-option-btn:hover {
  transform: translateY(-3px);
}

#order-via-gmail.order-option-btn {
  background: linear-gradient(180deg, #ff6b6b, #e64a4a);
  color: white;
  box-shadow: 0 6px 15px rgba(230, 74, 74, 0.18); /* Reduced from 18px */
}

#order-via-whatsapp.order-option-btn {
  background: linear-gradient(180deg, #30d46f, #1ebe5b);
  color: white;
  box-shadow: 0 6px 15px rgba(30, 190, 91, 0.16); /* Reduced from 18px */
}

.sheet-note {
  display: block;
  margin-top: 0.75rem;
  font-size: 0.82rem;
  color: var(--text-light);
}

/* ================== RIPPLE EFFECT ================== */
.ripple-effect {
  position: absolute;
  border-radius: 50%;
  transform: scale(0);
  animation: enhancedRipple 0.8s ease-out;
  background: radial-gradient(
    circle,
    rgba(255, 255, 255, 0.6) 0%,
    rgba(255, 255, 255, 0) 70%
  );
  pointer-events: none;
  will-change: transform, opacity;
}

@keyframes enhancedRipple {
  0% {
    transform: scale(0);
    opacity: 1;
  }
  50% {
    opacity: 0.7;
  }
  100% {
    transform: scale(4);
    opacity: 0;
  }
}

.btn,
.add-cart,
.order-now,
.order-option-btn {
  position: relative;
  overflow: hidden;
}

/* ================== FOOTER ================== */
.bakes-footer {
  background: linear-gradient(135deg, #fff8f0 0%, #f5e6d8 100%);
  color: #5a3921;
  padding: 3.125rem 1.25rem 1.5625rem;
  margin-top: 5rem;
  border-top: 2px solid #d4a76a;
  font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
  position: relative;
  transition: all 0.5s ease;
  box-shadow: 0 -5px 20px rgba(90, 57, 33, 0.1); /* Reduced from 25px */
}

.bakes-footer.dark-theme {
  background: linear-gradient(135deg, #2a1c0f 0%, #3a2515 100%);
  color: #fff8f0;
  border-top: 2px solid #d4a76a;
  box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.4); /* Reduced from 25px */
}

.bakes-footer::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-image: radial-gradient(
      circle at 20% 80%,
      rgba(212, 167, 106, 0.1) 0%,
      transparent 50%
    ),
    radial-gradient(
      circle at 80% 20%,
      rgba(90, 57, 33, 0.05) 0%,
      transparent 50%
    );
  pointer-events: none;
  transition: all 0.5s ease;
}

.bakes-footer.dark-theme::before {
  background-image: radial-gradient(
      circle at 20% 80%,
      rgba(212, 167, 106, 0.15) 0%,
      transparent 50%
    ),
    radial-gradient(
      circle at 80% 20%,
      rgba(255, 248, 240, 0.05) 0%,
      transparent 50%
    );
}

.footer-content {
  max-width: 500px;
  margin: 0 auto 2.1875rem;
  text-align: center;
  position: relative;
  z-index: 2;
}

.footer-brand h3 {
  color: #d4a76a;
  font-size: 2rem;
  margin-bottom: 0.625rem;
  font-weight: 700;
  transition: all 0.3s ease;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.footer-brand h3:hover {
  transform: translateY(-3px);
  text-shadow: 0 4px 8px rgba(212, 167, 106, 0.3);
}

.tagline {
  color: inherit;
  font-size: 1.1rem;
  margin-bottom: 1.875rem;
  opacity: 0.9;
  font-style: italic;
  transition: all 0.3s ease;
  font-weight: 500;
}

.tagline:hover {
  opacity: 1;
  transform: scale(1.02);
}

.footer-info {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 3.125rem;
  flex-wrap: wrap;
  margin-bottom: 0.625rem;
}

.phone-link {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  text-decoration: none;
  color: inherit;
  font-weight: 600;
  font-size: 1.1rem;
  padding: 0.75rem 1.5rem;
  border-radius: 30px;
  transition: all 0.4s ease;
  background: rgba(212, 167, 106, 0.1);
  border: 2px solid transparent;
  position: relative;
  overflow: hidden;
}

.phone-link::before {
  content: "";
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(
    90deg,
    transparent,
    rgba(212, 167, 106, 0.2),
    transparent
  );
  transition: left 0.6s ease;
}

.phone-link:hover::before {
  left: 100%;
}

.phone-link:hover {
  transform: translateY(-3px);
  background: rgba(212, 167, 106, 0.2);
  border-color: #d4a76a;
  box-shadow: 0 8px 20px rgba(212, 167, 106, 0.3);
  color: #5a3921;
}

.bakes-footer.dark-theme .phone-link:hover {
  color: #fff8f0;
}

.phone-link i {
  transition: all 0.3s ease;
}

.phone-link:hover i {
  transform: scale(1.3) rotate(10deg);
}

.social-links {
  display: flex;
  align-items: center;
  gap: 1.25rem;
}

.follow-text {
  color: inherit;
  font-size: 1rem;
  opacity: 0.9;
  font-weight: 600;
  transition: all 0.3s ease;
  position: relative;
}

.follow-text::after {
  content: "";
  position: absolute;
  bottom: -5px;
  left: 0;
  width: 0;
  height: 2px;
  background: #d4a76a;
  transition: width 0.3s ease;
}

.follow-text:hover::after {
  width: 100%;
}

.follow-text:hover {
  opacity: 1;
  transform: translateX(5px);
}

.social-icons {
  display: flex;
  gap: 0.9375rem;
}

.social-icon {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 2.8125rem;
  height: 2.8125rem;
  border-radius: 50%;
  font-size: 1.3rem;
  transition: all 0.4s ease;
  text-decoration: none;
  position: relative;
  overflow: hidden;
  background: rgba(90, 57, 33, 0.1);
  color: #5a3921;
  border: 2px solid transparent;
}

.bakes-footer.dark-theme .social-icon {
  background: rgba(255, 248, 240, 0.1);
  color: #fff8f0;
}

.social-icon::before {
  content: "";
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(
    90deg,
    transparent,
    rgba(255, 255, 255, 0.3),
    transparent
  );
  transition: left 0.6s ease;
}

.social-icon:hover::before {
  left: 100%;
}

.social-icon:hover {
  background: #d4a76a;
  color: white;
  transform: translateY(-5px) scale(1.15);
  border-color: #d4a76a;
  box-shadow: 0 10px 20px rgba(212, 167, 106, 0.4); /* Reduced from 25px */
}

.footer-bottom {
  border-top: 1px solid rgba(212, 167, 106, 0.3);
  padding-top: 1.5625rem;
  text-align: center;
  position: relative;
  z-index: 2;
}

.legal-links {
  display: flex;
  justify-content: center;
  gap: 1.875rem;
  margin-bottom: 0.9375rem;
}

.legal-link {
  color: inherit;
  text-decoration: none;
  font-size: 0.9rem;
  opacity: 0.8;
  transition: all 0.3s ease;
  padding: 0.375rem 0.75rem;
  border-radius: 6px;
  position: relative;
  font-weight: 500;
}

.legal-link::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(212, 167, 106, 0.1);
  border-radius: 6px;
  transform: scale(0);
  transition: transform 0.3s ease;
}

.legal-link:hover::before {
  transform: scale(1);
}

.legal-link:hover {
  opacity: 1;
  color: #d4a76a;
  transform: translateY(-2px);
}

.copyright {
  color: inherit;
  font-size: 0.85rem;
  opacity: 0.7;
  margin: 0;
  transition: all 0.3s ease;
  font-weight: 500;
}

.copyright:hover {
  opacity: 1;
  transform: scale(1.05);
}

/* Enhanced Minimal Scrollbar */
::-webkit-scrollbar {
  width: 12px;
  transition: width 0.3s ease;
}

::-webkit-scrollbar-track {
  background: var(--surface);
  border-radius: 0px;
  transition: background 0.3s ease;
}

::-webkit-scrollbar-thumb {
  background: linear-gradient(to bottom, var(--primary), #ff8c42);
  border-radius: 6px;
  border: 2px solid var(--surface);
  transition: all 0.3s ease;
  position: relative;
}

::-webkit-scrollbar-thumb:hover {
  background: linear-gradient(to bottom, #ff8c42, var(--primary));
  transform: scaleX(1.1);
  box-shadow: 0 0 10px rgba(230, 122, 0, 0.3);
}

::-webkit-scrollbar-thumb:active {
  background: linear-gradient(to bottom, #e65a00, var(--primary));
}

::-webkit-scrollbar:hover {
  width: 14px;
}

/* Firefox */
html {
  scrollbar-width: thin;
  scrollbar-color: var(--primary) var(--surface);
  transition: scrollbar-color 0.3s ease;
}

/* Dark theme */
[data-theme="dark"] ::-webkit-scrollbar-track {
  background: var(--bg-secondary);
}

[data-theme="dark"] ::-webkit-scrollbar-thumb {
  border-color: var(--bg-secondary);
  background: linear-gradient(to bottom, var(--primary), #d46b00);
}

[data-theme="dark"] html {
  scrollbar-color: var(--primary) var(--bg-secondary);
}

/* Mobile scrollbar */
@media (max-width: 768px) {
  ::-webkit-scrollbar {
    width: 8px;
  }

  ::-webkit-scrollbar:hover {
    width: 9px;
  }

  ::-webkit-scrollbar-thumb:hover {
    transform: none;
  }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
  ::-webkit-scrollbar,
  ::-webkit-scrollbar-thumb {
    transition: none;
  }

  ::-webkit-scrollbar:hover {
    width: 12px;
  }

  ::-webkit-scrollbar-thumb:hover {
    transform: none;
  }
}

/* ================== ENHANCED ADMIN PANEL STYLES ================== */

/* Modern Glassmorphism Login Screen */
.admin-login-container {
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(
    135deg,
    rgba(230, 122, 0, 0.08) 0%,
    rgba(255, 255, 255, 0.1) 50%,
    rgba(230, 122, 0, 0.05) 100%
  );
  backdrop-filter: blur(10px);
  padding: 20px;
  position: relative;
  overflow: hidden;
}

.admin-login-container::before {
  content: "";
  position: absolute;
  width: 400px;
  height: 400px;
  border-radius: 50%;
  background: radial-gradient(
    circle,
    rgba(230, 122, 0, 0.15) 0%,
    rgba(230, 122, 0, 0) 70%
  );
  top: -100px;
  right: -100px;
  animation: float 6s ease-in-out infinite;
}

@keyframes float {
  0%,
  100% {
    transform: translateY(0px) rotate(0deg);
  }
  50% {
    transform: translateY(-20px) rotate(5deg);
  }
}

.admin-login-box {
  background: rgba(255, 255, 255, 0.92);
  backdrop-filter: blur(20px);
  padding: 3rem;
  border-radius: 24px;
  box-shadow: 0 20px 40px rgba(230, 122, 0, 0.15),
    0 8px 20px rgba(0, 0, 0, 0.05), inset 0 1px 0 rgba(255, 255, 255, 0.6);
  width: 100%;
  max-width: 440px;
  text-align: center;
  animation: slideUpFade 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  border: 1px solid rgba(230, 122, 0, 0.1);
  position: relative;
  z-index: 2;
}

[data-theme="dark"] .admin-login-box {
  background: rgba(45, 45, 45, 0.92);
  border: 1px solid rgba(230, 122, 0, 0.2);
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3), 0 8px 20px rgba(0, 0, 0, 0.2),
    inset 0 1px 0 rgba(255, 255, 255, 0.1);
}

.admin-brand {
  margin-bottom: 2.5rem;
}

.admin-logo {
  width: 100px;
  height: 100px;
  border-radius: 50%;
  object-fit: cover;
  margin-bottom: 1.5rem;
  border: 4px solid var(--primary);
  box-shadow: 0 8px 24px rgba(230, 122, 0, 0.2);
  transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}

.admin-logo:hover {
  transform: scale(1.05) rotate(5deg);
  box-shadow: 0 12px 32px rgba(230, 122, 0, 0.3);
}

.admin-subtitle {
  color: var(--text-light);
  font-size: 0.95rem;
  margin-top: 0.75rem;
  font-weight: 400;
}

/* Modern Admin Dashboard */
.admin-dashboard {
  min-height: 100vh;
  background: var(--surface);
  position: relative;
}

.admin-dashboard::before {
  content: "";
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  height: 300px;
  background: linear-gradient(
    135deg,
    rgba(230, 122, 0, 0.05) 0%,
    rgba(230, 122, 0, 0) 100%
  );
  z-index: 0;
}

.admin-header {
  background: rgba(255, 255, 255, 0.98);
  backdrop-filter: blur(20px);
  box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
  position: sticky;
  top: 0;
  z-index: 1000;
  border-bottom: 1px solid rgba(230, 122, 0, 0.1);
}

[data-theme="dark"] .admin-header {
  background: rgba(45, 45, 45, 0.98);
}

/* Modern Tab Navigation - FIXED FOR MOBILE (NO CUTTING) */
.admin-tabs {
  display: flex;
  background: transparent;
  padding: 0 1.5rem;
  overflow-x: auto;
  gap: 0.5rem;
  scrollbar-width: thin;
  -webkit-overflow-scrolling: touch;
}

.admin-tabs::-webkit-scrollbar {
  height: 4px;
}

.admin-tabs::-webkit-scrollbar-thumb {
  background: var(--primary);
  border-radius: 2px;
}

.admin-tab {
  padding: 1rem 1.25rem;
  background: transparent;
  border: none;
  color: var(--text-light);
  font-size: 0.95rem;
  font-weight: 500;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 0.75rem;
  transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  white-space: nowrap;
  border-radius: 12px;
  position: relative;
  overflow: hidden;
  flex-shrink: 0;
  min-width: max-content;
}

.admin-tab::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(
    135deg,
    rgba(230, 122, 0, 0.1) 0%,
    rgba(230, 122, 0, 0.05) 100%
  );
  border-radius: 12px;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.admin-tab:hover {
  color: var(--primary);
  transform: translateY(-2px);
}

.admin-tab:hover::before {
  opacity: 1;
}

.admin-tab.active {
  color: var(--primary);
  background: linear-gradient(
    135deg,
    rgba(230, 122, 0, 0.15) 0%,
    rgba(230, 122, 0, 0.05) 100%
  );
  box-shadow: 0 4px 12px rgba(230, 122, 0, 0.15),
    inset 0 1px 0 rgba(255, 255, 255, 0.5);
}

[data-theme="dark"] .admin-tab.active {
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3),
    inset 0 1px 0 rgba(255, 255, 255, 0.1);
}

.admin-tab.active::after {
  content: "";
  position: absolute;
  bottom: -1px;
  left: 50%;
  transform: translateX(-50%);
  width: 40px;
  height: 3px;
  background: linear-gradient(90deg, var(--primary), #ff8c42);
  border-radius: 2px;
  animation: tabSlide 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}

@keyframes tabSlide {
  from {
    width: 0;
    opacity: 0;
  }
  to {
    width: 40px;
    opacity: 1;
  }
}

/* Modern Storage Status */
.storage-status {
  background: linear-gradient(
    135deg,
    rgba(255, 255, 255, 0.9) 0%,
    rgba(255, 255, 255, 0.7) 100%
  );
  backdrop-filter: blur(10px);
  padding: 1.25rem 1.5rem;
  border-bottom: 1px solid rgba(230, 122, 0, 0.1);
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 1.5rem;
  flex-wrap: wrap;
}

[data-theme="dark"] .storage-status {
  background: linear-gradient(
    135deg,
    rgba(45, 45, 45, 0.9) 0%,
    rgba(45, 45, 45, 0.7) 100%
  );
}

.storage-info {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  color: var(--text-light);
  font-size: 0.95rem;
  flex: 1;
  min-width: 200px;
}

.storage-bar {
  flex: 1;
  max-width: 300px;
  height: 10px;
  background: var(--border);
  border-radius: 5px;
  overflow: hidden;
  box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
}

.storage-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--primary), #ff8c42);
  border-radius: 5px;
  transition: width 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  width: 0%;
  position: relative;
  overflow: hidden;
}

.storage-fill::after {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(
    90deg,
    transparent,
    rgba(255, 255, 255, 0.3),
    transparent
  );
  animation: shimmer 2s infinite;
}

@keyframes shimmer {
  0% {
    transform: translateX(-100%);
  }
  100% {
    transform: translateX(100%);
  }
}

/* Modern Admin Main Content */
.admin-main {
  max-width: 1400px;
  margin: 0 auto;
  padding: 2.5rem 1.5rem;
  position: relative;
  z-index: 1;
}

.admin-section-header {
  margin-bottom: 2.5rem;
  padding-bottom: 1.5rem;
  border-bottom: 1px solid rgba(230, 122, 0, 0.1);
  position: relative;
}

.admin-section-header::after {
  content: "";
  position: absolute;
  bottom: -1px;
  left: 0;
  width: 100px;
  height: 2px;
  background: linear-gradient(90deg, var(--primary), transparent);
}

.admin-section-header h2 {
  font-size: 2rem;
  margin-bottom: 0.75rem;
  display: flex;
  align-items: center;
  gap: 1rem;
  color: var(--text);
}

.admin-section-header h2 i {
  color: var(--primary);
  font-size: 1.8rem;
  background: linear-gradient(
    135deg,
    rgba(230, 122, 0, 0.15) 0%,
    rgba(230, 122, 0, 0.05) 100%
  );
  width: 56px;
  height: 56px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 16px;
  box-shadow: 0 4px 12px rgba(230, 122, 0, 0.1);
}

.admin-section-header p {
  color: var(--text-light);
  margin-bottom: 1.5rem;
  font-size: 1.05rem;
  max-width: 800px;
  line-height: 1.6;
}

/* Modern Buttons */
.btn-admin {
  background: linear-gradient(135deg, var(--primary), #ff8c42);
  color: #fff;
  padding: 0.875rem 1.75rem;
  border-radius: 12px;
  border: none;
  font-weight: 600;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  gap: 0.75rem;
  transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  position: relative;
  overflow: hidden;
  font-size: 1rem;
  box-shadow: 0 4px 15px rgba(230, 122, 0, 0.2);
}

.btn-admin::before {
  content: "";
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(
    90deg,
    transparent,
    rgba(255, 255, 255, 0.3),
    transparent
  );
  transition: left 0.6s ease;
}

.btn-admin:hover::before {
  left: 100%;
}

.btn-admin:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 20px rgba(230, 122, 0, 0.3); /* Reduced from 25px */
}

.btn-admin:active {
  transform: translateY(-1px);
}

.btn-danger {
  background: linear-gradient(135deg, #ff6b6b, #e64a4a);
  box-shadow: 0 4px 15px rgba(230, 74, 74, 0.2);
}

.btn-danger:hover {
  box-shadow: 0 8px 20px rgba(230, 74, 74, 0.3); /* Reduced from 25px */
}

/* Modern Form Container */
.admin-form-container {
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(10px);
  padding: 2.5rem;
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08), 0 2px 8px rgba(0, 0, 0, 0.04),
    inset 0 1px 0 rgba(255, 255, 255, 0.6);
  margin-bottom: 2.5rem;
  animation: slideUpFade 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  border: 1px solid rgba(230, 122, 0, 0.1);
}

[data-theme="dark"] .admin-form-container {
  background: rgba(45, 45, 45, 0.95);
  border: 1px solid rgba(230, 122, 0, 0.2);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), 0 2px 8px rgba(0, 0, 0, 0.2),
    inset 0 1px 0 rgba(255, 255, 255, 0.1);
}

.admin-form {
  display: flex;
  flex-direction: column;
  gap: 1.75rem;
}

/* Modern Form Groups */
.form-row {
  display: flex;
  gap: 1.75rem;
  margin-bottom: 0.5rem;
}

.form-row .form-group {
  flex: 1;
}

.form-group {
  margin-bottom: 1.25rem;
}

.form-group label {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  margin-bottom: 0.75rem;
  color: var(--text);
  font-weight: 500;
  font-size: 0.95rem;
}

.form-group label i {
  color: var(--primary);
  width: 20px;
  text-align: center;
}

.form-group input,
.form-group textarea,
.form-group select {
  width: 100%;
  padding: 1rem 1.25rem;
  border: 2px solid var(--border);
  border-radius: 12px;
  font-size: 1rem;
  background: var(--surface);
  color: var(--text);
  transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  font-family: inherit;
}

.form-group textarea {
  min-height: 120px;
  resize: vertical;
  line-height: 1.6;
}

.form-group input:focus,
.form-group textarea:focus,
.form-group select:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(230, 122, 0, 0.1),
    0 4px 12px rgba(230, 122, 0, 0.08);
  background: var(--background);
}

.form-help {
  display: block;
  margin-top: 0.5rem;
  color: var(--text-light);
  font-size: 0.85rem;
  line-height: 1.5;
}

/* Modern Image Preview */
.image-preview {
  margin-top: 1.25rem;
  padding: 1.5rem;
  border: 2px dashed var(--border);
  border-radius: 16px;
  text-align: center;
  min-height: 180px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--surface);
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.image-preview:hover {
  border-color: var(--primary);
  background: rgba(230, 122, 0, 0.02);
}

.image-preview img {
  max-width: 100%;
  max-height: 220px;
  border-radius: 12px;
  box-shadow: 0 8px 24px var(--shadow);
  transition: transform 0.3s ease;
}

.image-preview img:hover {
  transform: scale(1.02);
}

/* Modern Form Actions */
.form-actions {
  display: flex;
  gap: 1rem;
  margin-top: 2rem;
  padding-top: 1.5rem;
  border-top: 1px solid rgba(230, 122, 0, 0.1);
}

/* Modern Items Grid */
.items-list {
  display: grid;
  gap: 2rem;
  grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
}

.item-card {
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(10px);
  border-radius: 20px;
  overflow: hidden;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08), 0 2px 8px rgba(0, 0, 0, 0.04);
  transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  border: 1px solid rgba(230, 122, 0, 0.1);
}

[data-theme="dark"] .item-card {
  background: rgba(45, 45, 45, 0.95);
  border: 1px solid rgba(230, 122, 0, 0.2);
}

.item-card:hover {
  transform: translateY(-8px);
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.12), 0 8px 20px rgba(0, 0, 0, 0.06);
}

.item-card-img {
  height: 220px;
  width: 100%;
  object-fit: cover;
  transition: transform 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  position: relative;
}

.item-card:hover .item-card-img {
  transform: scale(1.05);
}

.item-card-img::after {
  content: "";
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 60px;
  background: linear-gradient(to top, rgba(0, 0, 0, 0.3), transparent);
}

.item-card-content {
  padding: 1.75rem;
}

.item-card-title {
  font-size: 1.3rem;
  margin-bottom: 0.875rem;
  color: var(--text);
  font-weight: 600;
  line-height: 1.4;
}

.item-card-desc {
  color: var(--text-light);
  font-size: 0.95rem;
  margin-bottom: 1.25rem;
  line-height: 1.6;
  display: -webkit-box;
  line-clamp: 3; /* ‚Üê ADD THIS STANDARD PROPERTY */
  -webkit-line-clamp: 3;
  box-orient: vertical; /* ‚Üê ADD THIS STANDARD PROPERTY */
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.item-card-price {
  color: #d35400;
  font-weight: 700;
  font-size: 1.25rem;
  margin-bottom: 1.5rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.item-card-price::before {
  content: "‚Ç¶";
  font-size: 0.9em;
  opacity: 0.8;
}

.item-card-actions {
  display: flex;
  gap: 0.875rem;
}

.item-card-actions button {
  flex: 1;
  padding: 0.75rem;
  border-radius: 10px;
  border: none;
  cursor: pointer;
  font-size: 0.95rem;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  font-weight: 500;
}

.btn-edit {
  background: linear-gradient(
    135deg,
    rgba(230, 122, 0, 0.15) 0%,
    rgba(230, 122, 0, 0.05) 100%
  );
  color: var(--primary);
  border: 1px solid rgba(230, 122, 0, 0.2);
}

.btn-edit:hover {
  background: linear-gradient(
    135deg,
    rgba(230, 122, 0, 0.25) 0%,
    rgba(230, 122, 0, 0.15) 100%
  );
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(230, 122, 0, 0.15);
}

.btn-delete {
  background: linear-gradient(
    135deg,
    rgba(230, 74, 74, 0.15) 0%,
    rgba(230, 74, 74, 0.05) 100%
  );
  color: #e64a4a;
  border: 1px solid rgba(230, 74, 74, 0.2);
}

.btn-delete:hover {
  background: linear-gradient(
    135deg,
    rgba(230, 74, 74, 0.25) 0%,
    rgba(230, 74, 74, 0.15) 100%
  );
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(230, 74, 74, 0.15);
}

/* Modern Gallery Grid - ENHANCED VERSION */
.gallery-admin-grid {
  display: grid;
  gap: 2.5rem;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  padding: 0.5rem;
}

.gallery-admin-item {
  position: relative;
  border-radius: 20px;
  overflow: hidden;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08),
    0 4px 12px rgba(230, 122, 0, 0.05);
  transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
  border: 1px solid rgba(230, 122, 0, 0.12);
  background: var(--surface);
}

.gallery-admin-item:hover {
  transform: translateY(-12px) scale(1.02);
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15),
    0 15px 30px rgba(230, 122, 0, 0.12);
}

.gallery-admin-item img {
  width: 100%;
  height: 280px;
  object-fit: contain;
  display: block;
  transition: all 0.7s cubic-bezier(0.34, 1.56, 0.64, 1);
  padding: 1.5rem;
  background: var(--background);
  filter: saturate(0.95) brightness(0.98);
  transform: scale(0.98);
}

.gallery-admin-item:hover img {
  transform: scale(1.05);
  filter: saturate(1.05) brightness(1.05);
  animation: gentleFloat 3s ease-in-out infinite;
}

@keyframes gentleFloat {
  0%,
  100% {
    transform: translateY(0) scale(1.05);
  }
  50% {
    transform: translateY(-10px) scale(1.07);
  }
}

.gallery-admin-overlay {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  background: linear-gradient(
    to top,
    rgba(230, 122, 0, 0.95) 0%,
    rgba(230, 122, 0, 0.8) 50%,
    transparent 100%
  );
  color: white;
  padding: 2rem;
  transform: translateY(100%);
  transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
  backdrop-filter: blur(10px);
  text-align: center;
}

.gallery-admin-item:hover .gallery-admin-overlay {
  transform: translateY(0);
  padding-bottom: 2.5rem;
}

.gallery-admin-actions {
  display: flex;
  gap: 1rem;
  margin-top: 1.5rem;
  justify-content: center;
}

.gallery-admin-actions button {
  padding: 0.75rem 1.5rem;
  border-radius: 12px;
  border: 2px solid rgba(255, 255, 255, 0.3);
  background: rgba(255, 255, 255, 0.15);
  color: white;
  font-weight: 500;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  backdrop-filter: blur(10px);
}

.gallery-admin-actions button:hover {
  background: rgba(255, 255, 255, 0.25);
  transform: translateY(-3px);
  border-color: rgba(255, 255, 255, 0.5);
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
}

/* Modern Settings Grid */
.settings-grid {
  display: grid;
  gap: 2.5rem;
  grid-template-columns: repeat(auto-fit, minmax(360px, 1fr));
}

.settings-card {
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(10px);
  padding: 2.5rem;
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08), 0 2px 8px rgba(0, 0, 0, 0.04);
  transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  border: 1px solid rgba(230, 122, 0, 0.1);
}

[data-theme="dark"] .settings-card {
  background: rgba(45, 45, 45, 0.95);
  border: 1px solid rgba(230, 122, 0, 0.2);
}

.settings-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 16px 40px rgba(0, 0, 0, 0.12), 0 4px 16px rgba(0, 0, 0, 0.06);
}

.settings-card h3 {
  margin-bottom: 1.75rem;
  display: flex;
  align-items: center;
  gap: 1rem;
  color: var(--text);
  font-size: 1.5rem;
}

.settings-card h3 i {
  color: var(--primary);
  background: linear-gradient(
    135deg,
    rgba(230, 122, 0, 0.15) 0%,
    rgba(230, 122, 0, 0.05) 100%
  );
  width: 48px;
  height: 48px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(230, 122, 0, 0.1);
}

.settings-actions {
  display: flex;
  flex-direction: column;
  gap: 1.25rem;
}

.system-info {
  color: var(--text-light);
  line-height: 1.7;
}

.system-info p {
  margin-bottom: 0.875rem;
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.system-info p i {
  color: var(--primary);
  width: 20px;
}

.system-info ul {
  margin-top: 1rem;
  padding-left: 1.75rem;
}

.system-info li {
  margin-bottom: 0.75rem;
  position: relative;
}

.system-info li::before {
  content: "‚Ä¢";
  color: var(--primary);
  position: absolute;
  left: -1.25rem;
}

/* Modern Empty States */
.empty-state {
  text-align: center;
  padding: 5rem 2rem;
  color: var(--text-light);
  background: var(--surface);
  border-radius: 20px;
  border: 2px dashed var(--border);
  position: relative;
  overflow: hidden;
}

.empty-state::before {
  content: "";
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 200px;
  height: 200px;
  background: radial-gradient(
    circle,
    rgba(230, 122, 0, 0.05) 0%,
    transparent 70%
  );
}

.empty-state i {
  font-size: 4rem;
  margin-bottom: 1.5rem;
  opacity: 0.5;
  color: var(--primary);
  position: relative;
  z-index: 1;
}

.empty-state p {
  font-size: 1.2rem;
  margin-bottom: 1rem;
  position: relative;
  z-index: 1;
}

.empty-state .btn-admin {
  position: relative;
  z-index: 1;
  margin-top: 1.5rem;
}

/* Modern Loading States */
.loading-message {
  text-align: center;
  padding: 3rem;
  color: var(--text-light);
  font-style: italic;
  background: var(--surface);
  border-radius: 20px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 1.5rem;
}

.loading-spinner {
  width: 60px;
  height: 60px;
  border: 3px solid var(--border);
  border-top-color: var(--primary);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}

/* Modern Tab Panes */
.tab-pane {
  display: none;
  animation: fadeIn 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}

.tab-pane.active {
  display: block;
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Modern Confirmation Dialog Styles */
.confirmation-dialog {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(8px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}

.confirmation-dialog.active {
  opacity: 1;
  visibility: visible;
}

.confirmation-content {
  background: rgba(255, 255, 255, 0.98);
  backdrop-filter: blur(20px);
  border-radius: 24px;
  padding: 2.5rem;
  max-width: 500px;
  width: 90%;
  box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15), 0 10px 30px rgba(0, 0, 0, 0.1);
  transform: translateY(20px) scale(0.95);
  transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  border: 1px solid rgba(230, 122, 0, 0.1);
}

.confirmation-dialog.active .confirmation-content {
  transform: translateY(0) scale(1);
}

[data-theme="dark"] .confirmation-content {
  background: rgba(45, 45, 45, 0.98);
  border: 1px solid rgba(230, 122, 0, 0.2);
}

.confirmation-header {
  margin-bottom: 1.5rem;
  text-align: center;
}

.confirmation-header i {
  font-size: 3.5rem;
  color: #e64a4a;
  margin-bottom: 1rem;
  animation: pulse 1.5s ease-in-out infinite;
}

@keyframes pulse {
  0%,
  100% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.1);
  }
}

.confirmation-header h3 {
  font-size: 1.8rem;
  margin-bottom: 0.75rem;
  color: var(--text);
}

.confirmation-header p {
  color: var(--text-light);
  line-height: 1.6;
}

.confirmation-body {
  margin-bottom: 2rem;
}

.confirmation-body p {
  color: var(--text-light);
  line-height: 1.6;
  margin-bottom: 1rem;
}

.confirmation-item {
  background: rgba(230, 122, 0, 0.05);
  border-radius: 12px;
  padding: 1.25rem;
  margin-top: 1rem;
  border-left: 4px solid var(--primary);
}

.confirmation-item h4 {
  color: var(--text);
  margin-bottom: 0.5rem;
  font-size: 1.1rem;
}

.confirmation-actions {
  display: flex;
  gap: 1rem;
  justify-content: center;
}

.confirmation-actions button {
  flex: 1;
  padding: 1rem 1.5rem;
  border-radius: 12px;
  border: none;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.75rem;
}

.btn-confirm-cancel {
  background: linear-gradient(
    135deg,
    rgba(108, 117, 125, 0.15) 0%,
    rgba(108, 117, 125, 0.05) 100%
  );
  color: #6c757d;
  border: 1px solid rgba(108, 117, 125, 0.2);
}

.btn-confirm-cancel:hover {
  background: linear-gradient(
    135deg,
    rgba(108, 117, 125, 0.25) 0%,
    rgba(108, 117, 125, 0.15) 100%
  );
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(108, 117, 125, 0.15);
}

.btn-confirm-delete {
  background: linear-gradient(135deg, #ff6b6b, #e64a4a);
  color: white;
  box-shadow: 0 4px 15px rgba(230, 74, 74, 0.2);
}

.btn-confirm-delete:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(230, 74, 74, 0.3); /* Reduced from 25px */
  background: linear-gradient(135deg, #e64a4a, #ff6b6b);
}

/* ================== RESPONSIVE DESIGN ================== */
/* Consolidated all media queries into this single section */

/* Large Desktops (1200px and up) */
@media (min-width: 1200px) {
  #featured-container,
  .featured-grid {
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 3rem;
  }

  .featured-item img {
    height: 280px;
  }

  .menu-item:hover,
  .cms-menu-item:hover {
    transform: translateY(-6px) scale(1.01);
  }

  .menu-item:hover img,
  .cms-menu-item:hover img {
    transform: scale(1.09);
  }

  #gallery-container {
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
  }

  #gallery-container img:hover {
    transform: scale(1.06) translateY(-10px) rotateX(4deg) rotateY(1.5deg);
  }
}

/* Tablets and Small Desktops (769px to 1024px) */
@media (min-width: 769px) and (max-width: 1024px) {
  .items-list,
  .gallery-admin-grid {
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  }

  .settings-grid {
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
  }

  .admin-tab {
    padding: 1rem 1.25rem;
  }
}

/* Desktop (769px and up) - hide toggle, show nav links */
@media (min-width: 769px) {
  .navbar-toggle {
    display: none !important;
  }

  .navbar ul {
    display: flex !important;
  }
}

/* Mobile and Tablets (768px and down) */
@media (max-width: 768px) {
  /* Header & Navigation */
  .navbar {
    gap: 0.5rem;
  }

  .navbar ul {
    display: none;
    flex-direction: column;
    background: rgba(255, 255, 255, 0.97);
    position: absolute;
    top: 4.0625rem;
    right: 0.9375rem;
    padding: 0.9375rem;
    border-radius: 10px;
    box-shadow: 0 4px 10px var(--shadow);
    min-width: 150px;
    z-index: 1001;
    animation: mobileMenuSlide 0.3s ease-out;
    gap: 0.75rem;
  }

  @keyframes mobileMenuSlide {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  [data-theme="dark"] .navbar ul {
    background: rgba(45, 45, 45, 0.97);
  }

  .navbar ul.show {
    display: flex;
  }

  .navbar-toggle {
    display: flex;
    order: 1;
  }

  .cart-link {
    order: 2;
    font-size: 1.1rem;
  }

  .theme-toggle {
    order: 3;
    font-size: 1.2rem;
    width: 2.25rem;
    height: 2.25rem;
  }

  .header-inner {
    padding: 0.625rem 0.9375rem;
  }

  .hero {
    padding: 8.75rem 0.9375rem 5.625rem;
  }

  .brand h1 {
    font-size: 1.2rem;
  }

  /* Featured Items */
  .featured {
    padding: 4rem 1rem;
  }

  #featured-container,
  .featured-grid {
    grid-template-columns: 1fr;
    gap: 2rem;
  }

  .featured-item {
    animation-duration: 0.7s;
  }

  .featured-item:hover {
    transform: translateY(-10px);
  }

  .featured-item img {
    height: 220px;
  }

  .featured-item:hover img {
    transform: scale(1.06);
  }

  /* Menu Items */
  .menu-section {
    padding: 2.5rem 1rem;
  }

  #menu-container,
  .menu-grid {
    grid-template-columns: 1fr;
    gap: 1.5rem;
    margin-top: 1.5rem;
  }

  .menu-item,
  .cms-menu-item {
    padding: 1.25rem;
    border-radius: 16px;
  }

  .menu-item img,
  .cms-menu-item img {
    height: 180px;
    transform: scale(1);
    border-radius: 12px;
    box-shadow: 0 3px 15px rgba(0, 0, 0, 0.1);
  }

  .menu-item.show-popup .popup,
  .cms-menu-item.show-popup .popup {
    animation: slideUpFade 0.5s ease-out;
  }

  @keyframes slideUpFade {
    from {
      opacity: 0;
      transform: translateY(15px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .menu-item .popup,
  .cms-menu-item .popup {
    bottom: 8px;
    left: 8px;
    right: 8px;
    padding: 12px;
    border-radius: 10px;
  }

  .menu-item .add-cart,
  .menu-item .order-now,
  .cms-menu-item .add-cart,
  .cms-menu-item .order-now {
    padding: 0.6rem 0.75rem;
    font-size: 0.9rem;
    min-width: 85px;
    border-radius: 6px;
  }

  .menu-item h3,
  .cms-menu-item h3 {
    font-size: 1.2rem;
    margin: 0.75rem 0 0.4rem;
  }

  .menu-item p,
  .cms-menu-item p {
    font-size: 0.9rem;
    margin-bottom: 0.75rem;
    line-height: 1.5;
  }

  .menu-item .price,
  .cms-menu-item .price {
    font-size: 1.4rem;
    margin: 0.75rem 0;
  }

  .menu-item:hover,
  .cms-menu-item:hover {
    transform: translateY(-4px);
  }

  .menu-item:hover img,
  .cms-menu-item:hover img {
    transform: scale(1.03);
    filter: brightness(1.05);
  }

  /* Gallery */
  .gallery-section {
    padding: 3rem 1rem;
  }

  #gallery-container {
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    perspective: 400px;
  }

  #gallery-container img {
    transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
    animation-duration: 0.5s;
  }

  #gallery-container img:hover {
    transform: scale(1.03) translateY(-4px);
    box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15),
      0 8px 20px rgba(230, 122, 0, 0.1);
  }

  /* Content */
  .content-wrapper {
    margin: 6.25rem 0.9375rem;
    padding: 1.5625rem;
  }

  /* Bottom Sheet */
  .sheet-panel {
    width: calc(100% - 1.25rem);
    bottom: 0.75rem;
    left: 50%;
    max-width: none;
    border-radius: 12px;
  }

  .order-summary {
    font-size: 0.95rem;
  }

  /* Footer */
  .bakes-footer {
    padding: 2.5rem 1.25rem 1.25rem;
    margin-top: 3.75rem;
  }

  .footer-info {
    flex-direction: column;
    gap: 1.5625rem;
  }

  .legal-links {
    flex-direction: column;
    gap: 0.9375rem;
  }

  .phone-link {
    justify-content: center;
    padding: 0.625rem 1.25rem;
  }

  .footer-brand h3 {
    font-size: 1.8rem;
  }

  /* Animation adjustments */
  .feature:hover {
    transform: translateY(-3px) scale(1.01);
  }

  .btn:hover {
    transform: translateY(-2px) scale(1.02);
  }

  /* Gallery grid */
  #gallery-container,
  .gallery-grid {
    grid-template-columns: repeat(2, 1fr);
  }

  /* Admin Panel */
  .admin-tabs {
    padding: 0 1rem;
    gap: 0.5rem;
  }

  .admin-tab {
    padding: 0.875rem 1rem;
    font-size: 0.9rem;
    gap: 0.5rem;
    min-width: max-content;
  }

  .admin-tab i {
    font-size: 1rem;
    flex-shrink: 0;
  }

  .admin-tab span {
    white-space: nowrap;
    overflow: visible;
    text-overflow: clip;
  }

  .storage-status {
    flex-direction: column;
    align-items: flex-start;
    gap: 1rem;
    padding: 1rem;
  }

  .storage-bar {
    max-width: 100%;
    width: 100%;
  }

  .form-row {
    flex-direction: column;
    gap: 1rem;
  }

  .items-list,
  .gallery-admin-grid,
  .settings-grid {
    grid-template-columns: 1fr;
  }

  .admin-form-container,
  .settings-card {
    padding: 1.75rem;
  }

  .admin-main {
    padding: 1.75rem 1rem;
  }

  .admin-section-header h2 {
    font-size: 1.6rem;
  }

  .admin-section-header h2 i {
    width: 48px;
    height: 48px;
    font-size: 1.5rem;
  }

  .form-actions,
  .confirmation-actions,
  .item-card-actions {
    flex-direction: column;
  }

  .form-actions button,
  .confirmation-actions button,
  .item-card-actions button {
    width: 100%;
  }

  .gallery-admin-actions {
    flex-direction: column;
  }

  .gallery-admin-actions button {
    width: 100%;
  }

  .confirmation-content {
    padding: 2rem 1.5rem;
    width: 95%;
    margin: 1rem;
  }

  /* Scrollbar */
  ::-webkit-scrollbar {
    width: 8px;
  }

  ::-webkit-scrollbar:hover {
    width: 9px;
  }

  ::-webkit-scrollbar-thumb:hover {
    transform: none;
  }
}

/* Extra Small Screens (480px and down) */
@media (max-width: 480px) {
  .hero h2 {
    font-size: 1.6rem;
  }

  .hero .lead {
    font-size: 0.95rem;
  }

  .about-features {
    grid-template-columns: 1fr;
  }

  .menu-item,
  .cms-menu-item {
    padding: 0.9375rem;
  }

  .cart-row img {
    width: 60px;
    height: 60px;
  }

  .order-actions {
    flex-direction: column;
    align-items: center;
  }

  .sheet-actions {
    flex-direction: column;
  }

  /* Single column grids */
  #featured-container,
  .featured-grid,
  #menu-container,
  .menu-grid,
  #gallery-container,
  .gallery-grid {
    grid-template-columns: 1fr;
  }

  .menu-item .add-cart,
  .menu-item .order-now,
  .cms-menu-item .add-cart,
  .cms-menu-item .order-now {
    padding: 0.4rem 0.75rem;
    font-size: 0.85rem;
    min-width: 80px;
  }

  .menu-item .popup,
  .cms-menu-item .popup {
    padding: 10px;
    gap: 0.5rem;
  }

  /* Featured Items */
  .featured-item img {
    height: 200px;
  }

  .featured-item h3,
  .featured-item h4 {
    font-size: 1.3rem;
    margin: 1rem 1rem 0.5rem;
  }

  .featured-item p {
    font-size: 0.95rem;
    margin: 0 1rem 1rem;
  }

  /* Gallery */
  #gallery-container {
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  }

  /* Admin Panel */
  .admin-tab {
    padding: 0.75rem 0.875rem;
    font-size: 0.85rem;
    gap: 0.375rem;
  }

  .admin-tab i {
    font-size: 0.95rem;
  }

  .admin-login-box {
    padding: 2rem 1.5rem;
  }

  .admin-section-header h2 {
    font-size: 1.4rem;
  }

  .admin-section-header h2 i {
    width: 42px;
    height: 42px;
    font-size: 1.3rem;
  }

  .confirmation-header h3 {
    font-size: 1.5rem;
  }

  .confirmation-header i {
    font-size: 2.8rem;
  }
}

/* Reduced Motion Support */
@media (prefers-reduced-motion: reduce) {
  * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }

  /* Featured Items */
  .featured-item {
    animation: none;
    transition: none;
  }

  .featured-item:hover {
    transform: none;
  }

  .featured-item::before {
    display: none;
  }

  /* Gallery */
  #gallery-container img {
    animation: none;
    transition: none;
  }

  #gallery-container img:hover {
    transform: none;
    filter: none;
  }

  #gallery-container img::before {
    display: none;
  }

  /* Scrollbar */
  ::-webkit-scrollbar,
  ::-webkit-scrollbar-thumb {
    transition: none;
  }

  ::-webkit-scrollbar:hover {
    width: 12px;
  }

  ::-webkit-scrollbar-thumb:hover {
    transform: none;
  }

  /* Admin Panel */
  .admin-login-box,
  .admin-form-container,
  .item-card,
  .settings-card,
  .tab-pane,
  .confirmation-content,
  .confirmation-dialog {
    animation: none;
    transition: none;
  }

  .admin-tab:hover,
  .btn-admin:hover,
  .btn-edit:hover,
  .btn-delete:hover,
  .item-card:hover {
    transform: none;
  }

  .admin-logo:hover,
  .image-preview img:hover {
    transform: none;
  }
}

/* ================== SYNC STATUS INDICATOR ================== */
#sync-status-indicator {
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: #f8f9fa;
  border: 2px solid #e67a00;
  display: none;
  align-items: center;
  justify-content: center;
  font-size: 1.2rem;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
  z-index: 10000;
  transition: all 0.3s ease;
  opacity: 0;
  transform: translateY(10px);
}

#sync-status-indicator.syncing {
  display: flex;
  color: #e67a00;
  opacity: 1;
  transform: translateY(0);
  animation: pulse 1.5s infinite;
}

#sync-status-indicator.updated {
  display: flex;
  background: #e67a00;
  color: white;
  border-color: #e67a00;
  opacity: 1;
  transform: translateY(0);
}

@keyframes pulse {
  0% {
    opacity: 0.7;
  }
  50% {
    opacity: 1;
  }
  100% {
    opacity: 0.7;
  }
}

/* Responsive adjustment */
@media (max-width: 768px) {
  #sync-status-indicator {
    bottom: 70px; /* Above mobile browser UI */
    right: 15px;
    width: 36px;
    height: 36px;
    font-size: 1rem;
  }
}

--- FILE: ./terms-of-use.html ---
<!-- ================== terms-of-use.html ================== -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Terms of Use ‚Äî Toke Bakes</title>

    <link rel="icon" href="images/logo.webp" type="image/png" />
    <link rel="stylesheet" href="style.css?v=6" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
  </head>
  <body>
    <!-- Header -->
    <header>
      <div class="header-inner">
        <div class="brand">
          <img src="images/logo.webp" alt="Toke Bakes logo" class="logo-sm" />
          <h1>Toke Bakes</h1>
        </div>
        <nav class="navbar">
          <!-- Navigation links (visible on desktop) -->
          <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="menu.html">Menu</a></li>
            <li><a href="gallery.html">Gallery</a></li>
          </ul>

          <!-- Cart -->
          <a href="order.html" class="cart-link">
            <i class="fas fa-shopping-cart"></i>
            <span id="cart-count">0</span>
          </a>

          <!-- Theme toggle -->
          <button
            class="theme-toggle"
            id="themeToggle"
            aria-label="Toggle theme"
          >
            <i class="fas fa-sun icon sun"></i>
            <i class="fas fa-moon icon moon"></i>
          </button>

          <!-- Hamburger menu (visible on mobile only) -->
          <button class="navbar-toggle" id="navbarToggle">
            <i class="fas fa-bars"></i>
          </button>
        </nav>
      </div>
    </header>

    <!-- Main Content -->
    <main class="content-wrapper legal-content">
      <h1>Terms of Use</h1>
      <p><strong>Last updated:</strong> November 2025</p>

      <p>
        By using this website, you agree to these terms. All images and content
        are the property of <strong>Toke Bakes</strong>. Orders are subject to
        availability and confirmation by Toke Bakes.
      </p>

      <p>
        Unauthorized use of our content, images, or brand materials is strictly
        prohibited. We reserve the right to update these terms at any time.
      </p>
    </main>

    <!-- Footer -->
    <footer class="bakes-footer">
      <div class="footer-content">
        <div class="footer-brand">
          <h3>Toke Bakes</h3>
          <p class="tagline">Taking Love, One Slice at a Time</p>
        </div>

        <div class="footer-info">
          <!-- Phone should be a clickable link, not just text -->
          <a href="tel:07063466822" class="phone-link">
            <i class="fas fa-phone"></i>
            <span>07063466822</span>
          </a>

          <div class="social-links">
            <span class="follow-text">Follow Us</span>
            <div class="social-icons">
              <a href="#" class="social-icon" aria-label="Instagram">
                <i class="fab fa-instagram"></i>
              </a>
              <a href="#" class="social-icon" aria-label="TikTok">
                <i class="fab fa-tiktok"></i>
              </a>
            </div>
          </div>
        </div>
      </div>

      <div class="footer-bottom">
        <!-- Add legal-link class to these -->
        <div class="legal-links">
          <a href="privacy.html" class="legal-link">Privacy Policy</a>
          <a href="terms-of-use.html" class="legal-link">Terms of Use</a>
        </div>
        <p class="copyright">
          &copy; <span id="current-year">2024</span> Toke Bakes. All rights
          reserved.
        </p>
      </div>
    </footer>

    <script src="config.js?v=6"></script>
    <script src="script.js?v=6"></script>
  </body>
</html>
